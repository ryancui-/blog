[{"title":"Chrome æ’ä»¶å¼€å‘å°ç»“","date":"2018-10-18T03:32:42.000Z","path":"2018/10/18/chrome-extension-dev/","text":"æœ€è¿‘éƒ½åœ¨åš Chrome æ’ä»¶çš„å¼€å‘ï¼Œè™½ç„¶ä¸€å¼€å§‹æ•´ä¸ªæ’ä»¶çš„æ¡†ä¸æ˜¯æˆ‘æ­èµ·æ¥çš„ï¼Œä½†åœ¨è¿‡ç¨‹ä¸­é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œè§£å†³æ–¹æ³•ï¼Œä¹Ÿå€¼å¾—æ€»ç»“ä¸€ä¸‹ã€‚ ä½¿ç”¨ Vue.js å¼€å‘ Chrome æ’ä»¶è¿™ä¸ªæ’ä»¶åœ¨æ‰“å¼€çš„æ—¶å€™ä¼šå¼¹å‡ºä¸€ä¸ªæ“ä½œé¡µé¢ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’ï¼Œè¿™ä¸ªæ“ä½œé¡µé¢å¯ä»¥ç”¨ Vue.js æ¥å¼€å‘ï¼Œæœ¬è´¨ä¸Šä¸å¼€å‘ä¸€ä¸ªæ™®é€šçš„ Vue Web åº”ç”¨å·®ä¸å¤šã€‚ é‚£ä¹ˆæ€ä¹ˆæŠŠè¿™ä¸ªé¡µé¢æ”¾è¿›éœ€è¦å±•ç¤ºçš„ Tab ä¸­å‘¢ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† iframeï¼š const frame_id = this.frame_idthis.frame = $(`#$&#123;frame_id&#125;`)if (!this.frame.length) &#123; // æœªæ¸²æŸ“ let indexURL = chrome.runtime.getURL('index.html') this.frame = $(`&lt;iframe src=\"$&#123;indexURL&#125;\" id=\"$&#123;frame_id&#125;\"&gt;&lt;/iframe&gt;`) $(document.body).append(this.frame)&#125; æ‰“åŒ…å¥½ Vue çš„åº”ç”¨åï¼Œé€šè¿‡ chrome.runtime.getURL è·å– index.html çš„è·¯å¾„ï¼Œå¾€é¡µé¢æ·»åŠ ä¸€ä¸ª iframe æ˜¾ç¤ºã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª iframe çš„æ„é€ å’Œæ’å…¥æ˜¯åœ¨ Chrome æ’ä»¶çš„ content script ä¸­ï¼Œå…¶å®æœ¬è´¨ä¸Šä¸æ’ä»¶è‡ªå¸¦çš„ popup html é€‰é¡¹æ˜¯ä¸€è‡´çš„ï¼Œiframe ä¸­åŠ è½½çš„ js ä¹Ÿå±äºæ’ä»¶çš„ content script. å…¶ä»–é¡µé¢çš„å¼€å‘æ–¹å¼ã€Vuex çš„ä½¿ç”¨ç­‰ä¸å¹³å¸¸ä½¿ç”¨åŸºæœ¬ç›¸åŒã€‚ ä¸‰ä¸ªåŒºåŸŸ Background/Content/Frame çš„é€šä¿¡ é¡µé¢æ¶æ„ é‡‡ç”¨æ’å…¥ iframe çš„æ–¹å¼ï¼Œæ•´ä¸ªåº”ç”¨è¢«åˆ’åˆ†æˆäº†ä¸‰å—ï¼š Backgroundï¼šå¸¸é©»åœ¨æµè§ˆå™¨çš„ JavaScript è„šæœ¬ Contentï¼šæ‰“å¼€çš„ç½‘é¡µæœ¬æ¥çš„ JavaScript è„šæœ¬ï¼ˆç¯å¢ƒï¼‰ Frameï¼šä»æ’ä»¶ content script ä¸­è°ƒç”¨ js æ’å…¥çš„ä¸€ä¸ª iframe çš„ JavaScript è„šæœ¬ï¼ˆç¯å¢ƒï¼‰ è™½ç„¶ Content ä¸ Frame ä¸¤éƒ¨åˆ†åœ¨ Chrome æ’ä»¶ä¸Šå‡å±äº content script çš„èŒƒç•´ï¼Œä½†ç”±äº Chrome æ’ä»¶çš„é™åˆ¶ï¼Œè¿™ä¸¤å—çš„ JavaScript æ‰§è¡Œç¯å¢ƒå¹¶ä¸ä¸€è‡´ï¼Œå› æ­¤è¿™ä¸¤éƒ¨åˆ†ä¹Ÿéœ€è¦é¢å¤–çš„é€šä¿¡ã€‚ é€šä¿¡çš„æ–¹å¼å…¶å®éå¸¸åŸå§‹ï¼Œç®€å•çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œåˆ©ç”¨ Chrome æ’ä»¶æä¾›çš„ APIï¼Œåˆ†åˆ«åœ¨æ¯ä¸ªåœ°æ–¹ set up è‡ªå·±çš„ listenerï¼Œå¹¶å¤„ç†ç›¸åº”çš„äº‹ä»¶å³å¯ã€‚ å‘å¸ƒå‘ Background å‘é€æ¶ˆæ¯æ—¶å¯ä»¥ä½¿ç”¨ chrome.runtime.sendMessageï¼Œè€Œå‘ Content æˆ– Frame å‘é€æ¶ˆæ¯æ—¶ï¼Œç”±äºéœ€è¦æŒ‡å®šå¯¹åº”çš„ Tabï¼ˆæ ‡ç­¾é¡µï¼‰ï¼Œéœ€è¦ä½¿ç”¨ chrome.tabs.sendMessage è®¢é˜…ä¸‰ä¸ªéƒ¨åˆ†çš„ listener éƒ½å¯ä»¥ä½¿ç”¨ chrome.runtime.onMessage æ¥å®Œæˆäº‹ä»¶ç›‘å¬ã€‚æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒsendMessage å’Œ onMessage æœ‰ä¸€ä¸ªå›è°ƒçš„åŠŸèƒ½ï¼Œèƒ½ä½¿æ¶ˆæ¯å‘é€æ–¹æ¥æ”¶è®¢é˜…æ–¹çš„å›è°ƒï¼ˆç±»ä¼¼äºå›æ‰§ä¸€æ ·ï¼‰ï¼Œçœ‹ä¸‹ä¾‹å­ï¼š // åœ¨ Content å‘é€æ¶ˆæ¯chrome.runtime.sendMessage(&#123;greeting: \"æ‚¨å¥½\"&#125;, response =&gt; &#123; console.log(response.farewell);&#125;);// åœ¨ Background è®¢é˜…æ¶ˆæ¯chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt; &#123; console.log(sender.tab ? \"æ¥è‡ªå†…å®¹è„šæœ¬ï¼š\" + sender.tab.url : \"æ¥è‡ªæ‰©å±•ç¨‹åº\"); if (request.greeting == \"æ‚¨å¥½\") &#123; sendResponse(&#123;farewell: \"å†è§\"&#125;); &#125;&#125;); å¯ä»¥çœ‹åˆ°è®¢é˜…æ–¹æ˜¯å¯ä»¥é€šè¿‡ä¸€ä¸ª sendResponse çš„å›è°ƒæŠŠæ•°æ®å›é€ç»™å‘é€æ–¹ï¼Œè€Œç”±äºæˆ‘ä»¬åœ¨ä¸‰ä¸ªåœ°æ–¹éƒ½ç›‘å¬äº†äº‹ä»¶ï¼ˆè°ƒç”¨äº† chrome.runtime.onMessage.addListenerï¼‰ï¼Œè€Œæ–‡æ¡£ä¸Šæœ‰è¯´æ˜ æ³¨æ„ï¼š å¦‚æœå¤šä¸ªé¡µé¢éƒ½ç›‘å¬ onMessage äº‹ä»¶ï¼Œå¯¹äºæŸä¸€æ¬¡äº‹ä»¶åªæœ‰ç¬¬ä¸€æ¬¡è°ƒç”¨ sendResponse() èƒ½æˆåŠŸå‘å‡ºå›åº”ï¼Œæ‰€æœ‰å…¶ä»–å›åº”å°†è¢«å¿½ç•¥ã€‚ å› æ­¤éœ€è¦åˆç†çš„è§„åˆ’äº‹ä»¶ï¼Œä¿è¯åŒä¸€ç±»å‹çš„äº‹ä»¶åªä¼šè¢«æŸä¸€ä¸ª listener æ‰€å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½æ­£ç¡®åœ°è°ƒç”¨ sendResponse è·å–å›é€çš„æ•°æ®ã€‚ è§„åˆ’äº‹ä»¶ä¸ºäº†ä½¿æ‰€æœ‰çš„äº‹ä»¶èƒ½æ›´å¥½åœ°åˆ†é—¨åˆ«ç±»ï¼Œå‘é€äº‹ä»¶æ—¶ä½¿ç”¨äº†è¿™æ ·çš„æ•°æ®æ ¼å¼ï¼š &#123; direction: 'content_to_background', area: 'frame', operate: 'decrease_active_tabs', options: &#123; task_id: 'c10103' &#125;&#125; direction - è¯´æ˜å½“å‰äº‹ä»¶çš„æµåŠ¨æ–¹å‘ï¼Œç”¨äºåœ¨ listener å¤„è¿›è¡Œç­›é€‰äº‹ä»¶è¿›è¡Œå¤„ç† area - è¡¨æ˜å½“å‰äº‹ä»¶çš„å¤„ç†å™¨ï¼ˆæˆ–è€…æ¨¡å—ï¼‰ operate - äº‹ä»¶ç±»å‹ options - è‡ªå®šä¹‰å‚æ•° é€šè¿‡ direction å¯ä»¥æ˜¯ä¸‰éƒ¨åˆ†çš„ listener å®šä¹‰å¤ç”¨åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š chrome.runtime.onMessage.addListener((message, sender, callback) =&gt; &#123; /** * area è¡¨ç¤ºæ“ä½œçš„åŒºåŸŸ */ const &#123; direction &#125; = message switch (direction) &#123; case 'background_to_content': case 'frame_to_content': this.contentListening(message, callback) break case 'content_to_background': case 'frame_to_background': this.backgroundListening(message, callback) break case 'content_to_frame': case 'background_to_frame': this.frameListening(message, callback) default: console.log('who cares ?') &#125; return true // åªæœ‰å½“return trueçš„æ—¶å€™ï¼Œcallbackæ‰ä¼šå°†ä¿¡æ¯è¿”å›&#125;) å†æ ¹æ® area åˆ†åˆ«è°ƒç”¨ä¸åŒçš„ handler contentListening(message, callback) &#123; const &#123; area &#125; = message switch (area) &#123; case 'frame': frame.handle(message, callback) break case 'selector': selector.handle(message, callback) break &#125;&#125; æœ€ååœ¨å…·ä½“å¤„ç†çš„ handler ä¸­æ ¹æ®äº‹ä»¶ç±»å‹ operate åˆ†é…å¤„ç†çš„å‡½æ•° // å¤„ç† Frame ç›¸å…³æ“ä½œçš„ Handlerclass Frame &#123; constructor(frame_id) &#123; this.frame_id = frame_id this.frame = null &#125; handle(message, callback) &#123; const &#123; operate, options &#125; = message switch (operate) &#123; case 'move': this.move(options.position) break case 'change_width': this.changeWidth(options.type) break case 'toggle_width': this.toggleWidth() break // æ›´å¤šçš„äº‹ä»¶ç±»å‹ &#125; &#125; // çœç•¥å…·ä½“çš„å¤„ç†...&#125; Ajax è¯·æ±‚å¯ä»¥åœ¨ content script æˆ– background ä¸­å‘å¯¹åº”çš„ ajax è¯·æ±‚ï¼Œä¸¤è€…éƒ½èƒ½å¸¦ä¸Šå¯¹åº”çš„ cookiesï¼Œä¹Ÿæ²¡æœ‰å—åˆ°åŒæºç­–ç•¥çš„å½±å“ã€‚ä½†åœ¨å®è·µä¸­å‘ç°ï¼Œå¯¹äºåœ¨ä¸€äº› HTTPS ç«™ç‚¹ä¸­æ‰“å¼€çš„æ’ä»¶ï¼Œå¦‚æœä½¿ç”¨ content script è¯·æ±‚ HTTP çš„åç«¯æ¥å£ï¼Œä¼šæŠ¥é”™ã€‚ Mixed Content: The page at â€˜â€¦â€™ was loaded over HTTPS, but requested an insecure resource â€˜â€™. This request has been blocked; the content must be served over HTTPS. å› æ­¤è¿˜æ˜¯æŠŠ ajax è¯·æ±‚æ”¾åˆ°äº† background çš„ js ç¯å¢ƒä¸­ä½œè¯·æ±‚ï¼Œåœ¨ Vue ä¸­å°è£…äº†ä¸€ä¸ª $ajax æ–¹æ³•ï¼š Vue.prototype.$toBackground = function (message) &#123; return new Promise(resolve =&gt; &#123; chrome.runtime.sendMessage(&#123; ...message, direction: 'frame_to_background' &#125;, res =&gt; &#123; resolve(res) &#125;) &#125;)&#125;Vue.prototype.$ajax = async function (options) &#123; const result = await this.$toBackground(&#123; area: 'ajax', operate: 'request', options &#125;) &#125; return result&#125; åŒæ—¶åœ¨ background çš„ listener ä¸­é…ç½®å¥½ area ä¸º ajax çš„ handlerï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡é€šä¿¡åœ¨ background ç¯å¢ƒè¯·æ±‚åç«¯æ¥å£äº†ã€‚ æ—¥å¸¸å¼€å‘é…ç½®åœ¨å¼€å‘ Chrome æ’ä»¶çš„æ—¶å€™ï¼Œå…¶å®å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨å¼€å‘é¡µé¢ï¼ˆVue.js éƒ¨åˆ†ï¼‰ï¼Œå› æ­¤æ¯æ¬¡éƒ½ build åˆ°æœ¬åœ°ï¼Œåˆ° Chrome æ‰©å±•å•†åº—åˆ·æ–°ï¼Œå¤§å¤§é™ä½äº†æ•ˆç‡ã€‚å› æ­¤å¯ä»¥é€šè¿‡æ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦ä¸ºæ’ä»¶ç¯å¢ƒï¼Œæ¥ç¦æ­¢è°ƒç”¨ä¸€éƒ¨åˆ†æ’ä»¶ç¯å¢ƒæ‰æ”¯æŒçš„ APIï¼Œä»è€Œè¾¾åˆ°åœ¨æ™®é€š Web Server ä¸­å¼€å‘ Vue.js é¡µé¢çš„éœ€æ±‚ã€‚ // åˆ¤æ–­å½“å‰çš„ç¯å¢ƒæ˜¯å¦æ˜¯æ’ä»¶ç¯å¢ƒexport const is_extension_env = window.location.protocol === 'chrome-extension:'// å¯¹æ‰€æœ‰ä½¿ç”¨äº†æ’ä»¶ API çš„åœ°æ–¹è¿›è¡Œé…ç½®Vue.prototype.$toBackground = function (message) &#123; return new Promise(resolve =&gt; &#123; if (is_extension_env) &#123; chrome.runtime.sendMessage(&#123; ...message, direction: 'frame_to_background' &#125;, res =&gt; &#123; resolve(res) &#125;) &#125; else &#123; resolve(&#123;&#125;) &#125; &#125;)&#125;// å¦‚æœæ˜¯æ™®é€šç¯å¢ƒï¼Œç›´æ¥è°ƒç”¨ ajax è¯·æ±‚ä¸éœ€è¦é€šè¿‡æ¶ˆæ¯Vue.prototype.$ajax = async function (options) &#123; let result if (!is_extension_env) &#123; result = await new Promise(resolve =&gt; request.handle(&#123; options &#125;, resolve)) &#125; else &#123; result = await this.$toBackground(&#123; area: 'ajax', operate: 'request', options: options &#125;) &#125; return result&#125; è¿™æ ·å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ npm run dev æ‰“å¼€ç½‘é¡µè¿›è¡Œæ™®é€šçš„ Web ç½‘é¡µå¼€å‘è°ƒè¯•äº†ã€‚å½“ç„¶ä¸€äº›éœ€è¦ç”¨åˆ° chrome.* API çš„åŠŸèƒ½è¿˜æ˜¯éœ€è¦è¿›è¡Œ build åå®é™…è°ƒè¯•ã€‚ å‚è€ƒèµ„æ–™ å…¥é—¨ï¼šå»ºç«‹ Chrome æ‰©å±•ç¨‹åº","tags":[{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://blog.imtouch.info/tags/å‰ç«¯/"},{"name":"Chrome","slug":"Chrome","permalink":"https://blog.imtouch.info/tags/Chrome/"}]},{"title":"å†è°ˆå¾®ä¿¡å°ç¨‹åºç™»å½•æ€ç»´æŠ¤","date":"2018-06-15T08:15:11.000Z","path":"2018/06/15/wechat-miniprogram-login-state/","text":"åœ¨ä¹‹å‰çš„æ–‡ç« å°ç¨‹åº Page è·å–ç™»å½•æ€ï¼Œå¼‚æ­¥æ»¡å¤©é£ï¼Ÿä¸­ï¼Œæ›¾ç»è®¨è®ºäº†ä¸€ç•ªå¾®ä¿¡å°ç¨‹åºä¸­ç™»å½•æ€çš„è·å–ç»´æŠ¤ä¸å…·ä½“é¡µé¢çš„ä¸šåŠ¡æ•°æ®æ¥å£è°ƒç”¨ä¹‹é—´çš„å…³ç³»ï¼Œç”±äºæ— æ³•ä¿è¯ç™»å½•é€»è¾‘ä¸ä¸šåŠ¡æ¥å£çš„æ—¶åºæ€§ï¼ˆè€Œä¸šåŠ¡æ¥å£åˆå¿…é¡»ä¾èµ–ç™»å½•é€»è¾‘çš„å®Œæˆæ‰èƒ½è·å– Token è¿›è¡ŒéªŒè¯ï¼‰ï¼Œå› æ­¤å½“æ—¶ä½¿ç”¨äº†ç±»ä¼¼ EventBus çš„æ–¹æ³•æ¥ä¸²è¡ŒåŒ–ï¼Œä½¿ä¸šåŠ¡æ¥å£å¿…é¡»ç­‰å¾…å…¨å±€ç™»å½•é€»è¾‘å®Œæˆã€‚ è¿™æ ·çš„æ–¹æ¡ˆä¸ä»…ä¾µå…¥æ€§é«˜ï¼Œè€Œä¸”å½“ä¸šåŠ¡é¡µé¢å˜å¾—è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒEventBus äº‹ä»¶ä¸å›è°ƒçš„ç»´æŠ¤å°†å˜å¾—ä¸€å›¢ç³Ÿã€‚å› æ­¤ç»è¿‡ä¸ Gayhub å¤§ç¥çš„æ¢è®¨åï¼Œæ•´ç†å‡ºè¿™æ ·çš„ä¸€å¥—æ–¹æ¡ˆã€‚ èƒŒæ™¯ï¼šç™»å½•æ€ä¸ç¬¬ä¸‰æ–¹ Session çš„è·å–ç»´æŠ¤å¯¹äºå¾®ä¿¡å°ç¨‹åºçš„åº”ç”¨æ¥è¯´ï¼Œæœ‰ä¸¤ä¸ªéœ€è¦ç»´æŠ¤çš„çŠ¶æ€ï¼Œä¸€ä¸ªæ˜¯å¾®ä¿¡çš„ç™»å½•æ€ï¼Œå¦ä¸€ä¸ªç¬¬ä¸‰æ–¹ Session çš„çŠ¶æ€ï¼Œå…ˆçœ‹å¾®ä¿¡å®˜æ–¹çš„ç™»å½•æ€æ—¶åºå›¾ï¼š å¾®ä¿¡å®˜æ–¹ç™»å½•æ€æ—¶åºå›¾ ç»“åˆ API æ–‡æ¡£å¯ä»¥çŸ¥é“ï¼Œé€šè¿‡ wx.login å’Œ wx.checkSession ä¸¤ä¸ªå‰ç«¯æ¥å£æ¥è¿›è¡Œåˆ·æ–°å’Œç»´æŠ¤ï¼›è€Œç¬¬ä¸‰æ–¹ Session çš„è·å–å°±æ˜¯æ•´ä¸ªç™»å½•æ€ä¸­çš„æŸä¸€æ­¥ï¼šåœ¨è°ƒç”¨ç¬¬ä¸‰æ–¹å¼€å‘è€…æœåŠ¡å™¨ç”¨ code æ¢å– openid çš„æ¥å£ä¸­è¿”å›æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç™»å½•æ€ï¼ˆå³ç¬¬ä¸‰æ–¹ Sessionï¼‰ã€‚ æ¢è¨€ä¹‹ï¼Œå¦‚æœæ˜¯ç¬¬ä¸‰æ–¹ Session è¿‡æœŸäº†ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨å¯ä»¥ç›´æ¥é‡æ–°èµ°ä¸€éè¿™ä¸ªç™»å½•æ€æµç¨‹æ¥åŒæ—¶åˆ·æ–°å¾®ä¿¡ç™»å½•æ€å’Œç¬¬ä¸‰æ–¹çš„ç™»å½•æ€ï¼Œè€Œä¸éœ€è¦ç‹¬ç«‹è¿›è¡Œç¬¬ä¸‰æ–¹çš„åˆ·æ–°ã€‚ äº§ç”Ÿäº†é—®é¢˜ï¼šä¸šåŠ¡æ¥å£ä¸ç™»å½•é€»è¾‘çš„æ—¶åºæŒ‰ç…§ç™»å½•æ€æ—¶åºå›¾æ¥å®ç°æ•´ä¸ªç™»å½•é€»è¾‘æœ¬æ¥æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šåœ¨ä¸€å¼€å§‹è¿›å…¥å°ç¨‹åºæ—¶å°±è¿›è¡Œç™»å½•æ€çš„è·å–ï¼Œæ¢è¨€ä¹‹ï¼Œå°±æ˜¯åœ¨ App çš„ onLaunch äº‹ä»¶ä¸­æ‰§è¡Œè¿™ä¸ªç™»å½•é€»è¾‘ã€‚ä½†æ³¨æ„åˆ°ç™»å½•æ—¶åºä¸­æœ‰ä¸€æ­¥ï¼š wx.request å‘èµ·ä¸šåŠ¡è¯·æ±‚ï¼Œæºå¸¦è‡ªå®šä¹‰ç™»å½•æ€ ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›ä¸šåŠ¡è¯·æ±‚æ˜¯æ”¾åœ¨äº†å„ä¸ª Page é‡Œé¢è¿›è¡Œçš„ï¼Œæ¢è¨€ä¹‹ï¼Œè¿™ä¸ªæ•°æ®çš„è·å–æ˜¯åœ¨ Page çš„ onLoad ç­‰äº‹ä»¶é‡Œæ‰§è¡Œçš„ã€‚è¿™æ ·å°±ä¼šäº§ç”Ÿä¸€ä¸ªå…ˆåé¡ºåºçš„é—®é¢˜ï¼Œè¯¦ç»†ä»‹ç»è¯·çœ‹ä¸Šä¸€ç¯‡æ–‡ç« ã€Šå°ç¨‹åº Page è·å–ç™»å½•æ€ï¼Œå¼‚æ­¥æ»¡å¤©é£ï¼Ÿã€‹ã€‚ æ€»ä¹‹ï¼Œ è¿™ç§é‡‡ç”¨ç™»å½•é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»çš„åšæ³•ä¼šå¸¦æ¥å¾ˆå¤šä¸å¿…è¦çš„ä»£ç å†—ä½™ï¼ˆåŒ…æ‹¬å¤„ç† EventBus äº‹ä»¶çš„ä»£ç ï¼‰ï¼Œèƒ½ä¸èƒ½æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä¼˜é›…åœ°è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿä½¿ Page åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œåˆ°åç«¯æ‹¿æ•°æ®åªæ˜¯ä¸€æ®µç®€å•çš„å‡½æ•°è°ƒç”¨è€Œä¸å¿…å…³æ³¨ç™»å½•æ€ï¼Ÿ é€šè¿‡ä¸­é—´å±‚å±è”½ç™»å½•é€»è¾‘ç»Ÿä¸€çš„åç«¯ä¸­é—´å±‚å½“æˆ‘æŠŠè¿™ä¸ªé—®é¢˜å‘åˆ° Github ä¸Šåï¼Œæœ‰åŒå­¦æå‡ºäº†è¿™æ ·ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šå¯¹æ‰€æœ‰çš„ request è·¯ç”±åˆ°ä¸€ä¸ªä¸­é—´å±‚ï¼Œé€šè¿‡ä¸­é—´å±‚æ¥å¤„ç†ç™»å½•é€»è¾‘ã€‚ Amazing~å½“æˆ‘ä»¬é‡æ–°å®¡è§†è¿™ä¸ªé—®é¢˜çš„å‡ºç°åŸå› æ—¶ï¼Œæˆ‘ä»¬å‘ç°æ­£æ˜¯ç”±äºæˆ‘ä»¬æŠŠæ•´ä¸ªç™»å½•æ€é€»è¾‘æ”¾åœ¨ä¸¤ä¸ªæ—¶åºä¸ç›¸å…³çš„åœ°æ–¹ï¼šApp.onLaunch å’Œ Page.onLoadã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆä¸€å®šè¦è¿›å…¥å°ç¨‹åºæ—¶å°±éœ€è¦æ‰§è¡Œç™»å½•æ€è·å–çš„é€»è¾‘å‘¢ï¼Ÿåªéœ€è¦ç¡®ä¿åœ¨æ‰§è¡Œè¯·æ±‚çš„æ—¶å€™æˆåŠŸè·å–ç™»å½•æ€ä¸ç¬¬ä¸‰æ–¹ Session å°±å¯ä»¥äº†ã€‚è¿™æ ·ä¸€æ¥å°±å¯ä»¥ä¸¥æ ¼åœ°æ§åˆ¶ç™»å½•æ€ä¸ä¸šåŠ¡è¯·æ±‚çš„å…ˆåé¡ºåºï¼Œä¸ä¼šå‡ºç°ä¸šåŠ¡è¯·æ±‚æ—¶ï¼Œtoken ä¸ºç©ºçš„æƒ…å†µäº†ã€‚ æ ¹æ®è¿™ä¸ªæ€è·¯ï¼Œæ¯ä¸€ä¸ª request éƒ½ä¼šæ‰§è¡Œè¿™æ ·çš„ä¸€ä¸ªæµç¨‹å›¾ï¼š æ€»ä½“æµç¨‹å›¾ å¯¹äºæ¯ä¸€ä¸ªè¯·æ±‚ï¼Œéƒ½å»åˆ¤æ–­ä¸€ä¸‹ç™»å½•æ€çš„æƒ…å†µï¼Œå¦‚æœå‘ç°æ²¡æœ‰ç™»å½•ï¼Œåˆ™æ‰§è¡Œç›¸åº”çš„ç™»å½•é€»è¾‘ï¼Œç™»å½•é€»è¾‘çš„ç»†èŠ‚æ˜¯è¿™æ ·çš„ï¼š ç™»å½•é€»è¾‘æµç¨‹å›¾ æ•´ä¸ªé€»è¾‘å…¶å®å°±æ˜¯ A/B/C ä¸‰ä¸ªå‡½æ•°è°ƒç”¨ï¼ŒC çš„æµç¨‹æ˜¯æ ¹æ®å¾®ä¿¡å®˜æ–¹æ—¶åºå®ç°çš„ï¼Œå¹¶ä¸”åŠ å…¥äº†è·å–ä¸ªäººä¿¡æ¯éƒ¨åˆ†ï¼Œå› ä¸ºå¤§éƒ¨åˆ†çš„ç¬¬ä¸‰æ–¹ç™»å½•æ¥å£éƒ½éœ€è¦ä¿å­˜è¯¸å¦‚å¾®ä¿¡å¤´åƒåœ°å€ç­‰ä¸ªäººä¿¡æ¯ã€‚ ä»£ç å®ç°å°ç¨‹åº API Promise åŒ–ç”±äºå°ç¨‹åºæä¾›çš„ API å…¨æ˜¯å›è°ƒå‡½æ•°çš„æ–¹å¼ï¼Œåœ¨å®ç°ä¸Šæ–‡æåˆ°çš„ C æµç¨‹æ—¶ä¼šå¯¼è‡´å…¸å‹çš„å›è°ƒåœ°ç‹±ï¼Œå› æ­¤é¦–å…ˆéœ€è¦ä¸€ä¸ªæŠŠå°ç¨‹åº API éƒ½è¿”å› Promise çš„ Wrapper. const promisify = wxMethod =&gt; options =&gt; new Promise((resolve, reject) =&gt; &#123; const extendOptions = Object.assign(&#123; success(res) &#123; resolve(res); &#125;, fail(res) &#123; reject(res); &#125; &#125;, options); wxMethod(extendOptions);&#125;);class WeixinWrapper &#123; login = promisify(wx.login); request = promisify(wx.request); getSetting = promisify(wx.getSetting); getUserInfo = promisify(wx.getUserInfo); checkSession = promisify(wx.checkSession);&#125;const weixinWrapper = new WeixinWrapper();export default weixinWrapper; è¿™æ ·å°±å¯ä»¥ä½¿ç”¨ Promise æ¥å¤„ç†äº†ï¼Œæ–¹ä¾¿å¾ˆå¤šã€‚ request å®ç°å¯¹äºåç«¯è¯·æ±‚çš„ç»Ÿä¸€å…¥å£ requestï¼ŒæŒ‰ç…§æµç¨‹å›¾è¿›è¡Œå®ç°ï¼Œè¿™é‡Œç™»å½•é€»è¾‘é‡Œçš„ä¸‰ä¸ªæ–¹æ³• A/B/C è¿”å›çš„éƒ½æ˜¯ Promise A - æ£€æŸ¥å¾®ä¿¡ç™»å½•æ€ï¼šcheckWxSession B - æ£€æŸ¥ç¬¬ä¸‰æ–¹ Session æ€ï¼šcheckThirdSession C - ç™»å½•é€»è¾‘ï¼šdoLogin æ£€æŸ¥éƒ½é€šè¿‡åï¼Œå°† store ä¸­çš„ token æ”¾åˆ°æ¯ä¸ª request çš„ Header ä¸­å³å¯å®ç°ä¸šåŠ¡è¯·æ±‚å¸¦ä¸Šè‡ªå®šä¹‰ç™»å½•æ€çš„éœ€æ±‚äº†ã€‚ const request = (method, url, data, header = &#123;&#125;) =&gt; new Promise(async (resolve, reject) =&gt; &#123; try &#123; const thirdSessionChecked = await checkThirdSession(); const wxSessionChecked = await checkWxSession(); if (!(wxSessionChecked &amp;&amp; thirdSessionChecked)) &#123; await doLogin(); &#125; const customHeader = header; if (store.state.token) &#123; customHeader.Authorization = `Bearer $&#123;store.state.token&#125;`; &#125; const res = await wxWrapper.request(&#123; method, url: url.startsWith('http') ? url : apiPrefix + url, data, header: customHeader &#125;); if (res.statusCode &gt;= 200 &amp;&amp; res.statusCode &lt; 300) &#123; resolve(res.data); &#125; else &#123; reject(res); &#125; &#125; catch (err) &#123; reject(err); &#125;&#125;); ä¸‰ä¸ªæ–¹æ³•ç™»å½•é€»è¾‘ä¸­ä¸‰ä¸ªæ–¹æ³•çš„å®ç°å°±ç›´æ¥æ ¹æ®é€»è¾‘æ¥å®ç°å°±å¥½äº†ï¼Œæ³¨æ„éƒ½è¿”å› Promise å°±è¡Œäº†ï¼Œè¿™é‡Œå°±ä¸è´´å‡ºå…¨éƒ¨ä»£ç äº†ï¼Œå¤§è‡´çœ‹ä¸‹ doLogin çš„ç»“æ„ã€‚ const doLogin = (globalUserInfo = &#123;&#125;) =&gt; new Promise((resolve, reject) =&gt; &#123; let customOpenId; let headImg; let fullUserInfo; wxWrapper.login() // 1. è·å–å¾®ä¿¡ç™»å½•æ€ .then((&#123; code &#125;) =&gt; wxWrapper.request(&#123; // 2. æ¢å– openid url: `$&#123;wxApiPrefix&#125;/v1/openId/$&#123;code&#125;`, method: 'GET', data: &#123; type: 'xcx' &#125; &#125;)) .then((&#123; data: &#123; code: openCode, data: openid &#125;, statusCode: openidCode &#125;) =&gt; &#123; customOpenId = openid; if (openidCode === 200 &amp;&amp; openCode === 1) &#123; return wxWrapper.getSetting(); // 3. æ£€æŸ¥æ˜¯å¦æˆæƒ &#125; throw new Error(); &#125;) .then((&#123; authSetting &#125;) =&gt; &#123; if (authSetting['scope.userInfo']) &#123; return wxWrapper.getUserInfo(&#123; // 4. è·å–ä¸ªäººä¿¡æ¯ withCredentials: true, &#125;); &#125; throw new Error(); &#125;) .then((userInfo) =&gt; &#123; fullUserInfo = userInfo; headImg = fullUserInfo.userInfo.avatarUrl; headImg = `$&#123;headImg.substr(0, headImg.lastIndexOf('/'))&#125;/46`; return wxWrapper.request(&#123; // 5. ç¬¬ä¸‰æ–¹ç™»å½• url: `$&#123;apiPrefix&#125;/auth/wx`, method: 'POST', data: &#123; clientType: 'xcx', headImg, nickname: fullUserInfo.userInfo.nickName, sex: fullUserInfo.userInfo.gender, xcxOpenid: `$&#123;customOpenId&#125;`, realname: globalUserInfo.realname &#125;, &#125;); &#125;) .then((&#123; data: &#123; code: authCode, data: token &#125;, statusCode: tokenCode &#125;) =&gt; &#123; if (tokenCode === 200 &amp;&amp; authCode === 1) &#123; const now = Date.now(); const user = &#123; openid: customOpenId, nickname: fullUserInfo.userInfo.nickName, headImg, realname: globalUserInfo.realname &#125;; store.commit('setToken', token); store.commit('setTokenGenTime', now); store.commit('setUser', user); wx.setStorageSync('token', token); wx.setStorageSync('token_gen_time', now); wx.setStorageSync('user', user); resolve(); &#125; throw new Error(); &#125;) .catch(() =&gt; &#123; reject(); &#125;);&#125;); æ–°çš„é—®é¢˜ï¼šå¹¶å‘ä¸šåŠ¡æ¥å£å¯¼è‡´å¤šæ¬¡è¿›å…¥ç™»å½•é€»è¾‘é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„ request æ–¹æ³•ï¼ŒæŠŠæ‰€æœ‰åˆ°åç«¯ä¸šåŠ¡çš„æ¥å£è·¯ç”±åœ¨ä¸€èµ·å¹¶å¤„ç†ç™»å½•æ€å¾ˆå¥½çš„è§£å†³äº†ä¹‹å‰æåˆ°çš„æ‰§è¡Œæ—¶åºçš„é—®é¢˜ã€‚ä½†ä¼šå¯¼è‡´ä¸¤ä¸ªæ–°çš„é—®é¢˜ï¼š å½“é¡µé¢ä¸­å¹¶å‘ä¸¤ä¸ª request æ—¶ï¼Œç”±äºç™»å½•é€»è¾‘æ˜¯å¼‚æ­¥çš„ï¼Œå°±ä¼šæœ‰å¯èƒ½å‡ºç°ä¸¤ä¸ª request éƒ½è¿›å…¥äº†ç™»å½•é€»è¾‘ã€‚ä¸ä»…æµªè´¹äº†ç½‘ç»œèµ„æºï¼Œè€Œä¸”è¿˜æœ‰å¯èƒ½å¯¼è‡´ä¸ªäººæ•æ„Ÿä¿¡æ¯çš„è§£å¯†å‡ºé”™ã€‚ æ‰§è¡Œè¿‡ç™»å½•é€»è¾‘åçš„çŠ¶æ€æ²¡æœ‰ä¿å­˜èµ·æ¥ï¼Œä¸Šæ–‡çš„ request å®ç°æ˜¯æ— çŠ¶æ€çš„ï¼Œé‚£æ„å‘³ç€ä»¥åæ¯æ¬¡è°ƒç”¨ request éƒ½ä¼šè°ƒç”¨ wx.checkSession è¿›è¡Œå¾®ä¿¡ç™»å½•æ€çš„æ£€æŸ¥ï¼Œè€Œè¿™ä¸æ˜¯æˆ‘ä»¬å¸Œæœ›çœ‹åˆ°çš„ï¼Œæ£€æŸ¥è¿‡ä»¥ååœ¨å½“å‰å°ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸé‡Œå°±ä¸åº”è¯¥å†å»æ£€æŸ¥äº†ã€‚ å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç±»ä¼¼é”çš„ä¸œè¥¿ï¼Œè®©ä»£ç åœ¨ç™»å½•é€»è¾‘ä¸­åªæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæ‰§è¡Œè¿‡äº†ç«‹å³è¿”å›ï¼Œæ²¡æ‰§è¡Œè¿‡å°±é©¬ä¸Šæ‰§è¡Œï¼Œæ‰§è¡Œä¸­åˆ™ç­‰å¾…ã€‚ Promise.raceæ²¡é”™ï¼åªéœ€è¦ç”¨ Promise.race - MDN å°±èƒ½å¿«é€Ÿåœ°è§£å†³æ‰ä¸Šé¢çš„é—®é¢˜ï¼ ä»€ä¹ˆæ˜¯ Promise.race ç›´ç™½åœ°è§£é‡Šä¸‹ï¼Œå°±æ˜¯ä¼ å…¥ä¸€ä¸ª Promise æ•°ç»„ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ Promiseï¼Œå½“ä¸”ä»…å½“æ•°ç»„ä¸­æœ‰ä¸€ä¸ª Promise resolve äº†ï¼Œæ–°çš„ Promise æ‰ä¼š resolve. // MDN ä¸Šçš„ä¾‹å­ï¼šç®€å•æ˜äº†var p1 = new Promise(function(resolve, reject) &#123; setTimeout(resolve, 500, \"one\"); &#125;);var p2 = new Promise(function(resolve, reject) &#123; setTimeout(resolve, 100, \"two\"); &#125;);Promise.race([p1, p2]).then(function(value) &#123; console.log(value); // \"two\" // ä¸¤ä¸ªéƒ½å®Œæˆï¼Œä½† p2 æ›´å¿«&#125;);var p3 = new Promise(function(resolve, reject) &#123; setTimeout(resolve, 100, \"three\");&#125;);var p4 = new Promise(function(resolve, reject) &#123; setTimeout(reject, 500, \"four\"); &#125;);Promise.race([p3, p4]).then(function(value) &#123; console.log(value); // \"three\" // p3 æ›´å¿«ï¼Œæ‰€ä»¥å®ƒå®Œæˆäº† &#125;, function(reason) &#123; // æœªè¢«è°ƒç”¨&#125;);var p5 = new Promise(function(resolve, reject) &#123; setTimeout(resolve, 500, \"five\"); &#125;);var p6 = new Promise(function(resolve, reject) &#123; setTimeout(reject, 100, \"six\");&#125;);Promise.race([p5, p6]).then(function(value) &#123; // æœªè¢«è°ƒç”¨ &#125;, function(reason) &#123; console.log(reason); // \"six\" // p6 æ›´å¿«ï¼Œæ‰€ä»¥å®ƒå¤±è´¥äº†&#125;); æ”¹é€ ç™»å½•é€»è¾‘ç”±äºç¬¬ä¸‰æ–¹ Session çŠ¶æ€æ£€æŸ¥ç›¸å¯¹è¾ƒè½»ï¼Œä¹Ÿå¯ä»¥å…è®¸å¹¶å‘é‡å…¥ï¼Œå› æ­¤å°±ä¸éœ€è¦æ”¹é€ ã€‚è€Œè°ƒç”¨ wx.checkSession æ£€æŸ¥å°ç¨‹åºç™»å½•æ€åˆ™å¯ä»¥ä½¿ç”¨ Promise.race æ”¹é€ ä¸€ä¸‹ã€‚ const checkWxSession = () =&gt; &#123; if (checkWxSessionPromise) &#123; return Promise.race([checkWxSessionPromise]); &#125; checkWxSessionPromise = new Promise((resolve) =&gt; &#123; wxWrapper.checkSession().then(() =&gt; &#123; resolve(true); &#125;).catch(() =&gt; &#123; resolve(false); &#125;); &#125;); return checkWxSessionPromise;&#125;; åŒç†ï¼Œå®é™…çš„ç™»å½•é€»è¾‘ doLogin ä¹Ÿå¯ä»¥é€šè¿‡è¿™æ ·ã€Œç¼“å­˜ã€èµ· Promise æ¥å®ç°åªæ‰§è¡Œä¸€æ¬¡ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå½“ Promise ç”Ÿæˆåå°±ä¸å†è¿›å…¥å®é™…çš„ç™»å½•é€»è¾‘äº†ï¼Œå½“ç™»å½•æˆåŠŸæˆ–å¤±è´¥æ—¶ï¼Œéœ€è¦é‡ç½®ç¼“å­˜çš„ Promise å¯¹è±¡ã€‚å¦å¤–æ£€æŸ¥å¾®ä¿¡ç™»å½•æ€çš„ç¼“å­˜ä¹Ÿéœ€è¦æ›´æ–°ã€‚ const doLogin = (globalUserInfo = &#123;&#125;) =&gt; &#123; if (loginPromise) &#123; return Promise.race([loginPromise]); &#125; loginPromise = new Promise((resolve, reject) =&gt; &#123; // ... çœç•¥å…·ä½“çš„ä¸šåŠ¡ä»£ç  wxWrapper.login().then(() =&gt; &#123; // å…è®¸ä»¥åé‡å…¥ doLogin loginPromise = null; // ç¼“å­˜èµ·å°ç¨‹åºç™»å½•æ€ï¼Œç™»é™†æˆåŠŸå°±é»˜è®¤è¿”å› true checkWxSessionPromise = Promise.resolve(true); resolve(); &#125;).catch(() =&gt; &#123; // å…è®¸ä»¥åé‡å…¥ doLogin loginPromise = null; reject(); &#125;) &#125;); return loginPromise;&#125; æ€»ç»“å¾®ä¿¡å°ç¨‹åºçš„å¼€å‘ä¸­éœ€è¦å¤„ç†å¾®ä¿¡æœ¬èº«çš„ç™»å½•æ€ä¸ç¬¬ä¸‰æ–¹çš„ç™»å½•æ€ï¼Œå› æ­¤æ•´ä¸ªçŠ¶æ€çš„ä¿æŒä¸ç»´æŠ¤é€»è¾‘éƒ½ç›¸å¯¹è¾ƒä¸ºå¤æ‚ï¼Œè¿™é‡Œè¿˜æ²¡æœ‰æ¶‰åŠåˆ°åªåˆ·æ–°ç¬¬ä¸‰æ–¹ç™»å½•æ€çš„æƒ…å†µï¼ˆå¾®ä¿¡ç™»å½•æ€æœªè¿‡æœŸç¬¬ä¸‰æ–¹ç™»å½•æ€è¿‡æœŸï¼‰ï¼Œè€Œæ˜¯ç»Ÿä¸€ä¸ºæ— è®ºè°è¿‡æœŸäº†ç»Ÿä¸€ä¸¤ä¸ªçŠ¶æ€ä¸€èµ·åˆ·æ–°ã€‚è¿™æ ·çš„å¤„ç†åœ¨æ•ˆç‡å’Œå¤æ‚åº¦æ¥è¯´åº”è¯¥æ˜¯å¯ä»¥æ¥å—çš„ã€‚ å¦å¤–å¦‚æœå°ç¨‹åºä¸­ä¸éœ€è¦æ¥å…¥å¾®ä¿¡ï¼Œæ¯”å¦‚æ˜¯ä¸€ä¸ªéœ€è¦è´¦å·å¯†ç ç™»å½•çš„åº”ç”¨ï¼Œé‚£å°±å¯ä»¥å®Œå…¨ä¸ä½¿ç”¨ wx.login è¿™ç§æ¥å£æ¥ç»´æŠ¤å¾®ä¿¡çš„ç™»å½•æ€äº†ï¼Œè‡ªå·±ç»´æŠ¤å³å¯ã€‚ å‚è€ƒèµ„æ–™ Github ä¸Šçš„è®¨è®º å°ç¨‹åº - å®˜æ–¹æ–‡æ¡£ wx.login weRequest","tags":[{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","permalink":"https://blog.imtouch.info/tags/å°ç¨‹åº/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://blog.imtouch.info/tags/å‰ç«¯/"}]},{"title":"ä½¿ç”¨ mpvue å¼€å‘å¾®ä¿¡å°ç¨‹åºè®°å½•","date":"2018-04-26T03:16:35.000Z","path":"2018/04/26/wechat-mpvue-log/","text":"æœ¬æ–‡è®°å½•äº†ä½¿ç”¨ mpvue å¼€å‘å¾®ä¿¡å°ç¨‹åºæ—¶é‡åˆ°çš„ä¸€äº›é—®é¢˜åŠè§£å†³æ–¹æ³•ã€‚ è·å–é¡µé¢è·¯ç”±å‚æ•°å®˜æ–¹æ–‡æ¡£å†™å¾—å¾ˆæ¸…æ¥šï¼Œå¼•ç”¨ä¸€ä¸‹ã€‚ 1. å¦‚ä½•è·å–å°ç¨‹åºåœ¨ page onLoad æ—¶å€™ä¼ é€’çš„ options åœ¨æ‰€æœ‰ é¡µé¢ çš„ç»„ä»¶å†…å¯ä»¥é€šè¿‡ this.$root.$mp.query è¿›è¡Œè·å–ã€‚ 2. å¦‚ä½•è·å–å°ç¨‹åºåœ¨ app onLaunch/onShow æ—¶å€™ä¼ é€’çš„ options åœ¨æ‰€æœ‰çš„ç»„ä»¶å†…å¯ä»¥é€šè¿‡ this.$root.$mp.appOptions è¿›è¡Œè·å–ã€‚ Page èƒŒæ™¯è‰²ä¸€å¼€å§‹ä»¥ä¸ºåœ¨ Vue ç»„ä»¶é‡ŒæŠŠæ ¹å…ƒç´ çš„èƒŒæ™¯è‰²å’Œ Page çš„ option è®¾ç½®å¥½å°±å¯ä»¥äº†ï¼Œæ¯”å¦‚è¿™æ · &lt;template&gt; &lt;div class=\"container\"&gt; &lt;/div&gt;&lt;/template&gt;&lt;style&gt; .container &#123; background-color: #EEEEEE; &#125;&lt;/style&gt; // main.jsimport Vue from 'vue';import MyPage from './my_page';const app = new Vue(MyPage);app.$mount();export default &#123; config: &#123; navigationBarTitleText: 'æŸä¸ªé¡µé¢', backgroundColor: '#EEEEEE' &#125;,&#125;; è¿™æ ·åªæœ‰ .container æ‰€åœ¨çš„ div æ˜¯æœ‰èƒŒæ™¯è‰²çš„ï¼Œå¦‚æœ .container æ²¡æœ‰è¢«æ’‘å¼€åˆ°ä¸€ä¸ªé¡µé¢è¿™ä¹ˆå¤§ï¼Œpage çš„èƒŒæ™¯è‰²è¿˜æ˜¯ç™½çš„ï¼Œå› æ­¤éœ€è¦å…¨å±€è®¾ç½® page çš„èƒŒæ™¯è‰² page &#123; background-color: #F4F5F5;&#125; template ä¸æ”¯æŒå‡½æ•°mpvue çš„æ–‡æ¡£ä¸­æåˆ°ï¼š ä¸æ”¯æŒåœ¨ template å†…ä½¿ç”¨ methods ä¸­çš„å‡½æ•°ã€‚ é‚£å°±ä¼šå¸¦æ¥å¾ˆå¤§çš„ä¸æ–¹ä¾¿ï¼Œæ¯”å¦‚æœ‰çš„æ—¶å€™éœ€è¦åœ¨ä¸€ä¸ª v-for é‡Œæ ¹æ®æŸäº›æ¡ä»¶æ¥æ˜¾ç¤ºæˆ–éšè—æŸä¸ª dom &lt;div class=\"option\" v-for=\"(option, index) in options\"&gt; &lt;span&gt;&#123;&#123;option.name&#125;&#125;&lt;/span&gt; &lt;span v-if=\"selectedOptionIds.includes(option.id)\"&gt; &lt;img src=\"/static/img/tick.png\" alt=\"\"&gt; &lt;/span&gt;&lt;/div&gt; è¿™é‡Œçš„ selectedOptionIds æ˜¯ä¸€ä¸ª id æ•°ç»„ï¼Œå¦‚æœå½“å‰é¡¹è¢«é€‰ä¸­äº†å°±æ˜¾ç¤ºä¸€ä¸ªæ‰“é’©çš„å›¾ç‰‡ï¼Œè™½ç„¶æ²¡æœ‰ä½¿ç”¨ methods é‡Œçš„å‡½æ•°ï¼Œä½†è¿™é‡Œè¿™æ ·å†™ä¾ç„¶æ˜¯ä¸è¡Œçš„ï¼ˆä¸çŸ¥é“æ˜¯ mpvue çš„ bug è¿˜æ˜¯çš„ç¡®ä¸æ”¯æŒï¼‰ã€‚ å½“æˆ‘çš„ seletedOptionIds æ˜¯ä¸€ä¸ªå•å…ƒç´ æ•°ç»„çš„æ—¶å€™ï¼Œç›´æ¥æŠŠ v-if æ”¹æˆ selectedOptionIds == option.idï¼Œæ•ˆæœå°±å‡ºæ¥äº†ï¼Œçœ‹æ¥çš„ç¡®æ˜¯ç”¨äº†ä¸€ä¸ªå‡½æ•°çš„é—®é¢˜ã€‚ å¯ä»¥é€šè¿‡å†æ–°å»ºä¸€ä¸ªå˜é‡æ¥è§£å†³ï¼Œè¿™ç§åŠ¨æ€åˆ¤æ–­è¯´åˆ°åº•å…¶å®ä¹Ÿæ˜¯å¯ä»¥åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŠŠåˆ¤æ–­çš„ flag å€¼å…ˆç®—å¥½ï¼Œç„¶åå† template é‡Œé€šè¿‡ flag åˆ¤æ–­ã€‚ &lt;template&gt; &lt;div class=\"option\" v-for=\"(option, index) in options\"&gt; &lt;span&gt;&#123;&#123;option.name&#125;&#125;&lt;/span&gt; &lt;span v-if=\"flags[index]\"&gt; &lt;img src=\"/static/img/tick.png\" alt=\"\"&gt; &lt;/span&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt; export default &#123; data() &#123; return &#123; options: [], selectedOptionIds: [], flags: [] &#125;; &#125;, onShow() &#123; // åˆå§‹åŒ– options/seletedOptionIds ... // åˆå§‹åŒ– flags this.flags = this.options .map(option =&gt; option.id) .map(id =&gt; this.selectedOptionIds.includes(id)); &#125; &#125;&lt;/script&gt; v-if/v-showç”±äº v-if ä¼šå®é™…åœ°åˆ›å»ºå’Œé”€æ¯å¯¹åº”çš„ DOMï¼Œè€Œ v-show æ€»æ˜¯åˆ›å»ºèŠ‚ç‚¹ï¼Œæœ‰äº›æ—¶å€™ä¼šå¯¼è‡´ä¸€äº›æ ·å¼ä¸Šçš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯åœ¨ DOM èŠ‚ç‚¹ä¸Šæœ‰åŠ¨æ€çš„æ ·å¼ç»‘å®šæ—¶ã€‚ åœ¨æ€§èƒ½æ–¹ä¾¿éœ€æ±‚ä¸é«˜æ—¶ï¼Œå¯æŒ‰éœ€ä½¿ç”¨ v-if æˆ– v-showã€‚ px/rpxmpvue-loader ä¸­ç”¨åˆ°äº† px2rpx-loader ä¼šè‡ªåŠ¨æŠŠ style é‡Œçš„ px å•ä½è‡ªåŠ¨è½¬æˆå°ç¨‹åºçš„ rpx å•ä½ï¼Œæœ‰äº›ä½¿ç”¨æˆ‘ä»¬å¹¶ä¸å¸Œæœ›ä½¿ç”¨ç›¸å¯¹çš„ rpx å•ä½ï¼Œç›®å‰è¿˜æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆåˆ‡å®çš„è§£å†³æ–¹æ³•ã€‚ å¦å¤–ï¼Œpx2rpxLoaderæ’ä»¶è¿™é‡Œæåˆ°çš„æ”¹å˜ loader é¡ºåºçš„æ–¹æ³•å¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ï¼Œä¼šæŠ¥é”™ã€‚å…¨éƒ¨è½¬æ¢çš„å½±å“ä¹Ÿä¸ä¼šå¾ˆå¤§ã€‚ å…è®¸é¡µé¢åˆ†äº«mpvue é»˜è®¤å¯¹æ‰€æœ‰é¡µé¢éƒ½å¼€äº†åˆ†äº«ï¼Œå¦‚æœä¸æƒ³å½“å‰ Page å‡ºç°åˆ†äº«èœå•ï¼Œå¯ä»¥å‚è€ƒå¦‚ä½•åœ¨vueä¸­è®¾ç½®å»æ‰è½¬å‘åŠŸèƒ½é‡Œçš„åšæ³•ã€‚ // FIXME mpvue å¯¹æ‰€æœ‰é¡µé¢é»˜è®¤å¼€äº†åˆ†äº«ï¼Œä¸åˆ†äº«çš„ workaroundonShareAppMessage() &#123; return &#123;&#125;;&#125;,onLoad() &#123; wx.hideShareMenu();&#125;, æ–°ç‰ˆæœ¬ mpvue å·²ç»å–æ¶ˆäº†å¯¹æ‰€æœ‰é¡µé¢å¼€å¯åˆ†äº«ï¼Œåªæœ‰å®šä¹‰äº† onShareAppMessage æ–¹æ³•æ‰ä¼šå¼€å¯åˆ†äº« TimePicker å›½é™…åŒ–å°ç¨‹åºæä¾›äº†ä¸€ä¸ª mode=time çš„æ—¶é—´ pickerï¼Œä¸€èˆ¬æ¥è¯´ä¸ä¼šå¯¼è‡´ä»€ä¹ˆå¾ˆå¤§çš„é—®é¢˜ã€‚ä½†ç”±äºè¿™ä¸ª picker ç›´æ¥è°ƒçš„æ˜¯ç³»ç»Ÿçš„æ—¶é—´é€‰æ‹©ï¼Œåœ¨ iOS ä¸‹å¦‚æœç”¨æˆ·çš„è¯­è¨€é€‰äº†æ—¥è¯­ï¼Œè¿™æ—¶ picker æ‹¿åˆ°çš„ value å°±ä¸å†æ˜¯ HH:mm è¿™ç§æ ¼å¼äº†ï¼Œè€Œæ˜¯åƒ &#39;14åˆå¾Œ2:30&#39; è¿™æ ·çš„å­—ç¬¦ä¸²ï¼Œæ„é€ å‡ºæ¥çš„ Date å­—ç¬¦ä¸²åç«¯è§£æä¸äº†ä¾¿æŠ¥é”™äº†ã€‚ è§£å†³åŠæ³•æ˜¯ç›´æ¥ä½¿ç”¨ mode=multiSelector çš„å¤šåˆ— picker æ›¿æ¢æ‰æ—¶é—´é€‰æ‹©å™¨ï¼Œè‡ªå®šä¹‰ hour å’Œ minute åˆ—ï¼ˆ0~23, 0~59ï¼‰ï¼Œä¸å†ä¾èµ–ç³»ç»Ÿè¯­è¨€çš„æ—¶é—´ã€‚ &lt;picker class=\"time-picker\" mode=\"multiSelector\" :range=\"timeRange\" :value=\"vote.deadlineTime\" @change=\"onTimeChange\"&gt; &lt;div class=\"time-value\"&gt; &#123;&#123;vote.deadlineTime[0] + ':' + vote.deadlineTime[1]&#125;&#125; &lt;/div&gt;&lt;/picker&gt;","tags":[{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","permalink":"https://blog.imtouch.info/tags/å°ç¨‹åº/"},{"name":"Vue","slug":"Vue","permalink":"https://blog.imtouch.info/tags/Vue/"}]},{"title":"LeetCode é¢˜è§£ä¸€","date":"2018-04-11T06:58:40.000Z","path":"2018/04/11/leetcode-idea-1/","text":"LeetCode é¢˜è§£ä¸€ã€‚ 621 Task Scheduleré¢˜ç›®å¤§æ„ï¼šCPU è°ƒåº¦ï¼Œç»™ä¸€ä¸²ç”¨ Char è¡¨ç¤ºçš„ä»»åŠ¡åˆ—è¡¨ï¼Œä¸€ä¸ªå‘¨æœŸè¿è¡Œä¸€ä¸ªï¼Œè§„å®šç›¸åŒä¸¤ä¸ªä»»åŠ¡ä¹‹é—´çš„è¿è¡Œé—´éš”ä¸èƒ½è¶…è¿‡ nï¼Œæ±‚æœ€å°‘éœ€è¦å¤šå°‘ä¸ªå‘¨æœŸèƒ½è·‘å®Œã€‚ ç”±äºä»»åŠ¡ä¹‹é—´åº”è¯¥æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥å°±ç”¨è´ªå¿ƒç®—æ³•å§ï¼Œæ¯æ¬¡ä»å¯ä»¥è¿è¡Œçš„ä»»åŠ¡ä¸­æ‹¿ä¸€ä¸ªå‡ºæ¥è·‘ï¼Œå¹¶è®°ä¸‹æœ€è¿‘ä¸€æ¬¡çš„è¿è¡Œæ—¶é—´ï¼ˆåˆ¤æ–­èƒ½å¦è¿è¡Œè¿™ä¸ªä»»åŠ¡æ—¶ç”¨åˆ°ï¼‰ï¼Œä¸€ç›´å¾ªç¯ç›´åˆ°å®Œæˆæ‰€æœ‰ä»»åŠ¡ã€‚ éœ€è¦ä¸¤å¼  k-v è¡¨ï¼Œä¸€å¼ è®°å½•æœ€è¿‘è¿è¡Œçš„æ—¶é—´ lastï¼Œä¸€å¼ è®°å½•å½“å‰æ‰€æœ‰ä»»åŠ¡è¿˜å‰©å¤šå°‘æ¬¡æ²¡å®Œæˆ remainï¼Œæ¯è½®å¾ªç¯æ‰¾å¯è¿è¡Œçš„ä»»åŠ¡ï¼š remain[task] &gt; 0 &amp;&amp; last[task] + n &lt; current è¿™æ ·ä¼šæŠ¥ EAï¼Œæƒ³äº†ä¸€ä¸‹è´ªå¿ƒæœ‰ç‚¹é—®é¢˜ï¼Œå¯¹äºä¸€äº›é«˜é¢‘ä»»åŠ¡åº”è¯¥é«˜ä¼˜å…ˆçº§æ‰§è¡Œï¼Œè·Ÿå®é™…æ“ä½œç³»ç»Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå› æ­¤åœ¨éå† remain è¡¨çš„æ—¶å€™åº”è¯¥æŒ‰å‰©ä½™æ¬¡æ•°ä»å¤§åˆ°å°éå†ï¼š for(let entry of Object.entries(remain).sort((p, n) =&gt; p[1] &lt; n[1])) &#123; // ...&#125; æœ€ååˆ¤æ–­ä»»åŠ¡æ˜¯å¦åšå®Œå¯ä»¥ç›´æ¥æŸ¥ remain è¡¨çœ‹çœ‹æ˜¯å¦å„é¡¹éƒ½æ˜¯ 0ï¼Œä½†å¯ä»¥å†é¢å¤–å»ºä¸€ä¸ªå˜é‡è¡¨ç¤ºå®é™…ä»»åŠ¡è¿è¡Œçš„æ¬¡æ•°ï¼Œè¿™æ ·æ¯æ¬¡åˆ¤æ–­å°±å¿«å¤šäº†ã€‚ 623 Add One Row to Treeé¢˜ç›®å¤§æ„ï¼šç»™ä¸€ä¸ªäºŒå‰æ ‘ï¼Œåœ¨ç¬¬ d å±‚æ·»åŠ ä¸€è¡ŒèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„å€¼ä¸º v é¢˜ç›®å…¶å®æŠŠç®—æ³•éƒ½å†™æ¸…æ¥šäº†ï¼Œå¯¹æ‰€æœ‰åœ¨ç¬¬ d-1 å±‚çš„éç©ºèŠ‚ç‚¹ï¼Œéƒ½æ–°å»ºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼ŒæŠŠåŸå·¦å­æ ‘ä½œä¸ºæ–°å·¦å­©å­çš„å·¦å­æ ‘ï¼›åŸå³å­æ ‘ä½œä¸ºæ–°å³å­©å­çš„å³å­æ ‘ï¼Œå³ï¼š const newLeftNode, newRightNode;newLeftNode.left = node.left;newRightNode.right = node.right;node.left = newLeftNode;node.right = newRightNode; å› æ­¤æ€è·¯å°±æ˜¯ç”¨é˜Ÿåˆ—åšå±‚æ¬¡éå†ï¼Œåˆ°æ ‘é«˜ä¸º d-1 æ—¶å¤„ç†ä¸€ä¸‹ï¼Œç›´æ¥æŠŠåŸ root è¿”å›ï¼ŒåŸåœ°å˜æ¢ã€‚ å†å¤„ç†ä¸€ä¸‹è¾¹ç•Œæ¡ä»¶ï¼ˆd = 1 æˆ–æ ‘é«˜+1ï¼‰å°±å¯ä»¥äº†ã€‚ 628 Maximum Product of Three Numbersé¢˜ç›®å¤§æ„ï¼šç»™ä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼Œæ‰¾å‡ºä¸‰ä¸ªæ•°ï¼Œä¹˜ç§¯æœ€å¤§ ä¹ä¸€çœ‹è¿™ä¸æ˜¯æœ‰ç‚¹ç®€å•å—ï¼Œéå†ä¸€éæ‰¾å‡ºæœ€å¤§çš„ä¸‰ä¸ªæ•°ï¼Œä¹˜ä¸€ä¸‹å°±å¥½äº†å•Šï¼Œç„¶åå°±ç–¯ç‹‚ WAâ€¦ æœ‰å„ç§ Corner Case è¦å¤„ç†.. ç»“æœä¸‰ä¸ªæ•°çš„æƒ…å†µæœ€åé€‰å‡ºçš„ç»“æœè‚¯å®šæ˜¯ä¸‰ä¸ªæ•°ï¼Œè¿™ä¸‰ä¸ªæ•°çš„ç¬¦å·åªæœ‰ 4 ç§æƒ…å†µï¼š æ­£æ­£æ­£ï¼šä¸‰ä¸ªæ­£æ•°åªè¦æ‰¾æœ€å¤§çš„ä¸‰ä¸ªæ•°ç›¸ä¹˜å°±è¡Œäº† æ­£æ­£è´Ÿï¼šè¿™ä¸‰ä¸ªæ•°ä¹˜ç§¯æ˜¯è´Ÿçš„ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°å‘¢ï¼Ÿè€ƒè™‘åŠ å…¥ä¸€ä¸ªæ­£æ•°ï¼Œæ­¤æ—¶æ•°ç»„é‡Œçš„æƒ…å†µæ˜¯ã€Œæ­£æ­£è´Ÿæ­£ã€ï¼Œé‚£ä¹ˆä¸‰ä¸ªæ­£æ•°çš„ä¹˜ç§¯å¿…å®šæ¯”è´Ÿæ•°è¦å¤§ï¼Œä¸ä¼šé€‰å‡ºã€Œæ­£æ­£è´Ÿã€ï¼›è€ƒè™‘åŠ å…¥ä¸€ä¸ªè´Ÿæ•°ï¼Œæ­¤æ—¶æ•°ç»„é‡Œçš„æƒ…å†µæ˜¯ã€Œæ­£æ­£è´Ÿè´Ÿã€ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡é€‰æ‹©ã€Œæ­£è´Ÿè´Ÿã€æ¥ä½¿æœ€ç»ˆç»“æœä¸ºæ­£æ•°ï¼Œä¹Ÿä¸ä¼šé€‰å‡ºã€Œæ­£æ­£è´Ÿã€ã€‚å› æ­¤é€‰å‡ºè¿™ä¸‰ç§æ•°çš„å”¯ä¸€æƒ…å†µæ˜¯ï¼šåªæœ‰ä¸‰ä¸ªæ•°ï¼Œè¿™ä¸‰ä¸ªæ•°çš„ç¬¦å·åˆ†åˆ«ä¸ºã€Œæ­£æ­£è´Ÿã€ã€‚ æ­£è´Ÿè´Ÿï¼šä¹˜ç§¯ä¸ºæ­£ï¼Œæ‰¾æœ€å¤§çš„æ­£æ•°å’Œç»å¯¹å€¼æœ€å¤§çš„ä¸¤ä¸ªè´Ÿæ•°å°±è¡Œäº† è´Ÿè´Ÿè´Ÿï¼šä¹˜ç§¯ä¸ºè´Ÿï¼ŒåŒæ ·è€ƒè™‘ä»€ä¹ˆæƒ…å†µå‡ºç°ã€‚è€ƒè™‘åŠ ä¸€ä¸ªæ­£æ•°ï¼Œæ­¤æ—¶ã€Œè´Ÿè´Ÿè´Ÿæ­£ã€ï¼Œä¸ä¼šé€‰å‡ºã€Œè´Ÿè´Ÿè´Ÿã€ï¼›åŠ ä¸€ä¸ªè´Ÿæ•°ï¼Œæ­¤æ—¶ã€Œè´Ÿè´Ÿè´Ÿè´Ÿã€ï¼Œè´Ÿæ•°éœ€è¦æ‰¾ç»å¯¹å€¼æœ€å°ï¼ˆä¹Ÿå°±æ˜¯æœ€å¤§ï¼‰çš„ä¸‰ä¸ªæ•°ä¹˜ç§¯ æ‰€ä»¥é¢å¤–å¤„ç† 2 å’Œ 4ï¼Œå…¶ä»–æƒ…å†µç»“æœå°±æ˜¯ 1ã€3 ä¸­çš„æœ€å¤§å€¼ã€‚ 0 çš„å¤„ç†è¿™æ ·ä¸‹æ¥è¿˜æ˜¯ä¸èƒ½ ACï¼Œå¯¹äº [0, 0, 0, 4] æ²¡å¤„ç†å¥½ï¼Œè¿™é‡Œé€šè¿‡è®¡ç®—é 0 æ•°å­—ä¸ªæ•°å†æ¥å¤„ç†ï¼š 3 ä¸ªæˆ–ä»¥ä¸Šé 0 æ•°å­—ï¼Œå°±æ˜¯å‰é¢çš„æƒ…å†µ 3 ä¸ªä»¥ä¸‹é 0 æ•°å­—ï¼Œç»“æœå¿…ä¸º 0ï¼Œå› ä¸ºä¸€å®šä¼šé€‰åˆ° 0 è¿™æ ·å°± ok äº†ã€‚","tags":[{"name":"LeetCode","slug":"LeetCode","permalink":"https://blog.imtouch.info/tags/LeetCode/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://blog.imtouch.info/tags/ç®—æ³•/"}]},{"title":"JavaScript ä¸­çš„éšå¼ç±»å‹è½¬æ¢çš„è§„èŒƒ","date":"2018-04-02T02:29:09.000Z","path":"2018/04/02/implicit-type-conversion-in-javascript/","text":"æœ¬æ–‡ä» ECMAScript è§„èŒƒçš„è§’åº¦å°è¯•å¾æœ JavaScript çš„çœŸå€¼è¡¨ï¼å…¨æ–‡éƒ½æ˜¯è§„èŒƒï¼Œä¸è¦æ–¹ï¼Œæ­£é¢åˆšï¼ å°è¯•ç‰›åˆ€å¦‚æœä½ èƒ½æŠŠä¸‹é¢çš„æ‰€æœ‰é¢˜ç›®éƒ½ç­”å¯¹å¹¶è§£é‡Šæ¸…æ¥šæ¥é¾™å»è„‰ï¼Œæ­å–œä½ ï¼Œä½ å·²ç»æ˜¯å¤§ç¥çº§åˆ«äº†ï¼ç­”æ¡ˆå°±è¯·è‡ªè¡Œæ‰¾ä¸ª Console å®é™…æ•²æ•²ï¼ŒBelieve meï¼Œä½ ä¼šå¤§åƒä¸€æ–¤çš„ã€‚ // æ¯ä¸ªè¡¨è¾¾å¼æ˜¯ true è¿˜æ˜¯ false å‘¢ï¼Ÿä¸ºå•¥å‘¢ï¼Ÿ// åˆé˜¶!&#123;&#125;12 == '12''false' == falsenull == undefined// é«˜é˜¶[] == [][] == false[] === false[45] == 45// ç»ˆé˜¶[45] &lt; [46][10] &lt; [9]&#123;&#125; == !&#123;&#125;&#123;&#125; != &#123;&#125;-0 === +0NaN === NaNNaN != NaN æ·±å…¥è§„èŒƒæ±Ÿæ¹–ä¼ é—» JavaScript æœ‰å¼ è®©äººé—»é£ä¸§èƒ†çš„çœŸå€¼è¡¨ï¼Œæˆ‘è§‰å¾—å§åªè¦æŠŠæ¯ç§ç±»å‹æ˜¯æ€ä¹ˆåˆ¤æ–­çš„å¼„æ¸…æ¥šï¼Œå…¶å®æ˜¯ä¸éœ€è¦å»è®°å¿†è¿™æ ·çš„è¡¨çš„ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦äº†è§£è§„èŒƒé‡Œæ˜¯æ€ä¹ˆå¤„ç†è¿™äº›è¡¨è¾¾å¼çš„ã€‚ JavaScript çœŸå€¼è¡¨ è§„èŒƒä¸­å…³äºä¸Šé¢é‚£å †è¡¨è¾¾å¼æ˜¯æ€æ ·æ±‚å€¼çš„æœ‰å¥½å‡ å¤„åœ°æ–¹çš„è¯´æ˜ï¼ŒåŒ…æ‹¬ 7.1 Type Conversion 7.2 Testing and Comparison Operations 12.5.9 Logical NOT Operator ( ! ) 12.10 Relational Operators Type ConversionBuilt-in Typesè¿™éƒ¨åˆ†è§„å®šäº†ä¸åŒ Type ä¹‹é—´è½¬æ¢æ—¶ï¼Œåº”è¯¥å¦‚ä½•è¿›è¡Œè½¬æ¢ã€‚åœ¨æ­¤ä¹‹å‰éœ€è¦äº†è§£ ECMAScript åˆ°åº•å®šä¹‰äº†å¤šå°‘ç§ Typeï¼Ÿ ECMAScript ä¸€å…±å®šä¹‰äº†ä¸ƒç§ built-in typesï¼Œå› æ­¤åœ¨èŠ‚ 6.1 ECMAScript Language Types å…±æœ‰ä¸ƒä¸ªå°èŠ‚ï¼Œåˆ†åˆ«è¯¦ç»†è§£é‡Šä¸ƒç§ç±»å‹ã€‚ å…¶ä¸­å…­ç§ç±»å‹ä¸º Primitive Value.ï¼ˆä½™æ–‡æ‰€æœ‰åŠ ç²—çš„ç±»å‹å‡è¡¨ç¤º ECMAScript Language Typeï¼Œæ²¡æœ‰åŠ ç²—è¡¨ç¤º JavaScript ä¸­çš„ç±»å‹ï¼‰ A primitive value is a member of one of the following built-in types: Undefined, Null, Boolean, Number, String, and Symbol; an object is a member of the built-in type Object; and a function is a callable object. æƒ³å»äº†è§£è¯¦æƒ…çš„å¯ä»¥å»çœ‹çœ‹è§„èŒƒï¼Œé‡Œé¢å…³äº Number ç±»å‹çš„è§£é‡Šä¼šè®©äººè±ç„¶å¼€æœ—çš„ã€‚è¿™é‡Œåªéœ€è¦çŸ¥é“ null è¿™ä¸ªå€¼æ˜¯å±äº Null ç±»å‹ï¼Œè€Œ undefined æ˜¯å±äº Undefined ç±»å‹çš„ã€‚ å¦å¤–è¿™é‡Œçš„ Object built-in type è·Ÿæˆ‘ä»¬å¹³å¸¸ç†è§£çš„ JavaScript é‡Œçš„ Object å¹¶ä¸ä¸€æ ·ï¼Œæ€»çš„æ¥è¯´åªè¦ä¸å±äº Primitive Value çš„å€¼ï¼Œå°±å±äº Object ç±»å‹ã€‚æ¯”å¦‚å¼€å‘ä¸­å¸¸è§çš„æ•°ç»„ã€å¯¹è±¡ã€Dateã€RegExp ç­‰åœ¨ ECMAScript ä¸­å‡å±äº Object ç±»å‹ã€‚ ToPrimitiveToPrimitive ç”¨äºå°† Object è½¬ä¸º Primitive Value ToPrimitive å…ˆå¿½ç•¥é‚£å † preferredType çš„ä¸œè¥¿ï¼Œå¯¹äºå¹³å¸¸é‡åˆ°çš„å¯¹è±¡ï¼ˆObjectï¼‰æ¥è¯´ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ Ordinary çš„ï¼Œæ‰€ä»¥å…¶å®å°±æ˜¯é»˜è®¤äº† hint = number å†å»è°ƒç”¨ OrdinaryToPrimitiveã€‚ OrdinaryToPrimitive ç”±äºè¿›æ¥çš„ hint æ˜¯ number æ‰€ä»¥è¿™ä¸ªè½¬æ¢å°±æ˜¯ï¼š è°ƒç”¨ Object.valueOfï¼Œå¦‚æœç»“æœæ˜¯ Primitive Valueï¼Œåˆ™è¿”å› è°ƒç”¨ Object.toStringï¼Œå¦‚æœç»“æœæ˜¯ Primitive Valueï¼Œåˆ™è¿”å› éƒ½ä¸æ˜¯ï¼Œè¿”å› TypeError å¦‚æœçœ‹è¿‡çº¢å®ä¹¦çš„è¯ï¼Œé‡Œé¢å…¶å®ä¹Ÿè®²åˆ°è¿™éƒ¨åˆ†å†…å®¹ï¼Œè¿™é‡Œå¯ä»¥ä»è§„èŒƒçš„è§’åº¦å†ä¸€æ¬¡è¯´æ˜ã€‚ ç„¶åæ¥çœ‹çœ‹æ™®é€šå¯¹è±¡å’Œæ•°ç»„çš„è¿™ä¸¤ä¸ªæ–¹æ³•è¿”å›çš„æ˜¯ä»€ä¹ˆã€‚ var a = [12]var b = &#123;a: 123&#125;// [12]a.valueOf()// '12'a.toString()// &#123;a: 123&#125;b.valueOf()// '[object Object]'b.toString() å¯ä»¥çœ‹åˆ°ä¸¤è€…çš„ valueOf è¿”å›çš„éƒ½ä¸æ˜¯ Primitive Valueï¼ˆè¿”å›äº†è‡ªèº«ï¼Œè¿˜æ˜¯å±äº Object ç±»å‹ï¼‰ï¼Œæ ¹æ®è§„èŒƒä¸¤è€…è°ƒç”¨ ToPrimitive è¿”å›çš„å°†æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ ToBooleanè¿™ä¸ªæ–¹æ³•ç”¨äºå°†ä¸æ˜¯ Boolean ç±»å‹çš„å€¼è½¬æ¢ä¸º Boolean ç±»å‹ã€‚ ToBoolean æ³¨æ„å‡ ç‚¹å°±å¯ä»¥äº†ï¼š æ‰€æœ‰ Object ç±»å‹éƒ½ä¼šè¢«è½¬æ¢ä¸º true Number ç±»å‹ä¸­çš„ 0ã€NaN ä¼šè¢«è½¬æ¢ä¸º falseï¼Œå…¶ä»–éƒ½æ˜¯ true åªæœ‰ç©ºä¸²æ‰ä¸º falseï¼Œå…¶ä»–éƒ½æ˜¯ trueï¼ˆ&#39;false&#39;/&#39;0&#39; ä¹‹ç±»çš„ä¸è¦æé”™ï¼‰ ToNumberåŒç†ï¼Œå…¶ä»–ç±»å‹è½¬æ¢ä¸º Number ç±»å‹ã€‚ ToNumber æœ‰æ¯”è¾ƒè¯¡å¼‚çš„å‡ ç‚¹ï¼š undefined ä¼šè¢«è½¬ä¸º NaNï¼›è€Œ null æ˜¯è½¬ä¸º +0 true è½¬ä¸º 1ï¼›false è½¬ä¸º +0ï¼ˆè¿™ä¸ªå¾ˆé‡è¦ï¼‰ String çš„è½¬æ¢ç­–ç•¥ä¸æ˜¯æœ¬æ–‡çš„é‡ç‚¹ï¼Œå¯ä»¥å…ˆç†è§£ä¸ºæ»¡è¶³æ•°å­—è¯­ä¹‰ï¼ˆå³è§„èŒƒä¸‹æ–‡çš„ StringNumericLiteralï¼‰çš„å°±è½¬æ¢æˆæ•°å­—ï¼Œä¸ç¬¦åˆå°±æ˜¯ NaN Object ç±»å‹çš„è½¬æ¢ï¼Œçœ‹åˆ°äº†æˆ‘ä»¬çš„è€æœ‹å‹ ToPrimitive äº†æ²¡ï¼Ÿå…ˆè½¬æˆ Primitive Valueï¼Œå†é€’å½’è°ƒç”¨è‡ªèº« ToNumber æ¥åšè½¬æ¢çš„ åˆ°äº†è¿™ä¸€æ­¥ï¼Œçœ‹çœ‹æ˜¯å¦ç†è§£äº†ï¼Ÿ // '56' ==&gt; 56Number([56])// ',56' ==&gt; NaNNumber([,56])// '55,56' ==&gt; NaNNumber([55, 56]) è¿™é‡Œçš„è½¬æ¢æ˜¯åˆ†ä¸¤æ­¥çš„ï¼Œå…ˆè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå†è½¬æ¢æˆæ•°å­—ï¼Œè¿™ä¸ªå¾ˆé‡è¦ã€‚ Logical NOT Operatoräº†è§£å®Œä¸Šé¢å‡ ä¸ªè½¬æ¢åå°±å¯ä»¥æ¥çœ‹é‚£ä¸€å †è¡¨è¾¾å¼äº†ï¼é¦–å…ˆæ˜¯ç®€å•ç‚¹çš„å•ç›®é€»è¾‘éï¼Œè§„èŒƒæ˜¯è¿™æ ·çš„ï¼š Logical NOT Operator å“‡å“¦ï¼Œå°±æ˜¯ç›´æ¥è°ƒç”¨äº† ToBooleanï¼Œç„¶åå–åè¿”å›ã€‚ // [] ==&gt; true; false![] // &#123;&#125; ==&gt; true; false!&#123;&#125;// NaN ==&gt; false; true!NaN å—¯ï¼Œåº”è¯¥æ²¡ä»€ä¹ˆå¤§é—®é¢˜ã€‚ Comparison Operationså¤§ boss æ¥äº†ï¼Œæœ‰ä¸å°‘æ–‡ç« éƒ½æœ‰ä»‹ç» == å’Œ === çš„å¼‚åŒï¼Œç›´æ¥çœ‹è§„èŒƒä¾ç„¶æ˜¯æœ€å¥½çš„ã€‚ Evaluation Evaluation GetValue å°±æ˜¯è®¡ç®—ä¸€ä¸‹è¡¨è¾¾å¼çš„å€¼ï¼Œ== å’Œ === çš„ç»“æœé‡ç‚¹åœ¨ Abstract Equality Comparison å’Œ Strict Equality Comparison è¿™ä¸¤ä¸ªæ“ä½œé‡Œã€‚ å¦å¤– != å’Œ !== åˆ™æ˜¯æŒ‡å‡ºäº† A != B ä¸ !(A == B) æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚åœ¨åˆ¤æ–­ !=/!== æ—¶ï¼Œå…¶å®å°±æ˜¯åœ¨åˆ¤æ–­ ==/===. Abstract Equality Comparison Abstract Equality Comparison å¥½é•¿å•Šï¼Œä¸è¦æ…Œï¼Œä¸­æ–‡ç¿»è¯‘ä¸€ä¸‹ï¼š å¦‚æœ Type ç›¸åŒï¼Œç­‰ä»·ä¸º A === B ç‰¹åˆ«åœ°ï¼Œundefined == null String == Numberï¼Œåˆ™æŠŠ String è½¬æ¢æˆ Number æœ‰ Boolean å€¼çš„ï¼Œå°† Boolean è½¬æ¢æˆ Number Object == String/Number/Symbolï¼Œå°† Object è½¬æ¢æˆ Primitive Value å¦åˆ™ï¼Œè¿”å› false ç»“åˆå°è¯•ç‰›åˆ€çš„ä¾‹å­æ¥è¯´æ˜ // '12' ==&gt; 12; // è¿”å› true12 == '12'// è½¬ boolean: [] == 0// è½¬ object: '' == 0// è½¬ string: 0 == 0// è¿”å› true[] == false// è½¬ object: '45' == 45// è½¬ string: 45 == 45// è¿”å› true[45] == 45// å•ç›®: &#123;&#125; == false// è½¬ boolean: &#123;&#125; == 0// è½¬ object: '[object Object]' == 0// è½¬ string: NaN == 0// è¿”å› false&#123;&#125; == !&#123;&#125; å¯èƒ½æœ‰éƒ¨åˆ†åŒå­¦å¯¹äº [] == false çš„è½¬æ¢è¿‡ç¨‹ä¸­å±…ç„¶ä¼šå‡ºç° &#39;&#39; == 0 è¿™ä¸€æ­¥æ„Ÿåˆ°è¯§å¼‚ï¼Œå•Šï¼ç©ºæ•°ç»„ä¸æ˜¯ç›´æ¥å°±è½¬æˆæ•°å­— 0 çš„å—ï¼Œç„¶åè·Ÿ 0 æ¯”è¾ƒçš„å—ï¼Ÿ åŒæ ·ä½¿äººå›°æƒ‘çš„è¿˜æœ‰ 0 == {} è¿™ä¸ªè½¬æ¢è¿‡ç¨‹ä¸­ä¼šå‡ºç°çš„ &#39;[object Object]&#39; ï¼ŒåŸå› æ˜¯ï¼Œæœ€åå°† Object è½¬æ¢ä¸º Primitive Value è°ƒç”¨çš„ ToPrimitiveï¼Œåœ¨å‰æ–‡å·²ç»æåˆ°ï¼Œå¯¹äºæ•°ç»„å’Œæ™®é€šå¯¹è±¡è€Œè¨€ï¼Œè½¬æ¢å‡ºæ¥çš„æ˜¯ Stringï¼Œè€Œä¸æ˜¯ Numberã€‚ä¸ºäº†è¯æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°è¯•æ”¹å†™ Object æˆ– Array ä¸Šçš„ valueOf æ–¹æ³•å’Œ toString æ–¹æ³•ã€‚ console.log([] == false)Array.prototype.toString = function () &#123; return '1'&#125;console.log([] == false)console.log([] == 1) å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡çš„è¾“å‡ºæ˜¯ä¸ä¸€æ ·çš„ï¼Œè¦†ç›–äº†é»˜è®¤çš„ toString æ–¹æ³•åï¼Œ[] == 1 è¾“å‡ºäº† trueï¼Œå› ä¸ºæ­¤æ—¶æ•°ç»„çš„ ToPrimitive æ–¹æ³•è¿”å›çš„æ˜¯å­—ç¬¦ä¸² &#39;1&#39;ï¼ŒåŒç† Object çš„æƒ…å†µä¹Ÿæ˜¯å¦‚æ­¤ã€‚ï¼ˆé¡ºä¾¿å¯ä»¥éªŒè¯ valueOf ç¡®å®æ˜¯ä¼˜å…ˆäº toString æ–¹æ³•çš„ï¼‰ console.log('[object Object]' == &#123;&#125;)Object.prototype.toString = function () &#123; return '1'&#125;Object.prototype.valueOf = function () &#123; return '2'&#125;console.log('[object Object]' == &#123;&#125;)console.log(1 == &#123;&#125;)console.log(2 == &#123;&#125;) Strict Equality Comparison Strict Equality Comparison ç±»å‹ä¸åŒï¼Œç›´æ¥è¿”å› false Number ç±»å‹åˆ¤æ–­ï¼šæœ‰ NaN å°± falseï¼›+0 === -0ï¼› æœ€åè°ƒç”¨ SameValueNonNumber SameValueNonNumber æ€»çš„æ¥è¯´ï¼Œä¸¥æ ¼ç›¸ç­‰æ²¡æœ‰éä¸¥æ ¼ç›¸ç­‰è¿™ä¹ˆå¤šæƒ…å†µè·Ÿè½¬æ¢ï¼ˆæ¯•ç«Ÿå°±æ˜¯åŒä¸€ç±»å‹äº†ï¼‰ï¼Œè®°ä½äº† NaN çš„ corner case å’Œå¯¹è±¡å¼•ç”¨æœ¬èº«ç›¸ç­‰æ‰æ˜¯ true å°± ok äº†ã€‚ // ç±»å‹ç›¸åŒï¼Œç­‰ä»·äº [] === []// è¿”å› false[] == []// ç­‰ä»·äº !(&#123;&#125; == &#123;&#125;)// ç­‰ä»·äº !(&#123;&#125; === &#123;&#125;)// è¿”å› true&#123;&#125; != &#123;&#125;// ç­‰ä»·äº !(NaN == NaN)// ç­‰ä»·äº !(NaN === NaN)// è¿”å› trueNaN != NaN// ç±»å‹ä¸åŒï¼Œè¿”å› false[] === false Relational Operatorsææ‚äº†ç›¸ç­‰ï¼Œä¸ç­‰æ€ä¹ˆåŠï¼Ÿä¸ç­‰å…³ç³»æ˜¯ç”± Abstract Relational Comparison å®šä¹‰çš„ã€‚ Abstract Relational Comparison è¿™ä¸ªæ˜¯çœŸçš„é•¿ï¼Œå…¶å®æ³¨æ„ä¸¤ç‚¹å°±å¯ä»¥äº† ä¸¤è¾¹æ“ä½œæ•°è°ƒç”¨ ToPrimitive è½¬æ¢ä¸º Primitive Value ç”±äº Primitive Value å‡ºæ¥æœ‰ String å’Œ Number ä¸¤ç§ç»“æœï¼Œåˆ†åˆ«æœ‰ä¸åŒçš„æ¯”è¾ƒè§„åˆ™ï¼›String æŒ‰ code unit æ¯”è¾ƒï¼ŒNumber éœ€è¦å¤„ç† +0/-0/NaN/Infinity ç­‰æƒ…å†µ è§£é‡Šä¸‹ä¸Šé¢çš„é¢˜ç›® // æ³¨æ„è½¬æ¢åä¸º '45' &lt; '46'// æŒ‰å­—ç¬¦ä¸²è§„åˆ™æ¯”è¾ƒï¼Œè¿”å› true[45] &lt; [46]// åŒç† '10' &lt; '9'ï¼Œåˆ™æ˜¯è¿”å› false[10] &lt; [9] æŒ‡å¯¼æ„ä¹‰äº†è§£è¿™äº›å¯¹å®é™…å¼€å‘å·¥ä½œæœ‰ä»€ä¹ˆç°å®æ„ä¹‰å—ï¼Ÿé¢ï¼Œå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰çš„ï¼Œå¤§å¤šéƒ½æ˜¯å„ç§é¢è¯•é¢˜ï¼ˆç¬‘ã€‚ ä½†äº†è§£èƒŒåçš„åŸç†å¯¹äºä¸€äº›å…³äºç±»å‹è½¬æ¢å¸¦æ¥çš„ Bug çš„å®šä½å’Œå¦‚ä½•å»åšå®é™…ç¼–ç ä¸­çš„æœ€ä½³å®è·µèƒ½æä¾›å¾ˆå¤§çš„å¸®åŠ©ã€‚ä¸¾ä¸¤ä¸ªğŸŒ° åˆå§‹åŒ–è®¢å•å§ã€‚ if (!$scope.orders) &#123; $http.post('/api/orders', $scope.params).then(res =&gt; &#123; $scope.orders = res.data &#125;)&#125; ç„¶è€Œæœ‰äººå¾ˆæœ‰è´£ä»»æ„Ÿåœ°è¿›è¡Œäº†æ•°æ®åˆå§‹åŒ–ï¼š$scope.orders = []ï¼ŒGGï¼ ç”¨æˆ·æ²¡æœ‰é€‰æ‹©çŠ¶æ€å°±å¼¹å‡ºæç¤ºã€‚ if (!this.editForm.status) &#123; this.warning('è¯·é€‰æ‹©çŠ¶æ€')&#125; è¿™ä¸ä¼šæ˜¯ä¸ªæ•°ç»„äº†å§ï¼Œå¾ˆä¸å¹¸ï¼Œåç«¯åŒå­¦å®šä¹‰çš„ status é‡Œæœ‰ä¸ª 0â€¦æœ‰ä¸ª 0..æœ‰ä¸ª 0. å‚è€ƒ ECMAScriptÂ® 2017 Language Specification (ECMA-262, 8th edition, June 2017) èŠèŠç±»å‹è½¬æ¢","tags":[{"name":"ECMAScript","slug":"ECMAScript","permalink":"https://blog.imtouch.info/tags/ECMAScript/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://blog.imtouch.info/tags/JavaScript/"},{"name":"è§„èŒƒ","slug":"è§„èŒƒ","permalink":"https://blog.imtouch.info/tags/è§„èŒƒ/"},{"name":"ç±»å‹è½¬æ¢","slug":"ç±»å‹è½¬æ¢","permalink":"https://blog.imtouch.info/tags/ç±»å‹è½¬æ¢/"}]},{"title":"Leaflet MovingMarker è½¨è¿¹å›æ”¾åŠŸèƒ½","date":"2018-03-12T03:42:33.000Z","path":"2018/03/12/leaflet-moving-marker/","text":"æœ€è¿‘æœ‰ä¸€ä¸ªå…³äºåœ°å›¾è½¨è¿¹å›æ”¾çš„åŠŸèƒ½ï¼Œä½¿ç”¨äº† Leaflet çš„ MovingMarker æ’ä»¶åä»æœ‰ä¸å°‘é—®é¢˜éœ€è¦è§£å†³ï¼Œæœ¬æ–‡ä»‹ç»äº†å®ç°è¿™ä¸ªéœ€æ±‚çš„è¿‡ç¨‹ä¸æ–¹æ¡ˆã€‚ æ¥è‡ªäº§å“çš„éœ€æ±‚è½¨è¿¹å›æ”¾å¾€å¤§äº†è®²å…¶å®æœ‰ç‚¹åƒè§†é¢‘æ’­æ”¾å™¨ï¼Œæœ‰ä¸€ä¸ªå¯æ‹–åŠ¨çš„æŒ‡ç¤ºå™¨ï¼Œåœ°å›¾ä¸Šå°±æ˜¯ä¸€ä¸ªç§»åŠ¨çš„ marker.ï¼ˆè¿™é‡Œæœ‰å¼  10M çš„åŠ¨å›¾â€¦ï¼‰ æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„ï¼š æ’­æ”¾è¿‡ç¨‹ä¸­å¯ä»¥æš‚åœï¼Œæš‚åœåå¯ä»¥ä»å½“å‰ä½ç½®ç»§ç»­æ’­æ”¾ æ’­æ”¾è¿‡ç¨‹ä¸­å¯ä»¥æ‹–åŠ¨æŒ‡ç¤ºå™¨ï¼Œåœ°å›¾ä¸Šçš„ç‚¹ä¹Ÿéœ€è¦ç›¸åº”åœ°å‡ºç°åœ¨å¯¹åº”çš„ä½ç½®ï¼Œä½†åŠ¨ç”»ä¼šç»§ç»­æ’­æ”¾ï¼Œå°±åƒæ‹–åŠ¨æ’­æ”¾å™¨çš„è¿›åº¦æ¡ä¸€æ · åŒä¸Šï¼Œæš‚åœè¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥æ‹–åŠ¨æŒ‡ç¤ºå™¨ï¼Œä½†æ­¤æ—¶åŠ¨ç”»ä¸å†æ’­æ”¾ æ–¹æ¡ˆ1ï¼šç›´æ¥åŠ¨ç”»è½¨è¿¹å…¶å®å°±æ˜¯å¯¹ä¸€ä¸ª Marker åšä¸€ä¸ªåŠ¨ç”»ï¼Œç”¨ä½œå±•ç¤ºï¼Œç›®å‰ Leaflet å·²ç»æœ‰å¯¹åº”çš„ç§»åŠ¨ç‚¹æ’ä»¶ MovingMarkerï¼Œä½¿ç”¨ä¸Šä¹Ÿéå¸¸ç®€å•ï¼Œä¼ å…¥ä¸€å †ç‚¹åæ ‡å’ŒæŒç»­æ—¶é—´ï¼Œè°ƒç”¨ä¸€ä¸‹ start() æ–¹æ³•å°±é©¬ä¸Šæœ‰åŠ¨ç”»å‡ºæ¥äº†ã€‚å®˜ç½‘ä¸Šçš„ä¾‹å­ï¼š var myMovingMarker = L.Marker.movingMarker([[48.8567, 2.3508],[50.45, 30.523333]], [20000]).addTo(map);myMovingMarker.start(); è¿™æ ·å°±èƒ½å®ç°åœ°å›¾ä¸Šçš„ä¸€ä¸ªå¯ä»¥ç§»åŠ¨çš„ç‚¹ã€‚ ä½†æˆ‘ä»¬ä¸å…‰éœ€è¦åœ°å›¾ä¸Šçš„åæ ‡ç‚¹èƒ½å¤Ÿè¿åŠ¨ï¼Œè¿˜éœ€è¦åº•ä¸‹çš„æŒ‡ç¤ºå™¨èƒ½æ ¹æ®åœ°å›¾ç‚¹çš„ç§»åŠ¨ä½œå‡ºç›¸åº”çš„å˜åŒ–ï¼Œæ¯”å¦‚ç§»åŠ¨åˆ°ç¬¬äºŒä¸ªç‚¹çš„æ—¶å€™ï¼ŒæŒ‡ç¤ºå™¨ä¹Ÿè¦åŒæ—¶æ˜¾ç¤ºä¸ºç¬¬äºŒä¸ªç‚¹ã€‚ ç¬¬ä¸€ä¸ªæƒ³æ³•å°±æ˜¯é€šè¿‡äº‹ä»¶æ¥è§£å†³ï¼Œåœ¨åŠ¨ç”»çš„è¿‡ç¨‹ä¸­ç›‘å¬ã€Œç§»åŠ¨åˆ°æŸä¸ªç‚¹ã€çš„äº‹ä»¶ï¼Œæ”¹å˜ä¸€ä¸‹æŒ‡ç¤ºå™¨çš„å½“å‰å€¼å°± ok äº†ã€‚ç„¶è€Œå¾ˆä¸å¹¸çš„æ˜¯ï¼ŒMovingMarker æ²¡æœ‰æä¾›è¿™æ ·çš„äº‹ä»¶ï¼Œå®é™…ä¸Š API ä¸Šæœ‰è¿™æ ·çš„ä¸€ä¸ªäº‹ä»¶ï¼š end: fired when the marker stops ä½†è¿™ä¸ªäº‹ä»¶æ˜¯åœ¨æ•´æ®µåŠ¨ç”»ç»“æŸåæ‰è§¦å‘çš„ï¼Œåªä¼šè§¦å‘ä¸€æ¬¡ã€‚ä¸¾ä¸ªæ —å­ï¼Œå¦‚æœæœ‰ä¸€æ®µäº”ä¸ªç‚¹çš„è½¨è¿¹æ’­æ”¾ï¼Œåªæœ‰å½“åŠ¨ç”»æ’­æ”¾åˆ°æœ€åä¸€ä¸ªç‚¹çš„æ—¶å€™æ‰ä¼šè§¦å‘è¿™ä¸ª end äº‹ä»¶ï¼Œåœ¨ä¸­é€”è·¯è¿‡ä¸‰ä¸ªç‚¹çš„æ—¶å€™ï¼Œå•¥äº‹éƒ½æ²¡å‘ç”Ÿã€‚ æ–¹æ¡ˆ2ï¼šåˆ†æ®µåŠ¨ç”»æ—¢ç„¶è¿™ä¸ª end äº‹ä»¶ä¼šåœ¨åŠ¨ç”»ç»“æŸæ—¶æ‰è§¦å‘ï¼Œé‚£é©¬ä¸Šæƒ³åˆ°çš„å°±æ˜¯æŠŠæ•´ä¸ªè½¨è¿¹çš„åŠ¨ç”»åˆ†è§£æˆæ¯ä¸€æ®µçº¿æ®µçš„åŠ¨ç”»ï¼Œå†æŒ‰é¡ºåºæ’­æ”¾å°±è¡Œäº†ã€‚åœ¨ end äº‹ä»¶è§¦å‘çš„æ—¶å€™æ”¹ä¸€ä¸‹æŒ‡ç¤ºå™¨çš„ model å€¼ï¼Œç®€ç›´ niceï¼Œçœ‹äº†ä¸‹è¿˜æœçœŸæœ‰è¿™æ ·çš„ API moveTo(latlng, duration): stops current animation and make the marker move to latlng in duration ms. é‚£æ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œåˆå§‹åŒ– marker ä¸ºç¬¬ä¸€ä¸ªç‚¹ï¼Œç„¶åè°ƒç”¨ moveToï¼Œå¼€å§‹åˆ°ä¸‹ä¸€ä¸ªç‚¹çš„åŠ¨ç”»ï¼Œç„¶åç›‘å¬ end äº‹ä»¶ï¼Œåœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ç»§ç»­è°ƒç”¨ moveTo åˆ°ä¸‹ä¸€ä¸ªç‚¹ï¼Œç›´åˆ°æœ€åã€‚é¡ºä¾¿åœ¨ end äº‹ä»¶ä¸­ï¼Œæ”¹å˜ä¸€ä¸‹æŒ‡ç¤ºå™¨çš„å½“å‰çŠ¶æ€ã€‚ // åæ ‡ç‚¹æ•°ç»„const points = [];// å½“å‰æ‰€åœ¨ç‚¹ç´¢å¼•const cur = 0;// æŒ‡ç¤ºå™¨å½“å‰å€¼let indicator = 1;const MOVE_TIME = 1000;marker.setLatLng(points[cur]);marker.moveTo(points[++cur], MOVE_TIME);marker.on('end', () =&gt; &#123; indicator = cur; if (cur &lt; points.length - 1) &#123; marker.moveTo(points[++cur], MOVE_TIME); &#125;&#125;); é€»è¾‘ä¸Šçœ‹æ²¡å•¥å¤§é—®é¢˜ï¼Œä½†å®é™…å‡ºæ¥çš„æ•ˆæœå´æ˜¯å‡ºç°äº†ä¸¢å¸§çš„ç°è±¡ï¼Œä¸­é—´æœ‰å‡ æ®µçš„åŠ¨ç”»ä¸è§äº†ï¼Œç‚¹ç›´æ¥å°±è·³è¿‡å»äº†ã€‚ç»è¿‡ä¸€ç•ªæ‘¸ç´¢åï¼Œå‘ç°åœ¨ end çš„äº‹ä»¶å¤„ç†ä¸­åŠ ä¸Š setTimeout åä¸¢å¸§å°±è§£å†³äº†ã€‚ marker.on('end', () =&gt; &#123; setTimeout(() =&gt; &#123; indicator = cur; if (cur &lt; points.length - 1) &#123; marker.moveTo(points[++cur], MOVE_TIME); &#125; &#125;, 0);&#125;); åˆ†åˆ«è°ƒç”¨ .start() å’Œ .moveTo çš„ä¾‹å­ï¼Œåœ¨ moveTo ä¸‹å‹¾é€‰äº† setTimeout åï¼Œä¸¢å¸§æ¶ˆå¤±äº† æ‹–åŠ¨æŒ‡ç¤ºå™¨çš„å›°å¢ƒå›é¡¾éœ€æ±‚ï¼Œæˆ‘ä»¬å‘ç°å…¶å®æˆ‘ä»¬åªæ˜¯æŠŠæ’­æ”¾ï¼ˆæš‚åœå¯é€šè¿‡ pause/resume å¾ˆå¥½åœ°å®ç°ï¼‰æå®šäº†ï¼Œåœ¨ç»§ç»­æ€è€ƒå¦å¤–çš„éœ€æ±‚æ€ä¹ˆå®ç°çš„æ—¶å€™ï¼Œé‡åˆ°äº†ä¸€ä¸ªå›°å¢ƒã€‚ æè¿°è¿™ä¸ªå›°å¢ƒå‰ï¼Œæˆ‘ä»¬å…ˆæŠŠå‰é¢ marker ç§»åŠ¨ä¸æŒ‡ç¤ºå™¨è”åŠ¨çš„å…·ä½“ç»†èŠ‚è¯´æ¸…æ¥šã€‚å‰é¢æåˆ°ï¼ŒæŒ‡ç¤ºå™¨çš„å½“å‰çŠ¶æ€æŒ‡ç¤ºä¸€ä¸ªå˜é‡ indicatorï¼Œæˆ‘ä»¬ç®€å•åœ°åœ¨æ¯æ¬¡åŠ¨ç”»ç»“æŸæ—¶åšä¸€ä¸ªèµ‹å€¼ indicator = cur å°±èƒ½å®Œæˆè¿™ç§è”åŠ¨äº†ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨çš„ MVVM æ¡†æ¶æ˜¯ Angular çš„è¯ï¼Œè¿™ä¸ªæŒ‡ç¤ºå™¨çš„ HTML åº”è¯¥æ˜¯ç±»ä¼¼è¿™æ ·çš„ &lt;indicator [ngModel]=\"indicator\"&gt;&lt;/indicator&gt; ç»‘å®šä¸€ä¸ªå˜é‡åˆ°ç»„ä»¶é‡Œï¼Œå—¯ã€‚ å¥½ï¼Œç°åœ¨æˆ‘ä»¬è¦å®ç°æ‹–åŠ¨æŒ‡ç¤ºå™¨çš„æ—¶å€™ï¼Œmarker ä¹Ÿèƒ½æœ‰æ‰€å˜åŒ–ï¼Œé‚£è‡ªç„¶è€Œç„¶ï¼Œç»™è¿™ä¸ªç»„ä»¶ç»‘å®šä¸ª change äº‹ä»¶å§ï¼Œäº‹ä»¶å¤„ç†é‡Œæ”¹ä¸€ä¸‹ marker å°±å¥½äº†ï¼ &lt;indicator [ngModel]=\"indicator\" (ngModelChange)=\"onIndicatorChange()\"&gt;&lt;/indicator&gt; åœ¨ Angular é‡Œï¼ŒngModel ç»‘å®šçš„å±æ€§é»˜è®¤ä¼šæœ‰ä¸€ä¸ª ngModelChange äº‹ä»¶ï¼Œåœ¨ model æ”¹å˜çš„æ—¶å€™è°ƒç”¨ã€‚å†™å¥½æ‰€æœ‰é€»è¾‘åæ‰“å¼€é¡µé¢æµ‹è¯•ï¼Œè¿åŸæ¥çš„è¿è´¯åŠ¨ç”»éƒ½å‡ºé—®é¢˜äº†ï¼ä¸ºå•¥å‘¢ï¼ å¦‚ä½•åŒºåˆ† model çš„æ”¹å˜æ˜¯å› ä¸ºæ‹–åŠ¨æ”¹å˜è¿˜æ˜¯ä»£ç è°ƒç”¨æ”¹å˜çš„å‘¢ï¼Ÿ å¯¹äºè¿™ä¸ª indicator ç»„ä»¶æ¥è¯´ï¼Œå®ƒåªçŸ¥é“ indicator æ˜¯å®ƒçš„ modelï¼Œåªè¦ model å˜åŒ–äº†å°±è°ƒç”¨å›è°ƒï¼Œå› æ­¤å®ƒæ— æ³•åŒºåˆ†è¿™ä¸ª model çš„æ”¹å˜æ˜¯ä»€ä¹ˆå¼•èµ·çš„ã€‚æ— æ³•åŒºåˆ†å°±æ„å‘³ç€è¿™ä¸ªéœ€æ±‚å®ç°ä¸äº†å•Šã€‚ æ–¹æ¡ˆ3ï¼šå£°æ˜å¼æ¢ç§æ€è·¯æ—¢ç„¶åŒºåˆ†ä¸äº†ï¼Œé‚£å¹²è„†å°±ä¸åŒºåˆ†äº†ï¼Ÿä»”ç»†æƒ³æƒ³å®ç°åˆ†æ®µåŠ¨ç”»çš„æ–¹å¼ï¼Œå…¶å®é‚£æ˜¯ä¸€ç§å‘½ä»¤å¼çš„å®ç°æ–¹å¼ï¼š åˆ°ç¬¬ä¸€ä¸ªç‚¹ =&gt; åŠ¨ç”»ç§»åŠ¨åˆ°ç¬¬äºŒä¸ªç‚¹ =&gt; åŠ¨ç”»ç§»åŠ¨åˆ°ç¬¬ä¸‰ä¸ªç‚¹ =&gt; â€¦ ä½¿ç”¨å‘½ä»¤å¼çš„æ–¹å¼æ¥ç»„ç»‡ä»£ç ï¼Œå¾€å¾€ä»¥åé€»è¾‘å¤æ‚çš„æ—¶å€™ä¼šéå¸¸éš¾ä»¥ç»´æŠ¤ï¼Œé‚£èƒ½ä¸èƒ½ä»¥ä¸€ç§å£°æ˜å¼çš„æ€è·¯æ¥ç»„ç»‡å‘¢ï¼Ÿæ•´ä¸ªåº”ç”¨çš„ model å…¶å®åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯å½“å‰æ‰€åœ¨çš„ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ª indexï¼Œè¿™ä¸ªè½¨è¿¹ç§»åŠ¨çš„è¿‡ç¨‹åº”è¯¥æ˜¯ index = 0 =&gt; index = 1 =&gt; index = 2 =&gt; â€¦ è‡³äºé¡µé¢ä¸Šçš„å…ƒç´ å¦‚ä½•å˜åŒ–ï¼ˆmarker éœ€è¦ç§»åŠ¨ã€æŒ‡ç¤ºå™¨éœ€è¦å˜åŒ–ï¼‰ï¼Œåº”è¯¥ç”±ä¸€ä¸ªå…³ç³»æ¥æè¿°ï¼Œé‚£ä¹ˆå½“ model å˜åŒ–æ—¶ï¼Œç›¸åº”çš„é¡µé¢å…ƒç´ ä¹Ÿèƒ½è‡ªåŠ¨æ›´æ–°äº†ã€‚ ä½¿ç”¨ JavaScript çš„ getter/setter èƒ½å¾ˆå¥½åœ°åšåˆ° _cur = 0;get cur() &#123; return this._cur;&#125;set cur(value) &#123; // ç»‘å®šå¯¹åº”çš„å…³ç³» this._cur = value;&#125; è¿™æ ·å®ç°åï¼Œend äº‹ä»¶å°±å˜å¾—éå¸¸ç®€å•äº†ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„ç´¢å¼•è‡ªå¢ï¼Œæ³¨æ„ setTimeout è¿˜æ˜¯éœ€è¦çš„ marker.on('end', () =&gt; &#123; setTimeout(() =&gt; &#123; if (cur &lt; points.length - 1) &#123; cur++; &#125; &#125;, 0);&#125;); model çš„é€»è¾‘åœ¨å†™é‡Œé¢çš„é€»è¾‘æ—¶ï¼Œç”±äºæ¶‰åŠåˆ°åŠ¨ç”»ï¼Œé‚£ä¹ˆå½“è®¾ç½® index çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸¤ç§åŠ¨ç”»ç­–ç•¥ï¼š æ‰§è¡Œä»ç‚¹ index åˆ°ç‚¹ index+1 çš„åŠ¨ç”» æ‰§è¡Œä»ç‚¹ index -1 åˆ°ç‚¹ index çš„åŠ¨ç”» å…¶å®ä¸¤ç§å®ç°æ–¹å¼éƒ½å¯ä»¥ï¼Œä½†å‡ºäºä¸æŒ‡ç¤ºå™¨çš„ model ä¸€è‡´çš„è€ƒè™‘ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†ç¬¬ä¸€ç§ set cur(value) &#123; // ç»‘å®šå¯¹åº”çš„å…³ç³» this._cur = value; // å…ˆæŠŠ marker è®¾ç½®ä¸ºå½“å‰ç‚¹ this.marker.setLatLng(this.points[value]); // æ‰§è¡Œç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç‚¹çš„åŠ¨ç”» if (value &lt; this.points.length - 1) &#123; this.marker.moveTo(this.points[value + 1], MOVE_TIME); &#125;&#125; è¿™é‡Œåªæ˜¯ä¸€ä¸ªç®€å•åœ°ç¤ºä¾‹ï¼Œåœ¨å®é™…åœºæ™¯è¿˜éœ€è¦å¤„ç†å¦‚æ’­æ”¾ã€æš‚åœç­‰æƒ…å†µï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸åŒçš„ state æ§åˆ¶é€»è¾‘ã€‚è¿™æ ·æŠŠ cur çš„é€»è¾‘å†™å¥½åï¼ŒæŒ‡ç¤ºå™¨çš„ HTML å°±å¯ä»¥ç›´æ¥å†™æˆ &lt;indicator [(ngModel)]=\"cur\"&gt;&lt;/indicator&gt; ç›´æ¥åšä¸€ä¸ªåŒå‘ç»‘å®šå°±å®Œäº†ï¼æ‰€æœ‰çš„é€»è¾‘éƒ½æ”¾åœ¨äº† setter é‡Œï¼Œå¯¹äºé¡µé¢ç»„ä»¶æ¥è¯´ä»–ä»¬ä¸å†éœ€è¦å…³å¿ƒé€»è¾‘çš„ç»†èŠ‚ï¼Œä»–ä»¬åªéœ€è¦çŸ¥é“ model å°±å¯ä»¥äº†ï¼Œè¿™æ ·çš„è§£è€¦ä½¿åŠŸèƒ½çš„å®ç°å’Œç»´æŠ¤éƒ½æ›´åŠ çš„ç®€å•ã€æ¸…æ™°ã€‚","tags":[{"name":"Leaflet","slug":"Leaflet","permalink":"https://blog.imtouch.info/tags/Leaflet/"},{"name":"åŠ¨ç”»","slug":"åŠ¨ç”»","permalink":"https://blog.imtouch.info/tags/åŠ¨ç”»/"},{"name":"MVC","slug":"MVC","permalink":"https://blog.imtouch.info/tags/MVC/"},{"name":"å£°æ˜å¼","slug":"å£°æ˜å¼","permalink":"https://blog.imtouch.info/tags/å£°æ˜å¼/"}]},{"title":"Date Format in JavaScript","date":"2018-03-07T02:30:40.000Z","path":"2018/03/07/date-and-timezone-in-javascript/","text":"ä¿—è¯è¯´å¾—å¥½ï¼Œä»£ç é‡æ„ç«è‘¬åœºã€‚æœ€è¿‘æ¥æ‰‹äº†ä¸€ä¸ªå¾®ä¿¡å•†åŸçš„é¡¹ç›®ï¼Œä»£ç é‡ä¸æ˜¯å¾ˆå¤§ï¼Œä½†å…¶ä¸­è¿˜æ˜¯æœ‰ä¸å°‘çš„å‘å¯ä»¥æ·±é™·å…¶ä¸­ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå…³äº JavaScript çš„ Date Format é—®é¢˜ã€‚å¦å¤–ç½‘ä¸Šçš„å¾ˆå¤šæ–‡ç« åœ¨ Date Format ä¸Šçš„ç†è§£ç•¥æœ‰åé¢‡ï¼Œå› æ­¤ç»“åˆç€ ECMAScript è§„èŒƒæŠŠè¿™éƒ¨åˆ†çš„çŸ¥è¯†æ•´ç†ä¸€ä¸‹ã€‚ æ—¶é—´ä¸æ—¶åŒºæ—¶åŒºå˜›ï¼Œç®€å•ç‚¹è®²å°±æ˜¯åœ°çƒä¸Šä¸åŒåœ°æ–¹çš„æ—¶é—´æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…¶ä¸­å­˜åœ¨ä¸€ä¸ªæ ‡å‡†æ—¶åŒºçš„æ—¶é—´ï¼Œæˆ‘ä»¬å« UTC æ—¶é—´ã€‚ä¸­å›½ä½äºä¸œå…«åŒºå˜›ï¼Œæ‰€ä»¥ CSTï¼ˆä¸­å›½æ ‡å‡†æ—¶é—´ï¼‰å°±ä¼šæ¯” UTC å¿«å…«å°æ—¶ã€‚ä¸¾ä¸ªæ —å­ï¼š å¦‚æœæ ‡å‡†æ—¶é—´æ˜¯ 2018-01-01 00:00:00ï¼Œé‚£ä¹ˆåœ¨ä¸­å›½çš„æ—¶é—´å°±åº”è¯¥æ˜¯ 2018-01-01 08:00:00ï¼Œå› ä¸ºæˆ‘ä»¬æ¯”è¾ƒå¿«å˜›ã€‚ç›¸åï¼Œå¦‚æœåœ¨ä¸­å›½çš„æ—¶é—´æ˜¯ 2018-01-01 00:00:00ï¼Œé‚£ä¹ˆæ ‡å‡†æ—¶é—´å°±åº”è¯¥æ˜¯ 2017-12-31 16:00:00ï¼Œ è¿˜æ²¡å€’æ•°æ–°å¹´å‘¢ã€‚è¿™ä¸ªå‘¢åº”è¯¥æ¯”è¾ƒå¥½ç†è§£ã€‚ æ€æ · Format ä¸€ä¸ª DateISO 8601 &amp; Date Time String Formaté¦–å…ˆæ˜¯ ISO 8601 å…¶å®æ˜¯æœ‰éå¸¸éå¸¸å¤šçš„æ—¥æœŸæ—¶é—´å®šä¹‰æ–¹å¼çš„ï¼Œè€Œ ECMASCript åªç”¨äº†ä¸€ä¸ª Simplified ç‰ˆæœ¬çš„å®šä¹‰ï¼Œçœ‹ 20.3.1.16 Date Time String Format çš„å®šä¹‰ï¼Œå¯ä»¥æ€»ç»“å‡ºä»¥ä¸‹å‡ ç‚¹ï¼š å®Œæ•´çš„æ—¥æœŸæ—¶é—´å®šä¹‰æ ¼å¼ä¸º YYYY-MM-DDTHH:mm:ss.sssZ T åªæ˜¯ä½œä¸ºæ—¥æœŸä¸æ—¶é—´çš„åˆ†éš”ç¬¦ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ Z ä»£è¡¨æ—¶é—´ä¸º UTC æ—¶é—´ï¼Œå½“è¯¥æ—¶é—´è¡¨ç¤ºä¸ºæ—¶åŒºæ—¶é—´æ—¶ï¼ŒZ è¢«æ›¿æ¢ä¸º +HH:mm æˆ– -HH:mm ä»£è¡¨å¯¹åº”çš„æ—¶åŒº æœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯ date-onlyï¼Œå¦ä¸€ç§æ˜¯ date-time date-only åŒ…æ‹¬ä¸‹é¢ä¸‰ç§ï¼š YYYY YYYY-MM YYYY-MM-DD date-time å°±æ˜¯ä¸Šé¢ä¸‰ç§çš„ä»»æ„ä¸€ç§ååŠ ä¸Šä¸‹é¢çš„ä¸€ç§ï¼š THH:mm THH:mm:ss THH:mm:ss.sss å°¤å…¶æ³¨æ„åˆ°è¿™å¥è¯ï¼Œå¹¿ä¸ºæµä¼ çš„ ECMAScript 5.1 ç‰ˆæ˜¯æ²¡æœ‰çš„ï¼š When the time zone offset is absent, date-only forms are interpreted as a UTC time and date-time forms are interpreted as a local time. ä¹Ÿå°±æ˜¯è¯´ Z æ˜¯å¯ä»¥çœç•¥çš„ï¼Œçœç•¥åçš„å­—ç¬¦ä¸²å¦‚æœå±äº date-only ç±»å‹æ—¶ï¼Œä¼šè¢«è§£ææˆ UTC æ—¶é—´ï¼›å¦‚æœå±äº date-time ç±»å‹æ—¶ï¼Œä¼šè§£ææˆæœ¬åœ°æ—¶é—´ã€‚ ç”±æ­¤å¯çŸ¥ï¼ŒECMASCript ä¸­å®šä¹‰çš„ Date Time String Format æ˜¯æœ‰é™çš„ï¼Œå½“ç»™å®šä¸€ä¸ª String æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›è§„åˆ™æ¥åˆ¤æ–­è¿™ä¸ª String æ˜¯å¦æ»¡è¶³è¿™é‡Œçš„ Date Time String Formatã€‚ Date.parse å¹²äº†å•¥å®é™…ä¸Šï¼Œå¤§éƒ¨åˆ†åŒå­¦éƒ½çŸ¥é“ new Date(string) å®é™…ä¸Šè°ƒç”¨äº† Date.parse æ–¹æ³•ï¼Œ20.3.2.2Date ( value )ã€‚å› æ­¤çœ‹ 20.3.3.2 Date.parse ( string ) ä¸­å¦‚æ­¤è¯´é“ï¼š The function first attempts to parse the format of the String according to the rules (including extended years) called out in Date Time String Format (20.3.1.16). If the String does not conform to that format the function may fall back to any implementation-specific heuristics or implementation-specific date formats. æ²¡é”™ Date.parse å°±æ˜¯å…ˆæŒ‰ä¸Šæ–‡æåˆ°çš„ Date Time String Format æ¥ formatï¼Œä¸æ»¡è¶³çš„è¯å°±æ˜¯ implementation-specific date formatsã€‚æ˜¯çš„ï¼Œè·Ÿä¸åŒæµè§ˆå™¨çš„ä¸åŒå®ç°æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯æœªå®šä¹‰è¡Œä¸ºã€‚ æµè§ˆå™¨æ˜¯çˆ¸çˆ¸è®©æˆ‘ä»¬å…·ä½“æ¥çœ‹çœ‹ä¸åŒæµè§ˆå™¨å¯¹ä¸€äº›å…¸å‹æ—¥æœŸæ—¶é—´ä¸²çš„ formatã€‚ new Date('2018-01-01')new Date('2018-1-1')new Date('2018-01-01T08:00:00')new Date('2018-01-01 08:00:00')// ChromeMon Jan 01 2018 08:00:00 GMT+0800 (CST) - UTCMon Jan 01 2018 00:00:00 GMT+0800 (CST) - æœ¬åœ°Mon Jan 01 2018 08:00:00 GMT+0800 (CST) - æœ¬åœ°Mon Jan 01 2018 08:00:00 GMT+0800 (CST) - æœ¬åœ°// FirefoxDate 2018-01-01T00:00:00.000Z - UTCDate 2018-01-01T00:00:00.000Z - UTCDate 2018-01-01T00:00:00.000Z - æœ¬åœ°Date 2018-01-01T00:00:00.000Z - æœ¬åœ°// SafariMon Jan 01 2018 08:00:00 GMT+0800 (CST) - UTCInvalid DateMon Jan 01 2018 16:00:00 GMT+0800 (CST) - UTCInvalid Date Surprice Mother Fxxkerï¼ è¿™å››ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜¯æ»¡è¶³ ECMAScript ä¸­ Date Time String Format çš„ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ä¸€äº›æˆ‘ä»¬å¸¸ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ—¥æœŸæ—¶é—´çš„æ ¼å¼ã€‚ é¦–å…ˆä¸ä»¤äººæ„å¤–çš„æ˜¯ï¼Œæ­£å¦‚å‰æ–‡æ‰€è®²ï¼Œå¯¹äºä¸ç¬¦åˆ Format çš„å­—ç¬¦ä¸² format ç»“æœï¼Œä¸åŒæµè§ˆå™¨ä¼šæœ‰ä¸åŒçš„å®ç°ï¼Œæ¯”å¦‚ç¬¬å››ç§å¸¦ç©ºæ ¼çš„æ ¼å¼ï¼ŒSafari ä¼šç›´æ¥æŠ¥é”™ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼ŒAngular ä½¿ç”¨ date ç®¡é“å¯¼è‡´ IE11 ä¸å…¼å®¹çš„åŸå› ã€‚ ä½†æ›´ä»¤äººæ„å¤–çš„æ˜¯ï¼Œå¯¹äºç¬¬ä¸‰ç§æ»¡è¶³ Format çš„å­—ç¬¦ä¸²ï¼Œå±…ç„¶å¾—å‡ºäº†ä¸ä¸€æ ·çš„ç»“æœï¼Unbelievableï¼æŒ‰ç…§è§„èŒƒï¼Œ2018-01-01T08:00:00 æ˜¯çœç•¥äº† time-zone çš„ date-time ç±»å‹ï¼Œåº”è¯¥æŒ‰ local time è¿›è¡Œ formatï¼ŒChrome ä¸ Firefox åšå¾—å¾ˆå¥½ï¼Œè€Œ Safari å´æ²¡æœ‰éµå¾ªè§„èŒƒã€‚ ä¸‡äº‹å°å¿ƒæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå³ä½¿æ˜¯å¤§å‚æµè§ˆå™¨ï¼Œä¹Ÿæ²¡æœ‰å®Œå…¨æŒ‰è§„èŒƒå®ç°ï¼Œæ›´ä½•å†µå›½å†…ä¼—å¤šå¤§å¤§å°å°çš„æµè§ˆå™¨ã€‚å› æ­¤åœ¨å¤„ç† Date çš„æ—¶å€™ï¼Œéœ€è¦ä¿æŒè­¦è§‰ï¼š åç«¯ä¼ æ—¶é—´ç»™å‰ç«¯ï¼Œä½¿ç”¨å­—ç¬¦ä¸²æ—¶ï¼Œå°½é‡ä½¿ç”¨å¸¦æ—¶åŒºçš„å®Œæ•´ ISO 8601 æ—¥æœŸæ—¶é—´å­—ç¬¦ä¸²ï¼Œå³ 2018-01-01T08:00:00+08:00 æˆ–ä½¿ç”¨ UTC æ—¶é—´ 2018-01-01T00:00:00Z ï¼Œå¦åˆ™å‰ç«¯å¦‚æœä½¿ç”¨ new Date(string) è¿›è¡Œè½¬æ¢ï¼Œåæœå¯èƒ½ä¸å ªè®¾æƒ³ å‰ç«¯ä¼ æ—¶é—´ç»™åç«¯ï¼Œå¯ä»¥ä½¿ç”¨æ ‡å‡†å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æ¯«ç§’æ•°ï¼Œé‡è¦çš„æ˜¯ä¿æŒä¸€è‡´ æ­£å¦‚ jQuery ä¹‹æ‰€ä»¥èƒ½å¤Ÿå±å’¤é£äº‘ï¼Œç›´æ¥ä½¿ç”¨ moment ç­‰åº“å¤„ç†æ—¥æœŸæ—¶é—´ä¹Ÿä¸å¤±ä¸ºä¸€ä¸ªä¸é”™çš„é€‰æ‹© æœ‰éƒ¨åˆ†æ„è§è®¤ä¸ºæ—¥æœŸæ—¶é—´åœ¨åç«¯æ•°æ®åº“å¯ä»¥ç»Ÿä¸€ç”¨ Long ä¿å­˜ï¼Œè¿™ä¸ªæ•°å­—å®é™…ä¸Šæ˜¯ä¸€ä¸ª UTC æ—¶é—´ï¼Œéœ€è¦æ˜¾ç¤ºæ—¶æ ¼å¼åŒ–ä¸ºæœ¬åœ°æ—¶åŒºï¼Œéœ€è¦æ›´æ–°æ—¶é€šè¿‡è½¬ä¸º UTC æ—¶é—´ä¿å­˜ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„å®è·µï¼Œä½†å¸¦æ¥çš„é—®é¢˜æ˜¯æ•°æ®åº“æŸ¥è¯¢ä¸­æ²¡æ³•çœ‹åˆ°å®é™…çš„æ—¶é—´ã€‚åœ¨ MySQL ä¸‹ï¼ŒTIMESTAMP ç±»å‹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ å‚è€ƒèµ„æ–™ å…³äºâ€œæ—¶é—´â€çš„ä¸€æ¬¡æ¢ç´¢ JavaScript æ—¶é—´ä¸æ—¥æœŸå¤„ç†å®æˆ˜:ä½ è‚¯å®šè¢«å‘è¿‡ å¦‚ä½•æ­£ç¡®åœ°å¤„ç†æ—¶é—´ - å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™","tags":[{"name":"ECMAScript","slug":"ECMAScript","permalink":"https://blog.imtouch.info/tags/ECMAScript/"},{"name":"JavaScript","slug":"JavaScript","permalink":"https://blog.imtouch.info/tags/JavaScript/"},{"name":"Date","slug":"Date","permalink":"https://blog.imtouch.info/tags/Date/"}]},{"title":"Angular å˜åŒ–æ£€æµ‹ä¸­çš„ç»†èŠ‚","date":"2018-02-28T06:04:34.000Z","path":"2018/02/28/details-in-angular-detect-change/","text":"å¹´å‰åœ¨å…¬å¸ä¸¾è¡Œäº†ä¸€åœºç››å†µç©ºå‰ï¼ˆè¯¯ï¼‰çš„å‰ç«¯åˆ†äº«ä¼šï¼Œæˆ‘åœ¨ä¼šä¸Šå¤§è°ˆç‰¹è°ˆäº†å…³äº Angular çš„å˜åŒ–æ£€æµ‹æœºåˆ¶ï¼Œå°±åœ¨å³å°†è¿æ¥å®Œç¾çš„æ”¶å®˜ä¹‹æ—¶ï¼Œæ€»æ˜¯ä¼šæœ‰æ·˜æ°”é¬¼æå‡ºå„ç§å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜ï¼Œè®©äººä¸èƒœå…¶çƒ¦ï¼ˆå¤§è¯¯ï¼‰ã€‚ç”±äºå½“æ—¶æ— è¨€ä»¥å¯¹ã€æ”¯æ”¯å¾å¾ï¼Œä¾¿åªå¥½ä¼šåä¸€ç•ªä»”ç»†ç ”ç©¶åï¼Œå‘å‡ºæ–‡ç« ä»¥æ­£è§†å¬ã€‚æœ›æ—¥åèƒ½å¼“è°ƒé©¬æœå†å¤§è°ˆç‰¹è°ˆï¼ˆé€ƒ æ–‡ä¸­æåŠçš„ Angular æºç å‡åŸºäº Angular å®˜æ–¹ä»“åº“ tag 4.4.6 onPush ä¹Ÿä¼šè§¦å‘ View æ›´æ–°ï¼ŸQuestionæ·˜æ°”é¬¼çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å…³äº onPush ç­–ç•¥ä¸‹ View çš„æ›´æ–°é—®é¢˜ã€‚ é¦–å…ˆæ˜¯ä¸€æ®µç½‘ä¸Šä¸¾ä¾‹å†å¤šä¸è¿‡çš„å…³äºä½¿ç”¨ Observable + onPush æ¥å‡å°‘ç»„ä»¶å˜åŒ–æ£€æµ‹çš„ä»£ç ï¼š @Component(&#123; selector: 'app', template: ` &lt;button (click)=\"emit()\"&gt;&lt;/button&gt; &lt;sub-a [observable]=\"subject\"&gt;&lt;/sub-a&gt; `&#125;)export class AppComponent &#123; subject = new Subject(); emit() &#123; this.subject.next(Math.random()); &#125;&#125;@Component(&#123; selector: 'sub-a', template: ` &lt;p&gt;&#123;&#123;local&#125;&#125;&lt;/p&gt; `, changeDetection: ChangeDetectionStrategy.OnPush&#125;)export class SubAComponent implements OnInit &#123; local; @Input() observable; constructor(private changeDetector: ChangeDetectorRef) &#123; &#125; ngOnInit() &#123; this.observable.subscribe(value =&gt; &#123; this.local = value; // this.changeDetector.markForCheck(); &#125;); &#125;&#125; æ¯«æ— ç–‘é—®åœ°ï¼Œäº†è§£è¿‡ ChangeDetectionStrategy.OnPush çš„åŒå­¦éƒ½æ˜ç™½ï¼Œæ­¤æ—¶ sub-a ç»„ä»¶çš„ local å€¼è™½ç„¶è¢«æ”¹å˜äº†ï¼Œä½†ç”±äºæ²¡æœ‰è°ƒç”¨ markForCheck æ–¹æ³•ï¼Œä¸”æ‰€æœ‰ @Input å±æ€§æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼ŒAngular ä¼šè·³è¿‡è¯¥ç»„ä»¶ï¼ˆåŠå…¶å­ç»„ä»¶ï¼‰çš„æ‰€æœ‰å˜åŒ–æ£€æµ‹ï¼Œå› æ­¤é¡µé¢å¹¶ä¸ä¼šæ›´æ–°ã€‚å»æ‰è¿™ä¸ª markForCheck æ–¹æ³•çš„æ³¨é‡Šï¼Œé¡µé¢å°±èƒ½å¤Ÿå¾—åˆ°æ›´æ–°äº†ã€‚å…·ä½“å¯ä»¥å»æŸ¥é˜…å…¶ä»–å…³äº OnPush ç­–ç•¥çš„æ–‡ç« ã€‚ å¥½äº†ï¼Œè¿™æ—¶å€™æ·˜æ°”é¬¼è¯´ï¼Œé‚£å¦‚æœæˆ‘ä»¬ä¸æ˜¯æ”¹å˜ä¸€ä¸ª @Input çš„å˜é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªå†…éƒ¨å˜é‡å‘¢ï¼ŸView ä¼šæ›´æ–°å—ï¼Ÿå³ï¼š @Component(&#123; selector: 'app', template: ` &lt;sub-a&gt;&lt;/sub-a&gt; `&#125;)export class AppComponent &#123;&#125;@Component(&#123; selector: 'sub-a', template: ` &lt;button (click)=\"change()\"&gt;&lt;/button&gt; &lt;p&gt;&#123;&#123;local&#125;&#125;&lt;/p&gt; `, changeDetection: ChangeDetectionStrategy.OnPush&#125;)export class SubAComponent implements OnInit &#123; local; constructor(private changeDetector: ChangeDetectorRef) &#123; &#125; ngOnInit() &#123; &#125; change() &#123; this.local = Math.random(); &#125;&#125; è¿™é‡Œç›´æ¥æŠŠçˆ¶å­ç»„ä»¶é—´çš„å˜é‡ä¼ é€’å»æ‰äº†ï¼Œæ–¹ä¾¿ç†è§£ã€‚æˆ‘ä¸€å¼€å§‹æ˜¯è®¤ä¸ºView ä¸ä¼šæ›´æ–°ï¼ŒåŸå› æ˜¯æ—¢ç„¶è¾“å…¥å±æ€§æ²¡æœ‰å‘ç”Ÿæ”¹å˜ï¼Œé‚£è¿™ä¸ª SubA ç»„ä»¶çš„å˜åŒ–æ£€æµ‹å°±åº”è¯¥è¢« skip æ‰ã€‚ç„¶è€Œï¼š ä»–å˜äº†ã€‚ ç®€ç›´å‡»ç¢äº†æˆ‘çš„ä¸–ç•Œè§‚ã€‚ æ›´è¯¡å¼‚çš„æƒ…å†µåœ¨æˆ‘é˜…è¯»ä¼—å¤šèµ„æ–™å¯¹ OnPush ç­–ç•¥ä¸ Angular å˜åŒ–æ£€æµ‹çš„ç†è§£ä¸­ï¼Œç‚¹å‡»æŒ‰é’®åæ‰€å‘ç”Ÿçš„åº”è¯¥æ˜¯ï¼š click event =&gt; ngZone æ•è·ï¼Œå¼€å§‹ä¸€æ¬¡ä»æ ¹çš„å˜åŒ–æ£€æµ‹ =&gt; åˆ° OnPush ç­–ç•¥çš„ç»„ä»¶ï¼Œè·³è¿‡ =&gt; é¡µé¢ä¸ä¼šæ›´æ–° æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜å‘¢ï¼ŸæŠ±ç€ç–‘é—®åœ¨ Google çš„å¸®åŠ©ä¸‹å››æµ·ä¸ºå®¶ï¼ˆè¯¯ï¼‰ï¼ŒæœŸé—´ä¹Ÿå’¨è¯¢äº†ä¸å°‘äººï¼Œä½†ä¹Ÿå¾—ä¸åˆ°æ»¡æ„çš„ç­”å¤ï¼Œç›´åˆ°åœ¨å®˜ç½‘çš„ API ä¸Šçœ‹åˆ°è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š @Component(&#123; selector: 'cmp', changeDetection: ChangeDetectionStrategy.OnPush, template: `Number of ticks: &#123;&#123;numberOfTicks&#125;&#125;`&#125;)class Cmp &#123; numberOfTicks = 0; constructor(private ref: ChangeDetectorRef) &#123; setInterval(() =&gt; &#123; this.numberOfTicks++; // the following is required, otherwise the view will not be updated this.ref.markForCheck(); &#125;, 1000); &#125;&#125;@Component(&#123; selector: 'app', changeDetection: ChangeDetectionStrategy.OnPush, template: ` &lt;cmp&gt;&lt;cmp&gt; `,&#125;)class App &#123;&#125; è¿™ä¸ªä¾‹å­è·Ÿæ·˜æ°”é¬¼çš„ä¾‹å­å¾ˆåƒï¼ŒåŒºåˆ«åªåœ¨äºå®˜ç½‘ä½¿ç”¨äº† setInterval æ¥è§¦å‘ ViewModel çš„æ›´æ–°ï¼Œè€Œæ·˜æ°”é¬¼å°±æäº†ä¸ªæŒ‰é’®ã€‚ ä½†æ˜¯ï¼Œè¿™ä¸ª setInterval å±…ç„¶æ˜¯ä¸ä¼šæ›´æ–° Viewï¼Œè€Œç‚¹å‡»æŒ‰é’®å´æ˜¯ä¼šæ›´æ–° Viewï¼Œçº³å°¼ï¼Ÿè¿™ä¸¤ä¸ªå¯¹ zone æ¥è¯´ä¸æ˜¯éƒ½æ˜¯å¼‚æ­¥å—ï¼Ÿéƒ½æ˜¯è§¦å‘ä¸€è½®å˜åŒ–æ£€æµ‹å—ï¼Ÿ æŠŠæ·˜æ°”é¬¼çš„ä¾‹å­æ”¹äº†ä¸‹ï¼Œå‘ç°çš„ç¡®å¦‚æ­¤ï¼Œè°ƒç”¨åŒä¸€ä¸ªå‡½æ•° changeï¼Œæ¯ä¸€ç§’çš„å®šæ—¶ä»»åŠ¡ View ä¸ä¼šæ›´æ–°ï¼Œç‚¹å‡»æŒ‰é’®ç•Œé¢å°±èƒ½æ›´æ–°ï¼WHYï¼Ÿå¦‚æ­¤çœ‹æ¥é‚£åº”è¯¥æ˜¯ ngZone å¯¹è¿™ä¸¤ç§å¼‚æ­¥äº‹ä»¶çš„å¤„ç†æœ‰åŒºåˆ«ã€‚ @Component(&#123; selector: 'app', template: ` &lt;sub-a&gt;&lt;/sub-a&gt; `&#125;)export class AppComponent &#123;&#125;@Component(&#123; selector: 'sub-a', template: ` &lt;button (click)=\"change()\"&gt;&lt;/button&gt; &lt;p&gt;&#123;&#123;local&#125;&#125;&lt;/p&gt; `, changeDetection: ChangeDetectionStrategy.OnPush&#125;)export class SubAComponent implements OnInit &#123; local; constructor(private changeDetector: ChangeDetectorRef) &#123; &#125; ngOnInit() &#123; setInterval(() =&gt; &#123; this.change(); &#125;, 1000); &#125; change() &#123; this.local = Math.random(); &#125;&#125; è°ƒç”¨ç»‘å®šäº‹ä»¶ä¼šè‡ªåŠ¨ markForCheckåœ¨ StackOvewflow ä¸Šæœç´¢ä¸€ç•ªï¼Œæœç„¶è¿˜æ˜¯çš‡å¤©ä¸è´Ÿæœ‰å¿ƒäººå•Š Angular OnPush Component, when trigger event in view angular force markForCheck automatically? åŸæ¥åŸå› æ˜¯ï¼Œå¯¹äº DOM ä¸­ç»‘å®šçš„äº‹ä»¶ï¼Œä¼šåœ¨å†…éƒ¨è‡ªåŠ¨æŠŠ markForCheck å¸®ä½ è°ƒç”¨äº†ã€‚æ¥æˆ‘ä»¬çœ‹çœ‹æºç ï¼š // packages/core/src/view/provider.ts - L134export function createDirectiveInstance(view: ViewData, def: NodeDef): any &#123; // Omit... if (def.outputs.length) &#123; for (let i = 0; i &lt; def.outputs.length; i++) &#123; const output = def.outputs[i]; const subscription = instance[output.propName !].subscribe( eventHandlerClosure(view, def.parent !.nodeIndex, output.eventName)); view.disposables ![def.outputIndex + i] = subscription.unsubscribe.bind(subscription); &#125; &#125; return instance;&#125;function eventHandlerClosure(view: ViewData, index: number, eventName: string) &#123; return (event: any) =&gt; &#123; try &#123; return dispatchEvent(view, index, eventName, event); &#125; catch (e) &#123; // Attention: Don't rethrow, as it would cancel Observable subscriptions! view.root.errorHandler.handleError(e); &#125; &#125;;&#125; è¿™é‡Œåªéœ€è¦çœ‹åˆ°ç»‘å®šäº‹ä»¶çš„å¤„ç†å‡½æ•°æ˜¯ eventHandlerClosureï¼Œè€Œè¿™ä¸ªå¤„ç†å‡½æ•°åˆ™æ˜¯è°ƒç”¨äº† dispatchEventã€‚ // packages/core/src/view/util.ts - L128export function dispatchEvent( view: ViewData, nodeIndex: number, eventName: string, event: any): boolean &#123; const nodeDef = view.def.nodes[nodeIndex]; const startView = nodeDef.flags &amp; NodeFlags.ComponentView ? asElementData(view, nodeIndex).componentView : view; markParentViewsForCheck(startView); return Services.handleEvent(view, nodeIndex, eventName, event);&#125; è€Œ dispatchEvent åˆ™æ˜¯è°ƒç”¨äº† markParentViewsForCheckã€‚æ²¡é”™å°±æ˜¯è¿™ä¸ªé€šçŸ¥äº† Angular è§¦å‘ View æ›´æ–°ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ ChangeDetectorRef.markForCheck çš„æºç ã€‚ // packages/core/src/view/refs.ts - L248export class ViewRef_ implements EmbeddedViewRef&lt;any&gt;, InternalViewRef &#123; // Omit... markForCheck(): void &#123; markParentViewsForCheck(this._view); &#125; // Omit...&#125; æ²¡é”™ï¼ŒmarkForCheck çš„å†…éƒ¨å°±æ˜¯é€šè¿‡ markParentViewsForCheck å®ç°çš„ã€‚ æ€»ç»“ä¸‹æ¥ï¼Œå…¶å®æˆ‘çš„ç†è§£æ˜¯æ²¡é”™çš„ï¼Œä½¿ç”¨äº† OnPush ç­–ç•¥ï¼Œæ— è®ºå¦‚ä½•æ”¹å˜å˜é‡ï¼Œåªè¦æ²¡æœ‰ markForCheckï¼ŒView çš„ç¡®æ˜¯ä¸ä¼šæ›´æ–°çš„ã€‚ OnPush ä¼šæ›´æ–° View çš„æƒ…å†µé‚£ç¯‡ StackOverflow æœ‰ä¸ªä»‹ç» OnPush ç­–ç•¥ä¸‹ä»€ä¹ˆæƒ…å†µä¼šæ›´æ–° View çš„æ€»ç»“ï¼Œé¡ºå¸¦ä¹Ÿæ¬è¿ä¸€ä¸‹ã€‚ Change Detection issue â€” Why is this changing when itâ€™s the same object reference with On Push @Input å±æ€§æ”¹å˜è¿™æ˜¯æœ€é€šå¸¸çš„ç†è§£äº†ã€‚å†…éƒ¨é€šè¿‡å°† ViewState ç½®ä¸º ChecksEnabled ä½¿ç»„ä»¶é‡æ–°åŠ å…¥å˜åŒ–æ£€æµ‹ã€‚ // packages/core/src/view/provider.ts - L424function updateProp( view: ViewData, providerData: ProviderData, def: NodeDef, bindingIdx: number, value: any, changes: SimpleChanges): SimpleChanges &#123; if (def.flags &amp; NodeFlags.Component) &#123; const compView = asElementData(view, def.parent !.nodeIndex).componentView; if (compView.def.flags &amp; ViewFlags.OnPush) &#123; compView.state |= ViewState.ChecksEnabled; &#125; &#125;&#125; ç»„ä»¶å†…è§¦å‘ç»‘å®šäº‹ä»¶ä¹Ÿå°±æ˜¯ä¸Šæ–‡åˆ†æçš„æƒ…å†µã€‚ æ‰‹åŠ¨è°ƒç”¨ markForCheckè¿™ä¸ªä¹Ÿæ²¡æœ‰é—®é¢˜ï¼Œæ‰‹åŠ¨æŠŠè¯¥ç»„ä»¶é‡æ–°è®¾ç½®ä¸ºå¯ Checkã€‚ Async pipeè¿™ä¸ªæˆ‘ä¹ŸçœŸæ²¡æƒ³åˆ°ï¼Œasync pipe å†…éƒ¨ä¹Ÿè‡ªåŠ¨è°ƒç”¨äº† markForCheckï¼Œä¸è¿‡è€ƒè™‘åˆ°å®ƒè¿é”€æ¯éƒ½è‡ªå¸¦äº†ï¼Œè¿™ä¹Ÿå¯ä»¥ç†è§£ã€‚ // packages/common/src/pipes/async_pipe.ts - L139private _updateLatestValue(async: any, value: Object): void &#123; if (async === this._obj) &#123; this._latestValue = value; this._ref.markForCheck(); &#125;&#125; ViewCheck çš„æ‰§è¡Œé¡ºåºQuestionè¿™æ˜¯æ·˜æ°”é¬¼çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œåœ¨å±•ç¤ºç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­è°ƒç”¨é¡ºåºçš„æ—¶å€™ï¼Œæœ‰å¦‚ä¸‹çš„ç»„ä»¶æ ‘ï¼ˆä¸‘ï¼‰ç»“æ„ï¼š ç»„ä»¶æ ‘ è¯·é—®ä»–çš„ ngAfterViewChecked é’©å­çš„æ‰§è¡Œé¡ºåºæ˜¯å•¥å‘¢ï¼Ÿ æˆ‘ä¸€å¼€å§‹ä»¥ä¸ºä¼šæ˜¯ BDCAï¼Œæ²¡é”™å°±æ˜¯ä¸€ä¸ªæ ‘çš„ååºéå†ã€‚ä½†ç°å®å´æ˜¯ DBCAï¼è¿™æ˜¯ä»€ä¹ˆé¬¼ï¼ åˆ°åº•æ˜¯è° Check è°ï¼Ÿè¿™ä¸ªå…¶å®æ€ªæˆ‘ä¸€æ—¶æ²¡æœ‰æ˜ç™½ Change Detection çš„æ­¥éª¤ï¼Œè¿™é‡Œå¼ºçƒˆæ¨èæˆ‘è®¤ä¸ºå…¨ç½‘å†™å¾—æœ€å¥½çš„å…³äº Angular å˜åŒ–æ£€æµ‹çš„æ–‡ç« ï¼š Everything you need to know about change detection in Angular é‡Œé¢æ€»ç»“äº†å¯¹äºæ¯ä¸ªç»„ä»¶ä¸€è½®å˜åŒ–æ£€æµ‹è¦æ‰§è¡Œçš„æ­¥éª¤ï¼Œé‡ç‚¹å…³æ³¨ 10) å’Œ 12) æ­¥ï¼š 10) runs change detection for a child view (repeats the steps in this list) 12) call AfterViewInit and AfterViewChecked lifecycle hooks on child component instance (AfterViewInit is called only during first check) æ•´ä¸ªæ­¥éª¤çœ‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å‘ç°äº†è¿™æ ·ä¸¤ä»¶äº‹ã€‚ ç¬¬ä¸€ï¼Œå­ç»„ä»¶çš„é€’å½’å˜åŒ–æ£€æµ‹æ˜¯åœ¨è°ƒç”¨ ViewCheck é’©å­å‰è¿›è¡Œçš„ã€‚ ç¬¬äºŒï¼Œæ¯”å¦‚ï¼Œå½“ç»„ä»¶ A æ‰§è¡Œå®Œä¸€è½®å˜åŒ–æ£€æµ‹åï¼ŒA.ngAfterViewChecked å¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚ä»”ç»†æŸ¥çœ‹æ¯ä¸€ä¸ªæ­¥éª¤ï¼Œå¯¹ç»„ä»¶ A çš„å˜åŒ–æ£€æµ‹ä¸­ï¼Œç¡®å®æ²¡æœ‰è°ƒç”¨ A çš„ ViewCheck é’©å­è¿™æ ·çš„æ­¥éª¤ã€‚é‚£è¿™ä¸ªé’©å­æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„å‘¢ï¼Ÿ å›åˆ°ä¸Šé¢æåˆ°çš„ 12) æ­¥ï¼Œå¯¹äºæ¯ä¸ªç»„ä»¶çš„ä¸€è½®å˜åŒ–æ£€æµ‹ï¼Œéœ€è¦å»è°ƒç”¨å­ç»„ä»¶çš„ ViewCheck é’©å­ã€‚å› æ­¤ï¼Œæ¯”å¦‚ï¼ŒA ç»„ä»¶çš„ ViewCheck é’©å­æ˜¯è°è°ƒç”¨çš„å‘¢ï¼Ÿå°±æ˜¯ A ç»„ä»¶çš„çˆ¶ç»„ä»¶è°ƒç”¨çš„ï¼Œè€Œä¸æ˜¯ A è‡ªèº«ï¼Œæ˜¯ A çš„çˆ¶ç»„ä»¶å»ç¡®è®¤ A å·²ç» Check äº†ã€‚ ç†è§£äº†è¿™ä¸¤ä¸ªä»¥åï¼Œä¸Šé¢é‚£ä¸ªç»„ä»¶æ ‘çš„ ViewCheck è°ƒç”¨é¡ºåºå°±éå¸¸æ¸…æ™°äº†ã€‚ è¯¦ç»†æè¿°é’ˆå¯¹ä¸Šå›¾çš„ç»„ä»¶æ ‘ï¼Œåª focus é€’å½’å˜åŒ–æ£€æµ‹å’Œ ViewCheck ä¸‹çš„å…·ä½“è°ƒç”¨æƒ…å†µå¦‚ä¸‹ï¼š A Begin Change detection A ç»„ä»¶æœ‰ä¸¤ä¸ªå­ç»„ä»¶ B/C B Begin Change detection B è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„ ViewCheck é’©å­ï¼ˆæ— è¾“å‡ºï¼‰ B End Change detection C Begin Change detection C ç»„ä»¶æœ‰å­ç»„ä»¶ D D Begin Change detection D è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„ ViewCheck é’©å­ï¼ˆæ— è¾“å‡ºï¼‰ D End Change detection C è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„ ViewCheck é’©å­ï¼ˆè¾“å‡º Dï¼‰ C End Change detection A è°ƒç”¨æ‰€æœ‰å­ç»„ä»¶çš„ ViewCheck é’©å­ï¼ˆè¾“å‡º B Cï¼‰ A End Change detection è¿™æ ·ä¸‹æ¥ï¼ŒDBCA çš„è¾“å‡ºå°±éå¸¸æ˜¾è€Œæ˜“è§äº†ã€‚ æ— å¥–é—®ç­”çœ‹çœ‹ä½ æŒæ¡äº†å—ï¼Ÿä¸‹é¢è¿™ä¸ªç»„ä»¶æ ‘çš„ ViewCheck é’©å­é¡ºåºæ˜¯å•¥å‘¢ï¼Ÿ æäº‹çš„ç»„ä»¶æ ‘ ç­”æ¡ˆçœ‹åæ–‡çš„å›¾ç‰‡ã€‚ ContentCheckå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒContentCheck çš„é¡ºåºè·Ÿ ViewCheck ååˆ†ç±»ä¼¼ï¼Œä¹Ÿæ˜¯çˆ¶ç»„ä»¶çš„å˜åŒ–æ£€æµ‹ä¸­è°ƒç”¨å­ç»„ä»¶çš„é’©å­ï¼Œåªä¸è¿‡è¿™æ˜¯åœ¨é€’å½’ä¹‹å‰è¿›è¡Œçš„è°ƒç”¨ã€‚ ä¸Šæ–‡çš„ä¸¤ä¸ªç»„ä»¶æ ‘çš„ ContentCheck é¡ºåºåˆ†åˆ«ä¸ºï¼šABCD å’Œ ABDCEFï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ˜ç™½ï¼Ÿ ç»“æœ æ€»ç»“æ€»çš„æ¥è¯´ï¼Œæ·˜æ°”é¬¼çš„é—®é¢˜åŸºæœ¬ä¸Šéƒ½è§£å†³äº†ï¼Œç®—æ˜¯å¯å–œå¯è´ºï¼Œæ™®å¤©åŒåº†äº†ã€‚Angular æœçœŸæ˜¯åšå¤§ç²¾æ·±ï¼Œçœ‹æºç éƒ½è¦çœ‹æ™•äº†ï¼Œä¸è¿‡ä¹Ÿå¤šäºäº†æ·˜æ°”é¬¼ï¼Œè®©æˆ‘å¯¹ Angular å˜åŒ–æ£€æµ‹çš„ç†è§£åˆä¸Šäº†ä¸€ä¸ªå°é˜¶ã€‚å¦å¤–ä¹Ÿå¯ä»¥çœ‹å‡ºåƒ Angular è¿™æ ·çš„å¤§æ¡†æ¶è¦æ˜¯æ²¡æœ‰ TypeScript æ¥æ”¯æŒï¼ŒçœŸçš„æ˜¯é¬¼æ‰çœ‹å¾—æ‡‚å®ƒçš„ä»£ç å’¯ã€‚","tags":[{"name":"Angular","slug":"Angular","permalink":"https://blog.imtouch.info/tags/Angular/"},{"name":"å˜åŒ–æ£€æµ‹","slug":"å˜åŒ–æ£€æµ‹","permalink":"https://blog.imtouch.info/tags/å˜åŒ–æ£€æµ‹/"},{"name":"æºç ","slug":"æºç ","permalink":"https://blog.imtouch.info/tags/æºç /"}]},{"title":"Angular å…¼å®¹ IE è¿‡ç¨‹é‡åˆ°çš„é—®é¢˜","date":"2018-02-06T01:54:05.000Z","path":"2018/02/06/angular-ie-support/","text":"ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼ŒWeb åº”ç”¨è¿˜æ˜¯éœ€è¦å…¼å®¹ Windows ä¸‹æœ€ã€Œè‘—åã€çš„æµè§ˆå™¨ Internet Explorer çš„ï¼Œå¯èƒ½ç°åœ¨ä¸éœ€è¦å†å…¼å®¹åˆ° IE6 è¿™ä¹ˆä½çš„ç‰ˆæœ¬ï¼Œä½† IE9/10/11 çš„å…¼å®¹å¯èƒ½ä¹Ÿå¤Ÿéº»çƒ¦äº†ã€‚ ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„ Angular + NG-ZORRO-ANTDï¼Œä¸¤è€…çš„å®˜ç½‘éƒ½è¯´èƒ½æ”¯æŒ IE9+ï¼Œå› æ­¤æˆ‘ä»¬æ„‰å¿«åœ°å¼€å§‹äº† IE å…¼å®¹çš„è¸©å‘ä¹‹æ—…ã€‚ å¼€å¯å®˜æ–¹æä¾›çš„ PolyfillsæŸ¥é˜…çš„æ— æ•°èµ„æ–™ç¬¬ä¸€æ­¥å‡†æ˜¯è®©ä½ æŠŠ angular-cli ç”Ÿæˆé¡¹ç›®ä¸­çš„ polyfills.ts ä¸­çš„ä¸€åˆ‡éƒ½æ‰“å¼€ï¼Œæœ¬ç€ã€ŒåŠ è½½æ…¢ä¸æ…¢å…ˆä¸ç®¡ï¼Œèƒ½ä¸èƒ½ç”¨æœ€é‡è¦ã€çš„åŸåˆ™ï¼Œæˆ‘ä»¬å½“ç„¶æŠŠå…¨éƒ¨éƒ½æ‰“å¼€äº†ã€‚ $ npm install --save classlist.js$ npm install --save web-animations-js$ npm install --save intl æŠŠæ³¨é‡Šé‡Œçš„å…¨éƒ¨å®‰è£…å®Œæ¯•ï¼Œä»¥ä¸ºå…¼å®¹ IE å°±æ˜¯è¿™ä¹ˆ Easy, æ‰“å¼€ç½‘é¡µä¾ç„¶æ˜¯ä¸€å †çš„æŠ¥é”™â€¦ é€ä¸ªå‡»ç ´date ç®¡é“è§£ææŠ¥é”™æˆ‘ä»¬åç«¯è¿”å›çš„æ—¥æœŸæ—¶é—´ç±»å‹æ˜¯ä¸€ä¸ªå½¢å¦‚ YYYY-MM-DD HH:mm:ss çš„å­—ç¬¦ä¸²ï¼Œå½“ä½¿ç”¨è‡ªå¸¦çš„ date ç®¡é“è¿›è¡Œæ ¼å¼åŒ–æ—¶ï¼š &#123;&#123;startDate | date: 'YYYYå¹´MMæœˆDDæ—¥'&#125;&#125; æŠ¥é”™äº†ï¼ŒIE11 æ— æ³•å°†ä¸æ ‡å‡†çš„æ—¥æœŸå­—ç¬¦ä¸²è½¬æ¢ä¸º Date å¯¹è±¡ï¼Œå› æ­¤éœ€è¦è‡ªå®šä¹‰ä¸€ä¸ªæ—¥æœŸæ—¶é—´æ ¼å¼åŒ–ç®¡é“ã€‚ Solved IE11 æŠ¥é”™ã€Œä¸èƒ½æ‰§è¡Œå·²é‡Šæ”¾ Script çš„ä»£ç ã€åœ¨ IE11 ä¸‹ä¼šæŠ¥è¿™ä¸ªé”™ï¼Œé”™è¯¯å®šä½çš„ä»£ç æ˜¯è¿™æ ·ï¼š var testString = delegate.toString(); // &lt;===== HERE!if ((testString === FUNCTION_WRAPPER || testString == BROWSER_TOOLS)) &#123; nativeDelegate.apply(target, args); return false;&#125; å»æœäº†ä¸€ä¸‹ï¼Œé©¬ä¸Šå°±æ‰¾åˆ°è§£å†³æ–¹æ³•äº†ï¼Œå‡ºé”™åŸå› å¯ä»¥çœ‹é‡Œé¢çš„è§£é‡Šã€‚ Angular 4 app using IE 11, â€œCanâ€™t execute code from a freed scriptâ€ Angular 4 put a global constant available to zone.js ä¸€æ¨¡ä¸€æ ·çš„æƒ…å†µï¼Œåœ¨ index.html åŠ ä¸Šä¸€è¡Œ script æŠŠé‚£ä¸ªå…¨å±€å˜é‡åŠ ä¸Šå»ã€‚ &lt;body&gt; &lt;app-root&gt;&lt;/app-root&gt; &lt;script&gt; window['__Zone_disable_IE_check'] = true; &lt;/script&gt;&lt;/body&gt; Solved Array.prototype.includes polyfillsåœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº† Array.prototype.includes è¿™ä¸ª ES7 æ–°ç‰¹æ€§ï¼Œéœ€è¦é¢å¤–çš„ polyfillsï¼Œå¦åˆ™ IE ä¸æ”¯æŒã€‚åˆ° MDN æ‰¾ä¸€ä¸‹å°±å¥½ã€‚ MDN - Array.prototype.includes() æˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª src/polyfills.js å¹¶åœ¨ polyfills.ts çš„æœ€å import è¿›å»ï¼ŒæŠŠè‡ªå·±å®ç°çš„ polyfill æ”¾åˆ° js æ–‡ä»¶é‡Œã€‚ Solved IE10 Flexbox æ”¯æŒ å¦‚æœè¦å…¼å®¹åˆ° IE9ï¼Œä½ å¯ä»¥å¿½ç•¥è¿™éƒ¨åˆ†å†…å®¹äº†ï¼Œè¯·ç¦æ­¢ä½ ï¼ˆå’Œå›¢é˜Ÿï¼‰ä½¿ç”¨ Flexbox å§ :Smile: åœ¨ä¸šåŠ¡ä¸­ï¼Œéå¸¸é¢‘ç¹çš„ä½¿ç”¨äº† Flexbox å¸ƒå±€ï¼ŒCanIUse ä¸Šè¡¨ç¤º Flexbox å¯¹ IE11 ä¹Ÿåªæ˜¯éƒ¨åˆ†æ”¯æŒï¼ŒIE10 ç›´æ¥æ ‡çº¢äº†ã€‚ä½†å…¶å® IE10 èƒ½å¤Ÿé€šè¿‡ prefix æ¥å®ç°ã€‚ div &#123; display: -ms-flexbox;&#125; é‚£å½“ç„¶ä¸å¯èƒ½æ‰‹åŠ¨æ¯ä¸ª div åŠ å•Šï¼Œæˆ‘ä»¬éœ€è¦ PostCSS çš„ Autoprefixerï¼Œç»è¿‡ä¸€ç•ªæŸ¥æ‰¾ï¼Œå‘ç° angular-cli å·²ç»é›†æˆäº† autoprefixerï¼ˆâ•°(Â°â–½Â°)â•¯ï¼‰ï¼Œé…ç½®ä¸€ä¸‹æµè§ˆå™¨åˆ—è¡¨å°±èƒ½èµ·æ•ˆäº†ã€‚ Change target browsers for Autoprefixer Solved IE11 æ— æ³•è·å–æœªå®šä¹‰æˆ– null å¼•ç”¨çš„å±æ€§ â€œcallâ€è¿™ä¸ªé—®é¢˜æ˜¯ä¸€ä¸ªé‡å­æ€çš„é—®é¢˜ï¼Œå¶å°”ä¼šå‡ºç°ï¼Œä½†å…³æ‰ IE å†é‡å¯åˆæ²¡é—®é¢˜äº†ï¼ŒçœŸçš„æ˜¯æ¥æç¬‘çš„ã€‚ æš‚æ—¶è®¤ä¸ºæ˜¯ livereload å¯¼è‡´çš„ä»£ç ç‰‡æ®µå‡ºé”™ï¼Œä¸å¤„ç†ã€‚ Observe IE9 ä¸æ”¯æŒ FileReaderæˆ‘ä»¬å®ç°çš„å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼Œä½¿ç”¨äº† FileReader æ¥è·å¾—å›¾ç‰‡çš„ base64 ç¼–ç ï¼Œå¹¶é€šè¿‡ç¼–ç ä¸Šä¼ çš„æœåŠ¡å™¨ã€‚ä½†åœ¨ IE9 ä¸‹ï¼Œå¹¶ä¸æ”¯æŒ FileReader. å…¶å®æˆ‘ä»¬åªéœ€è¦èƒ½å¤Ÿå°†å›¾ç‰‡è½¬æˆ base64 ç¼–ç å°±å¯ä»¥äº†ï¼ŒæŸ¥äº†ä¸€ä¸‹å¯ä»¥ç”¨ canvas æ¥è½¬è¯¶ï¼Œè€Œä¸” canvas IE9 ä¹Ÿæ”¯æŒï¼Œå¯ä»¥å°è¯•ã€‚ Under development IE10 ä½¿ç”¨äº† [hidden] éšè—å…ƒç´ åœ¨ä¸€äº›è‡ªå®šä¹‰çš„ç»„ä»¶ä¸­ï¼Œå¯¹ä¸€äº›å…ƒç´ ä½¿ç”¨äº† hidden å±æ€§æ¥è¿›è¡Œéšè—ï¼Œåœ¨ IE10 ä¸‹ä¼šæ— æ³•éšè—ã€‚ &lt;span class=\"close\" [hidden]=\"!allowRemove || !showControlBtn[i]\"&gt;&lt;/span&gt; å¾ˆå¯æƒœï¼Œhidden åœ¨ IE10 ä¸Šå¹¶ä¸æ”¯æŒã€‚ æ”¹æˆåˆ©ç”¨ display: none æ¥éšè—ï¼Œé—®é¢˜è§£å†³ã€‚ &lt;span class=\"close\" [class.close-not-exist]=\"!allowRemove || !showControlBtn[i]\"&gt;&lt;/span&gt; Solved IE9 requestAnimationFrame undefinedå¦‚æœä½¿ç”¨äº† Angular çš„åŠ¨ç”» @angular/animationï¼Œ åœ¨ IE9 ä¸‹ä¼šç”±äºä¸æ”¯æŒ requestAnimationFrame è€ŒæŠ¥é”™ã€‚è‡ªè¡ŒåŠ ä¸Šå¯¹åº”çš„ Polyfill å³å¯ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª requestAnimationFrame çš„ polyfill éœ€è¦åœ¨ Angular è‡ªå¸¦çš„ polyfills.ts ä¹‹å‰å¼•å…¥ï¼Œå› ä¸ºä¸‹é¢çš„ä»£ç ä¼šç”¨åˆ°è¿™ä¸ªå‡½æ•°ï¼ŒæŠŠ import è¯­å¥æ”¾åœ¨ polyfills.ts çš„å¼€å¤´å³å¯ã€‚ Solved IE11 ä¸‹æ”¹å˜ file input value ä¼šé‡æ–°è§¦å‘ change äº‹ä»¶è¿™ä¸ªè·Ÿ Angular å…³ç³»ä¸å¤§ï¼Œæˆ‘ä»¬å®ç°çš„ä¸å°‘å›¾ç‰‡ä¸Šä¼ æˆ–æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼Œåšæ³•éƒ½æ˜¯éšè—ä¸€ä¸ª input æ¡†ï¼Œå½“æœ‰æŸäº› click äº‹ä»¶æ—¶è°ƒç”¨ input.click() è°ƒå‡ºæ–‡ä»¶é€‰æ‹©å™¨ï¼Œé€‰æ‹©åé€šè¿‡ change äº‹ä»¶å¤„ç†ã€‚ åœ¨ change çš„å¤„ç†å‡½æ•°çš„æœ€åï¼Œä¼šæœ‰è¿™ä¹ˆä¸€å¥ this.fileEle.nativeElement.value = ''; åœ¨æ¯æ¬¡å¤„ç†å®Œç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶åï¼ŒæŠŠè¯¥ input æ¡†çš„å€¼æ¸…ç©ºã€‚è¿™ä¹ˆåšçš„åŸå› æ˜¯ change äº‹ä»¶åªæœ‰åœ¨æ–‡ä»¶å˜åŒ–æ—¶æ‰è¢«è§¦å‘ï¼Œå½“éœ€è¦å¤„ç†ä¸¤æ¬¡ä¸Šä¼ åŒä¸€ä¸ªæ–‡ä»¶çš„æƒ…å†µæ—¶ ç¬¬ä¸€æ¬¡é€‰æ‹©äº†æ–‡ä»¶ Aï¼Œç¬¬äºŒæ¬¡ä¾ç„¶é€‰æ‹©äº†æ–‡ä»¶ A ç¬¦åˆç»„ä»¶é¢„æœŸçš„è¡Œä¸ºåº”è¯¥æ˜¯è°ƒç”¨ä¸¤æ¬¡ change å›è°ƒã€‚è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œchange æœ¬èº«çš„è¯­ä¹‰æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåªæœ‰æ–‡ä»¶å˜åŒ–æ‰è°ƒç”¨ï¼Œä½†ç»„ä»¶å±‚é¢ä¸Šçš„è¯­ä¹‰åº”è¯¥æ˜¯æ¯æ¬¡ç”¨æˆ·é€‰æ‹©äº†æ–‡ä»¶éƒ½æ‰§è¡Œä¸€ä¸ªå›è°ƒï¼Œå› æ­¤å•çº¯çš„ change äº‹ä»¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ã€‚ å› æ­¤æ¯æ¬¡æŠŠ value = &#39;&#39; å³å¯è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä½†åœ¨ IE11 çš„å®ç°è®¤ä¸ºï¼Œè®¾ç½® value ç›¸å½“äºæ”¹å˜æ–‡ä»¶ï¼Œä¹Ÿéœ€è¦è°ƒç”¨ change å›è°ƒï¼ˆChrome / Firefox ç”šè‡³ IE10 ä¹Ÿä¸ä¼šè°ƒç”¨ï¼‰ï¼Œå› æ­¤ change å›è°ƒæ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œå…¶ä¸­ç¬¬äºŒæ¬¡çš„ e.target.files ä¸ºç©ºæ•°ç»„ï¼Œéœ€è¦ç‰¹åˆ«çš„å¤„ç†ã€‚ è¿™é‡Œæœ‰ä¸ªçŸ¥ä¹ä¸Šçš„è®¨è®ºï¼Œå¯¹ input file çš„ç‰¹æ€§è¿˜éœ€è¦è¿›ä¸€æ­¥å®è·µï¼Œå…ˆè®°å½•ä¸‹æ¥ Solved IE9 ä¸‹ Int32Array undefinedåœ¨ IE9 ä¸‹ï¼Œå¯åŠ¨åº”ç”¨å¹¶è¿›å…¥æ—¶æ§åˆ¶å°ä¼šæŠ¥è¿™ä¸ªé”™ï¼ŒInt32Array undefined ä¹‹ç±»çš„ã€‚æ‰¾åˆ°äº†è¿™ä¸ªï¼ŒåŠ ä¸Šæ–°çš„ polyfill å³å¯ã€‚ import 'core-js/es6/typed';","tags":[{"name":"Angular","slug":"Angular","permalink":"https://blog.imtouch.info/tags/Angular/"},{"name":"IE","slug":"IE","permalink":"https://blog.imtouch.info/tags/IE/"},{"name":"æµè§ˆå™¨å…¼å®¹","slug":"æµè§ˆå™¨å…¼å®¹","permalink":"https://blog.imtouch.info/tags/æµè§ˆå™¨å…¼å®¹/"}]},{"title":"Mac ä¸Šæ¸…é™¤ git osxkeychain ä¿å­˜çš„ç™»å½•åå¯†ç ","date":"2018-01-09T01:25:32.000Z","path":"2018/01/09/mac-clear-osxkeychain/","text":"æ˜¨å¤©åœ¨å…¬å¸çš„ Mac ä¸Š clone é¡¹ç›®æ—¶æŠ¥é”™ï¼Œæç¤ºæ— æ³•æ‰¾åˆ°é¡¹ç›®ã€‚åœ¨ç¡®ä¿¡åœ°å€æ²¡é”™çš„æƒ…å†µä¸‹ï¼Œå°±åº”è¯¥æ˜¯æƒé™ä¸è¶³å¯¼è‡´çš„æ— æ³•æ‰¾åˆ°é¡¹ç›®ã€‚ ä½†ä¸€èˆ¬ä½¿ç”¨ HTTP åè®®æ¥è¿›è¡Œ clone æ—¶ï¼Œéƒ½ä¼šæç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œä½†å¥‡æ€ªçš„æ˜¯è¿™æ¬¡å¹¶æ²¡æœ‰æç¤ºï¼Œè€Œæ˜¯ç›´æ¥æŠ¥é”™ï¼Œå› æ­¤æ€€ç–‘æ˜¯ Mac ä¸Šæœ‰è®°å½•äº†é»˜è®¤çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä¸”è¯¥ç”¨æˆ·åœ¨ Gitlab ä¸Šæ²¡æœ‰è¿™ä¸ªä»“åº“çš„æƒé™ã€‚ $ git clone http://172.16.18.121/erp/mobileApproval.gitCloning into 'mobileApproval'...remote: The project you were looking for could not be found.fatal: repository 'http://172.16.18.121/erp/mobileApproval.git/' not found Git å‡­è¯ç®¡ç†ç”±äºå¹³æ—¶å¤§å¤šæ•°æ—¶å€™éƒ½åœ¨ä½¿ç”¨ SSH æ–¹å¼è¿æ¥ Git ä»“åº“ï¼Œå¯¹ä½¿ç”¨ HTTP æ–¹å¼çš„ç”¨æˆ·åå¯†ç ç®¡ç†ä¸æ˜¯å¾ˆç†Ÿï¼Œå› æ­¤å»çœ‹äº†ä¸‹å®˜æ–¹æ–‡æ¡£ï¼ŒGit - å‡­è¯ç®¡ç†ï¼Œé‡Œé¢æåˆ°äº†å‡ ç‚¹ï¼š é»˜è®¤æ‰€æœ‰éƒ½ä¸ç¼“å­˜ã€‚ æ¯ä¸€æ¬¡è¿æ¥éƒ½ä¼šè¯¢é—®ä½ çš„ç”¨æˆ·åå’Œå¯†ç ã€‚ â€œstoreâ€ æ¨¡å¼ä¼šå°†å‡­è¯ç”¨æ˜æ–‡çš„å½¢å¼å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œå¹¶ä¸”æ°¸ä¸è¿‡æœŸã€‚ è¿™æ„å‘³ç€é™¤éä½ ä¿®æ”¹äº†ä½ åœ¨ Git æœåŠ¡å™¨ä¸Šçš„å¯†ç ï¼Œå¦åˆ™ä½ æ°¸è¿œä¸éœ€è¦å†æ¬¡è¾“å…¥ä½ çš„å‡­è¯ä¿¡æ¯ã€‚ è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯ä½ çš„å¯†ç æ˜¯ç”¨æ˜æ–‡çš„æ–¹å¼å­˜æ”¾åœ¨ä½ çš„ home ç›®å½•ä¸‹ã€‚ å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Macï¼ŒGit è¿˜æœ‰ä¸€ç§ â€œosxkeychainâ€ æ¨¡å¼ï¼Œå®ƒä¼šå°†å‡­è¯ç¼“å­˜åˆ°ä½ ç³»ç»Ÿç”¨æˆ·çš„é’¥åŒ™ä¸²ä¸­ã€‚ è¿™ç§æ–¹å¼å°†å‡­è¯å­˜æ”¾åœ¨ç£ç›˜ä¸­ï¼Œå¹¶ä¸”æ°¸ä¸è¿‡æœŸï¼Œä½†æ˜¯æ˜¯è¢«åŠ å¯†çš„ï¼Œè¿™ç§åŠ å¯†æ–¹å¼ä¸å­˜æ”¾ HTTPS å‡­è¯ä»¥åŠ Safari çš„è‡ªåŠ¨å¡«å†™æ˜¯ç›¸åŒçš„ã€‚ ç‰¹åˆ«å…³æ³¨æ°¸ä¸è¿‡æœŸä¸ Mac ç­‰å…³é”®å­—å¯ä»¥ç­›é€‰å‡ºè¿™å‡ æ®µæè¿°ï¼Œç®€å•æ¥è¯´å°±æ˜¯ã€Œå¯ä»¥æŠŠä½ çš„ç”¨æˆ·åå¯†ç æ°¸è¿œå­˜åœ¨ç”µè„‘ä¸Šã€ï¼Œå› æ­¤è§£å†³è¿™ä¸ªé—®é¢˜åªéœ€è¦æŠŠè¿™ä¸ªåˆ æ‰å°±å¯ä»¥äº†ã€‚ OSXKeychainæ ¹æ®å®˜æ–¹è¯´æ˜ï¼Œæ˜¯é€šè¿‡è¿™ä¸ªå‘½ä»¤è®¾ç½®ç¼“å­˜çš„ git config --global credential.helper &lt;mode&gt; æ¨¡å¼å¯èƒ½æ˜¯ cache æˆ–è€…æ˜¯ storeï¼Œå¯èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–æ•°æ®ã€‚å½“æ‰§è¡Œå®Œåï¼Œå…¶å®ä¹Ÿå°±æ˜¯å¾€ .gitconfig æ–‡ä»¶æ·»åŠ å†…å®¹ï¼ˆä¹Ÿæœ‰å¯èƒ½æ˜¯ .git-credentialï¼‰ï¼Œç»è¿‡ä¸€ç•ªæ‘¸ç´¢ï¼Œå‘ç°è¿™äº›æ–‡ä»¶éƒ½æ²¡æœ‰ä»€ä¹ˆå¼‚å¸¸ï¼Œæ²¡æœ‰æ‰¾åˆ°ä»»ä½•ä¸è´¦å·å¯†ç ç›¸å…³çš„ä¿¡æ¯ã€‚ äºæ˜¯è§‰å¾—å¾ˆå¤§å¯èƒ½ä¼šæ˜¯æ–‡æ¡£æåˆ°çš„ osxkeychain å¯¼è‡´çš„ï¼ˆOS X æœ‰æ—¶å€™å°±æ˜¯è¿™ä¹ˆå‚»ï¼‰ã€‚äº†è§£äº†åŸå› ä¹‹åå°±å¯ä»¥å» Google äº†ï¼Œæœä¸€ä¸‹ git disable credential-helper osxkeychain è¿™å‡ ä¸ªå…³é”®å­—å¾ˆå®¹æ˜“æ‰¾åˆ°è¿™ç¯‡ disable git credential-osxkeychain æŒ‰é«˜ç¥¨å›ç­”åšäº†ä¸€é # å…¨éƒ¨ unset ä¸€éå‘—$ git config --local --unset credential.helper$ git config --global --unset credential.helper# è¿™ä¸ªè¦ sudo$ sudo git config --system --unset credential.helper# è¿™ä¸‰ä¸ªå‘½ä»¤éƒ½æ²¡æœ‰æ˜¾ç¤ºä»»ä½•ä¸œè¥¿äº†$ git config --local credential.helper$ git config --global credential.helper$ git config --system credential.helper ä½†å‘ç°è¿˜æ˜¯ä¸èƒ½æˆåŠŸæç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç ï¼Œç»§ç»­å°è¯•ç¬¬äºŒé¡ºä½çš„å›ç­” # è¿˜çœŸçš„ä¾ç„¶æœ‰ osxkeychain$ git config -lcredential.helper=osxkeychain# è·Ÿå›ç­”ä¸€æ¯›ä¸€æ ·$ git config --show-origin --get credential.helperfile:/Applications/Xcode.app/Contents/Developer/usr/share/git-core/gitconfig osxkeychain å¥½äº†ï¼Œç»ˆäºå‘ç°è¿™ä¸ªç”¨æˆ·åå¯†ç æ˜¯å“ªé‡Œæå‡ºæ¥çš„äº†ï¼ŒæŠŠé‚£ä¸ªæ–‡ä»¶é‡Œçš„ credential é…ç½®åˆ æ‰å³å¯é‡æ–°æç¤ºè¾“å…¥ç”¨æˆ·åå¯†ç äº†ã€‚","tags":[{"name":"Mac","slug":"Mac","permalink":"https://blog.imtouch.info/tags/Mac/"},{"name":"Git","slug":"Git","permalink":"https://blog.imtouch.info/tags/Git/"}]},{"title":"æ¿€å‘ï¼Angular ä½¿ç”¨ Http æ¨¡å—å’Œ FormData ä¸Šä¼ æ–‡ä»¶","date":"2018-01-02T01:48:40.000Z","path":"2018/01/02/angular-formdata-upload-bug/","text":"æœ€è¿‘é‡è§ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ï¼Œä¾¿æ˜¯ä¸Šä¼  Excel æ–‡ä»¶åˆ°åç«¯è¿›è¡Œè§£æã€‚è¿™ç§ä¸œè¥¿åšå¾—å¤šäº†ï¼Œå¯¹å‰ç«¯æ¥è¯´æ— éå°±æ˜¯ä¸Šä¼ ä¸ªæ–‡ä»¶ï¼Œè§£æçš„é€»è¾‘æˆ‘åˆä¸ç®¡çš„ï¼Œeasy job å•¦~ å¯¹äºç°ä»£æµè§ˆå™¨æ¥è¯´ï¼Œé€šè¿‡ FormData è¿›è¡Œæ–‡ä»¶ä¸Šä¼ å·²ç»æ˜¯å¾ˆé€šç”¨çš„åšæ³•äº†ï¼Œå†ä¹Ÿä¸éœ€è¦ä½¿ç”¨åƒæ„é€  form å…ƒç´ è¿™ç§æ–¹æ³•å»åšæµè§ˆå™¨å…¼å®¹ã€‚å¯ä»¥çœ‹åˆ° FormData çš„å…¼å®¹æ€§è¿˜æ˜¯å¯ä»¥çš„ã€‚ CanIUse - FormData ç”±äºæ­£åœ¨ä½¿ç”¨ Angularï¼Œäºæ˜¯ç›´æ¥ç”¨è‡ªå¸¦çš„ HTTP æœåŠ¡ä¸Šä¼ æ–‡ä»¶å§ const file = event.target.files[0];const formData = new FormData();formData.append('file', file);this.http.request(url, new RequestOptions(&#123; method: RequestMethod.Post, body: formData, headers: new Headers(&#123; 'Authorization': `Bearer $&#123;token&#125;` 'Content-Type': 'multipart/form-data' &#125;)&#125;)); ä¸€åˆ‡éƒ½å¾ˆç¾å¥½ï¼Œä½†åç«¯å“¥å“¥åæ‰‹å°±ä¸¢æ¥ä¸€ä¸ªæŠ¥é”™ï¼š HTTP Status 400 - Required MultipartFile parameter &apos;file&apos; is not present çº³å°¼ï¼æˆ‘å»çœ‹äº†ä¸‹ Chrome dev toolï¼Œå§æ§½æ–‡ä»¶ä¸è§äº†ã€‚ä¸ºäº†æŠŠé”…åˆ†å¾—æ¸…æ¸…æ¥šæ¥šæ˜æ˜ç™½ç™½ï¼Œå¿«ä½¿ç”¨ Postmanï¼ è¯·æ±‚æ­£ç¡®è¿”å› ä¸‡å¿µä¿±ç°å•Šï¼ï¼ï¼ï¼ï¼ï¼ äºæ˜¯åªèƒ½ä¸åœåœ° Googleï¼Œç»ˆäºæ‰¾åˆ°äº†è¿™ä¸ªï¼š Form data is empty when calling http.post() with ContentType header çº³å°¼ï¼è¿™ä¸ª http æ¨¡å—æœ‰ bugï¼FormData ä¸èƒ½ä¼ æ–‡ä»¶ï¼Œæ‰€ä»¥åç«¯æ‹¿ä¸åˆ°å€¼ã€‚ æ¢æˆæœ€åŸå§‹çš„ XMLHttpRequest const xhr = new XMLHttpRequest();xhr.open('POST', url);xhr.setRequestHeader('Authorization', `Bearer $&#123;token&#125;`);xhr.send(body);xhr.onload = () =&gt; &#123; if (xhr.status === 200) &#123; console.log(xhr.response); &#125;&#125;; å°±æ²¡æœ‰é—®é¢˜äº†ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚ é‚£ä¸ª Issue çš„çŠ¶æ€æ˜¯ Closed, ç›®æµ‹å¯èƒ½åœ¨ 5+ ä¿®å¤äº†ï¼Ÿæˆ‘è¿™é‡Œçš„ç¯å¢ƒæ˜¯ Angular 4.4.4ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ HttpModule è¿˜æ˜¯ HttpClientModule è¿›è¡Œ FormData çš„æ–‡ä»¶ä¸Šä¼ ï¼Œåç«¯å‡æ‹¿ä¸åˆ°å€¼ã€‚","tags":[{"name":"Angular","slug":"Angular","permalink":"https://blog.imtouch.info/tags/Angular/"},{"name":"FormData","slug":"FormData","permalink":"https://blog.imtouch.info/tags/FormData/"}]},{"title":"æœåŠ¡å™¨ç”±é›¶é…ç½®","date":"2017-12-06T06:55:31.000Z","path":"2017/12/06/server-configurate/","text":"ä¸€ç›´éƒ½åœ¨ç”¨ Vultr çš„æœåŠ¡å™¨ï¼Œä½†æ˜¯ç½‘é€ŸçœŸçš„å¤ªç‰¹ä¹ˆæ…¢äº†ï¼Œ100+ æ¯«ç§’çš„ pingï¼Œç»å¸¸è¿ 4G éƒ½è®¿é—®ä¸äº†ï¼Œåšåšå®éªŒè¿˜è¡Œï¼Œæœ‰åº”ç”¨éƒ¨ç½²åœ¨ä¸Šé¢å°±å®Œå…¨ç”¨ä¸äº†ã€‚æ‰€ä»¥æœ€åè¿˜æ˜¯é€‰æ‹©äº†å›½å†…å¤§å“¥é˜¿é‡Œäº‘ï¼ˆå°¼ç›è´µäº†ä¸€å€æœ‰å¤š é‚£ä¹ˆåˆè¦é‡æ–°åœ¨ä¸Šé¢éƒ¨ç½²å®‰è£…å„ç§ç¯å¢ƒã€è½¯ä»¶äº†ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ï¼Œé˜²æ­¢ä»¥ååˆè¦å†è¿ç§»ã€‚ æœ¬æ–‡ä½¿ç”¨çš„æœåŠ¡å™¨ä¸º CentOS 7.4ï¼Œéœ€è¦é…ç½®çš„ç¯å¢ƒåŒ…æ‹¬ï¼š MySQLï¼Œè¿œç¨‹è®¿é—® / ä¸­æ–‡ç¼–ç  Nginxï¼Œé…ç½® https / http2 / å¼€å¯gzip / SPA æ”¯æŒ / ä»£ç† RESTFul è·¯ç”± Node.js Git MySQLæŸ¥çœ‹ CentOS ç‰ˆæœ¬$ cat /etc/redhat-releaseCentOS Linux release 7.4.1708 (Core) é…ç½® Yum æº$ curl -LO http://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm$ sudo yum localinstall mysql57-community-release-el7-11.noarch.rpm# æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ$ sudo yum repolist enabled | grep &quot;mysql.*-community.*&quot;mysql-connectors-community/x86_64 MySQL Connectors Community 42mysql-tools-community/x86_64 MySQL Tools Community 55mysql57-community/x86_64 MySQL 5.7 Community Server 227 å®‰è£…$ sudo yum install mysql-community-server å¯åŠ¨æœåŠ¡å¹¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€$ sudo systemctl enable mysqld$ sudo systemctl start mysqld$ sudo systemctl status mysqld ä¿®æ”¹ root å¯†ç å¹¶è®¾ç½®å…è®¸è¿œç¨‹è®¿é—®MySQL 5.7 å¯åŠ¨åï¼Œåœ¨ /var/log/mysqld.log æ–‡ä»¶ä¸­ç»™ root ç”Ÿæˆäº†ä¸€ä¸ªé»˜è®¤å¯†ç ã€‚é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ‰¾åˆ° root é»˜è®¤å¯†ç ï¼Œç„¶åç™»å½• mysql è¿›è¡Œä¿®æ”¹ï¼š $ grep &apos;temporary password&apos; /var/log/mysqld.log[Note] A temporary password is generated for root@localhost: **********$ mysql -u root -pEnter password: mysql&gt; ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;&lt;æ–°å¯†ç &gt;&apos;;mysql&gt; GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;&lt;æ–°å¯†ç &gt;&apos;; è¿™é‡Œæ³¨æ„ MySQL æœ‰ç›¸åº”çš„å¯†ç ç­–ç•¥ï¼Œä¸å…è®¸è®¾ç½®ä¸€äº›å¼ºåº¦è¾ƒä½çš„å¯†ç ï¼Œä¸€èˆ¬æ¥è¯´æœ‰å¤§å°å†™å­—æ¯ä¸æ•°å­—å­—æ¯å³å¯é€šè¿‡æ ¡éªŒã€‚è‹¥è¦å–æ¶ˆé™åˆ¶å¯å‚è€ƒ é…ç½®é»˜è®¤ç¼–ç ä¸º UTF-8mb4åœ¨é…ç½®æ–‡ä»¶ä¸­çš„å¯¹åº”ä½ç½®ï¼ŒåŠ ä¸Šä»¥ä¸‹é…ç½®ã€‚ï¼ˆé»˜è®¤å¼•æ“ä½¿ç”¨ InnoDB å¯ä»¥å»æ‰ï¼Œçœ‹å®é™…éœ€æ±‚ï¼‰ $ vi /etc/my.cnf[mysqld]character_set_server=utf8mb4collation-server=utf8mb4_unicode_cidefault-storage-engine=INNODB[client]default-character-set=utf8 é‡å¯æœåŠ¡ $ sudo systemctl restart mysqld ç™»å½• MySQL æŸ¥çœ‹è®¾ç½®æ˜¯å¦æˆåŠŸã€‚ mysql&gt; SHOW VARIABLES LIKE &apos;character%&apos;;+--------------------------+----------------------------+| Variable_name | Value |+--------------------------+----------------------------+| character_set_client | utf8 || character_set_connection | utf8 || character_set_database | utf8mb4 || character_set_filesystem | binary || character_set_results | utf8 || character_set_server | utf8mb4 || character_set_system | utf8 || character_sets_dir | /usr/share/mysql/charsets/ |+--------------------------+----------------------------+8 rows in set (0.22 sec) å¼€å¯ç«¯å£å¦‚æœå¯ç”¨äº†é˜²ç«å¢™ï¼Œéœ€è¦å¼€å¯ç«¯å£ã€‚ $ sudo firewall-cmd --zone=public --add-port=3306/tcp --permanent$ sudo firewall-cmd --reload å¦‚æœä½¿ç”¨é˜¿é‡Œäº‘çš„è¯ï¼Œè¿˜éœ€è¦åœ¨ç®¡ç†æ§åˆ¶å°é…ç½®å®‰å…¨ç»„ï¼Œåœ¨å…¬ç½‘å…¥æ–¹å‘å¼€æ”¾ 3306 ç«¯å£ï¼Œå¦åˆ™å¤–ç½‘æ— æ³•è¿œç¨‹è¿æ¥åˆ° MySQL ä¸Š Nginxä¹‹å‰åœ¨ Vultr ä¸Šè£…çš„ Nginx ä¸èƒ½å¼€ HTTP2ï¼Œå› ä¸º OpenSSL çš„ç‰ˆæœ¬ä¸å¯¹ï¼Œè¦æºç ç¼–è¯‘å®‰è£…ç”¨ 1.0.2 çš„ openssl. ä½†ç°åœ¨ CentOS 7.4 å·²ç»ç”¨ä¸Šäº†æœ€æ–°çš„ openssl äº†ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ yum è£…å°±å¯ä»¥æ”¯æŒ http2 äº†ï¼ $ yum install nginx$ nginx è£…å¥½ä¹‹åé©¬ä¸Šå¯åŠ¨ï¼Œå°±èƒ½è®¿é—®äº†ï¼Œè¿™æ ·å®‰è£…çš„é»˜è®¤é…ç½®ä¸º Nginx é…ç½®æ–‡ä»¶ï¼š/etc/nginx Nginx Web æ ¹ç›®å½•ï¼š/usr/share/nginx/html ç„¶åæœ‰å‡ ä»¶äº‹è¦æå®šï¼šHTTPSã€gzipã€å•é¡µè·¯ç”±é…ç½®ã€API ä»£ç† HTTPS/HTTP2è¿™é‡Œåº”è¯¥æ˜¯åŒ…æ‹¬äº† HTTP2 çš„ï¼Œä½†æ˜¯æœ€æ–°ç‰ˆçš„ nginx çš„ https æ¨¡å—æ˜¯é»˜è®¤å¼€å¯äº† h2 çš„ï¼Œæ‰€ä»¥åªéœ€è¦å¼€å¯ https å°±å¯ä»¥äº†ã€‚ https éœ€è¦è¯ä¹¦è®¤è¯ï¼Œå…è´¹è¯ä¹¦é Letâ€˜s encrypt æœ€å¥½ç”¨äº†ï¼Œé…åˆ certbot å·¥å…·ï¼Œæ‹¿åˆ°ä¸€ä¸ªè¯ä¹¦æ˜“å¦‚åæŒã€‚ è·å– Certbot å®¢æˆ·ç«¯$ wget https://dl.eff.org/certbot-auto$ chmod a+x ./certbot-auto$./certbot-auto --help éªŒè¯åŸŸåï¼Œå¹¶é…ç½® nginx ä½¿ç”¨è¯ä¹¦åœ¨ nginx çš„é…ç½®æ–‡ä»¶ server ä¸­æ·»åŠ ä¸‹åˆ—é…ç½®ï¼Œä¸ºäº†é€šè¿‡ Letâ€™s Encrypt çš„éªŒè¯ location ^~ /.well-known/acme-challenge/ &#123; default_type &quot;text/plain&quot;; root /usr/share/nginx/html;&#125;location = /.well-known/acme-challenge/ &#123; return 404;&#125; æµ‹è¯•é…ç½®æ–‡ä»¶æ˜¯å¦æœ‰æ•ˆï¼Œé‡å¯ nginx $ nginx -t$ nginx -s reload ç”Ÿæˆè¯ä¹¦ï¼Œæœ€åæ¢æˆéœ€è¦è¿›è¡Œè®¤è¯çš„åŸŸå $ ./certbot-auto certonly --webroot -w /usr/share/nginx/html -d imtouch.info æˆåŠŸåï¼Œåœ¨ nginx çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ï¼Œæ³¨æ„ ssl_certificate/ssl_certificate_key çš„è·¯å¾„æ­£ç¡® server &#123; listen 443 ssl http2 default_server; listen [::]:443 ssl http2 default_server; server_name imtouch.info; root /usr/share/nginx/html; ssl_certificate &quot;/etc/letsencrypt/live/imtouch.info/fullchain.pem&quot;; ssl_certificate_key &quot;/etc/letsencrypt/live/imtouch.info/privkey.pem&quot;; ssl_session_cache shared:SSL:1m; ssl_session_timeout 10m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on;&#125; å†æ¬¡ç¡®è®¤é…ç½®æ–‡ä»¶æ­£ç¡®ï¼Œé‡å¯ nginx å³å¯ $ nginx -t$ nginx -s reload è¯ä¹¦ä¸åŸŸåæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå½“éœ€è¦ä½¿ç”¨äºŒçº§åŸŸåæ—¶ï¼Œéœ€è¦å†æŒ‰è¿™ä¸ªæµç¨‹ç”³è¯·ä¸€ä¸ªæ–°çš„è¯ä¹¦ è‡ªåŠ¨æ›´æ–°è¯ä¹¦æµ‹è¯•ä¸€ä¸‹æ›´æ–°ï¼Œè¿™ä¸€æ­¥æ²¡æœ‰åœ¨çœŸçš„æ›´æ–°ï¼Œåªæ˜¯åœ¨è°ƒç”¨ Certbot è¿›è¡Œæµ‹è¯• $ ./certbot-auto renew --dry-run çœ‹åˆ°æˆåŠŸä¹‹åå°±å¯ä»¥é…ç½®è‡ªåŠ¨æ›´æ–°äº† # æ‰‹åŠ¨æ›´æ–°$ ./certbot-auto renew -v$ ./certbot-auto renew --quiet --no-self-upgrade å¼€å¯ gzipåœ¨ /etc/nginx/nginx.conf çš„ server åŸŸåŠ å…¥ä»¥ä¸‹è¯­å¥ æ³¨æ„ JavaScript çš„èµ„æºæœ‰å¯èƒ½ content-type æ˜¯ application/javascriptï¼Œæ¼äº†è¿™ä¸ªä¸€ç›´æ²¡å‹ç¼© js gzip on;gzip_min_length 1k;gzip_buffers 4 16k;gzip_comp_level 5;gzip_types text/plain application/x-javascript text/css application/xml text/javascript application/x-httpd-php application/javascript; å•é¡µè·¯ç”±è®¾ç½®å½“æˆ‘ä»¬éƒ¨ç½²äº†å•é¡µåº”ç”¨åœ¨ nginx ä¸Šæ—¶ï¼ˆå¦‚ Vueã€Angular ç­‰ï¼‰ï¼Œå¦‚æœåº”ç”¨çš„å‰ç«¯è·¯ç”±æ˜¯ä½¿ç”¨ HTML5 æ–°çš„ history API æ¥åšè·¯ç”±ï¼ˆå°±æ˜¯åœ°å€æ çœ‹ä¸åˆ° #ï¼Œä¸æ˜¯ç”¨çš„ Hashï¼‰ï¼Œå½“ç”¨æˆ·åˆ·æ–°é¡µé¢çš„æ—¶å€™ï¼Œä¼šç”±äºç›´æ¥æ‰¾åˆ° nginx å¯¹åº”çš„ Web ç›®å½•è€ŒæŠ¥ 404ã€‚å› æ­¤éœ€è¦è®¾ç½® nginx å½“æ‰¾ä¸åˆ°æ–‡ä»¶æ—¶ï¼Œå®šä½å› index.html. location /fastfood/ &#123; try_files $uri $uri/ /fastfood/index.html;&#125; try_files ä¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±è·³è½¬è‡³åº”ç”¨æ‰€åœ¨çš„ index.html API ä»£ç†ä½¿ç”¨ nginx å¯ä»¥ä»£ç†å¼€æ”¾åœ¨å†…éƒ¨ç«¯å£çš„ API åç«¯åº”ç”¨ï¼Œè¿™æ ·å°±ä¸ç”¨å¤„ç†è·¨åŸŸçš„é—®é¢˜ï¼Œè€Œä¸”å®‰å…¨æ€§æ›´å¥½ location ^~ /fastfood/api/ &#123; rewrite ^/fastfood/api/(.*) /fastfood/api/$1 break; proxy_http_version 1.1; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header X-NginX-Proxy true; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &quot;upgrade&quot;; proxy_pass http://127.0.0.1:8360/; proxy_redirect off;&#125; å°†æ‰€æœ‰ /fastfood/api çš„è¯·æ±‚ä»£ç†åˆ°åç«¯çš„ 8360 ç«¯å£ã€‚ Node.jsæŒ‰å®˜ç½‘è¯´æ˜ï¼Œç›´æ¥ç”¨ yum å®‰è£…å³å¯ã€‚ $ curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -$ sudo yum -y install nodejs$ node -v$ npm -v Gitç›´æ¥ä½¿ç”¨ yum install git å®‰è£…å³å¯ã€‚ å‚è€ƒèµ„æ–™ CentOS 7 ä¸‹ Yum å®‰è£… MySQL 5.7 HTTPS ç®€ä»‹åŠä½¿ç”¨å®˜æ–¹å·¥å…· Certbot é…ç½® Letâ€™s Encrypt SSL å®‰å…¨è¯ä¹¦è¯¦ç»†æ•™ç¨‹ Installing Node.js via package manager","tags":[{"name":"æœåŠ¡å™¨","slug":"æœåŠ¡å™¨","permalink":"https://blog.imtouch.info/tags/æœåŠ¡å™¨/"},{"name":"MySQL","slug":"MySQL","permalink":"https://blog.imtouch.info/tags/MySQL/"},{"name":"Nginx","slug":"Nginx","permalink":"https://blog.imtouch.info/tags/Nginx/"}]},{"title":"Ionic æ„å»ºç”Ÿäº§ç‰ˆæœ¬æŠ¥é”™ Maximum call stack size","date":"2017-11-18T02:30:03.000Z","path":"2017/11/18/ionic-maximum-call-error/","text":"Ionic æ„å»ºå¤±è´¥ä½¿ç”¨ ionic-app-scripts build æ„å»ºä¸€ä¸ªåº”ç”¨çš„ç”Ÿäº§ç‰ˆæœ¬æ—¶ï¼Œå‘ç°å‡ºç°äº†ä»¥ä¸‹çš„é”™è¯¯ï¼š [18:21:18] ionic-app-script task: &quot;build&quot;[18:21:18] Error: ./node_modules/sockjs-client/lib/main.js Module build failed: RangeError: Maximum call stack size exceeded at narrowTypeByInstanceof (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:36003:44) at narrowTypeByBinaryExpression (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:35911:32) at narrowType (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:36124:32) at narrowType (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:36122:32) at narrowType (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:36127:36) at getTypeAtFlowCondition (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:35723:36) at getTypeAtFlowNode (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:35604:32) at getFlowTypeOfReference (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:35560:51) at checkIdentifier (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:36313:28) at checkExpressionWorker (/Users/ryancui/kit/zhangting-wx/node_modules/typescript/lib/typescript.js:41277:28) @ ./node_modules/sockjs-client/lib/entry.js 3:17-34 @ ./src/pages/home/business-consultation/BusinessConsultationService.ts @ ./src/app/app.module.ngfactory.ts @ å®šä½ä¸€ä¸‹é—®é¢˜ï¼Œå‘ç°æ˜¯ä½¿ç”¨äº† sockjs-client çš„åŒ…å¯¼è‡´çš„ï¼Œæ³¨é‡Šæ‰ä¸‹é¢ä¸€å¥çš„ä»£ç åï¼Œå‘ç°ç¼–è¯‘é€šè¿‡äº†ï¼ const sock = new SockJS(WEBSOCKET_URL + '/consulting?token=' + this.globalData.token); å¦å¤–ï¼Œç›´æ¥ç”¨ npm run build æ‰“åŒ…å¹¶ä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œåªæœ‰ npm run build --prod æ‰å‡ºç°é—®é¢˜ã€‚ç”±äºä½¿ç”¨äº† --prod æ‰“å‡ºçš„åŒ…ä½“ç§¯æ¯” --dev ä¼šå°å¾ˆå¤šï¼Œå› æ­¤è¿™ä¸ªé—®é¢˜å¿…é¡»è§£å†³ã€‚ æ€ä¹ˆåŠé‡äº‹ä¸å†³æ‰¾ Googleï¼Œä¸€ç•ªæŸ¥æ‰¾æ‰¾åˆ°äº†ä¸€ä¸ªä¸€æ¯›ä¸€æ ·çš„é—®é¢˜ï¼Œå¯æƒœä¸‰ä¸ªæœˆäº†å¹¶æ²¡æœ‰äººé¸Ÿä»–ã€‚ ionic production build fails when using sockjs-client with â€œMaximum call stack size exceededâ€ å®åœ¨å¤ªæƒ¨äº†ï¼Œçœ‹æ¥è¿™ä¸ªé—®é¢˜æœ‰ç‚¹å¤æ‚å•Šã€‚ æ˜¯è°çš„é”…å…ˆæŠŠé”…åˆ†å‡ºå»ï¼Œæ¶‰åŠåˆ°è¿™ä¸ª build çš„æœ‰ï¼š Ionic Framework Webpack TypeScript sockjs-client å› æ­¤ï¼Œé¦–å…ˆåœ¨ç”¨ angular-cli åˆå§‹çš„é¡¹ç›®é‡Œæ‰“åŒ…ä¸€ä¸‹è¿™ä¸ª sockjsï¼Œå‘ç°å¹¶æ²¡æœ‰é—®é¢˜ï¼ŒåŠ ä¸Š build æ—¥å¿—ä¸­çš„ ngc ç¼–è¯‘æ²¡æœ‰æŠ¥é”™ï¼ŒæŠ¥é”™å‡ºç°åœ¨ webpack started åï¼Œå› æ­¤ TypeScript å’Œ sockjs-client éƒ½åº”è¯¥æ˜¯æ¸…ç™½çš„ã€‚ é‚£åº”è¯¥æ˜¯ ionic-app-scripts è¿˜æœ‰å®ƒä¾èµ–çš„ webpack çš„é—®é¢˜äº†ï¼Œå»æœä¸‹ Issueï¼Œå‘ç°äº†è¿™ä¸ªï¼š [3.0.0] JavaScript heap out of memory å¤§æ„æ˜¯æŠŠ ionic-app-scripts ä» 2.1.4 å‡çº§åˆ° 3.1.2 åï¼Œä½¿ç”¨ --prod æ‰“åŒ…ä¼šå‡ºç° JavaScript å †æº¢å‡ºã€‚ ç°åœ¨æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ˜¯è°ƒç”¨æ ˆæ»¡äº†ï¼Œä¸ºä»€ä¹ˆè°ƒç”¨æ ˆä¼šæ»¡äº†å‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ sockjs-client è¿™ç§ä½¿ç”¨è¿™ä¹ˆå¹¿æ³›çš„åº“åº”è¯¥ä¸ä¼šæ˜¯ä»£ç çš„ bug, è”æƒ³ä¸€ä¸‹å…¶å®è·Ÿè¿™ä¸ªé‡åˆ°çš„é—®é¢˜æ˜¯ç±»ä¼¼çš„ã€‚ è§£å†³Issue è¯´åœ¨ 2.1.4 æ²¡é—®é¢˜ï¼Œ3.1.2 å †æº¢å‡ºäº†ï¼Œä½†æˆ‘ä»¬åœ¨ç”¨ 2.1.4 å•Šï¼Œç‰¹ä¹ˆè°ƒç”¨æ ˆæº¢å‡ºäº†å•Šã€‚Fine, Letâ€™s try 3.1.2 [11:57:08] ionic-app-scripts 3.1.2[11:57:08] build prod started ...[11:57:08] clean started ...[11:57:08] clean finished in 2 ms[11:57:08] copy started ...[11:57:08] copy finished in 94 ms[11:57:08] deeplinks started ...[11:57:08] deeplinks finished in 21 ms[11:57:08] ngc started ...[11:57:16] ngc finished in 7.87 s[11:57:16] preprocess started ...[11:57:16] preprocess finished in 1 ms[11:57:16] webpack started ...[11:58:08] webpack finished in 52.80 s[11:58:08] uglify started ...[11:58:08] sass started ...[11:58:10] sass finished in 1.06 s[11:58:10] cleancss started ...[11:58:11] cleancss finished in 1.06 s[11:58:29] uglify finished in 20.64 s[11:58:29] postprocess started ...[11:58:29] postprocess finished in 51 ms[11:58:29] lint started ...[11:58:29] build prod finished in 81.53 s[11:58:32] lint finished in 2.48 s å¯ä»¥äº†ä½ æ•¢ä¿¡ï¼ ç„¶è€Œæ³¨æ„åˆ° webpack æ‰“åŒ…å±…ç„¶ç”¨äº†è¿‘ä¸€åˆ†é’Ÿï¼Œä¼šä¸ä¼šè¿™æ¬¡åªæ˜¯ä¾¥å¹¸æˆåŠŸå‘¢ï¼Ÿ å¤šè¯•å‡ æ¬¡åº”è¯¥æ˜¯æ²¡æœ‰é—®é¢˜äº†ã€‚ä¸è¿‡ï¼Œ3.1.2 çš„æ„å»ºé€Ÿåº¦æ¯” 2.1.4 ä¸‹é™äº†ä¸å°‘ï¼Œæ…¢äº†å¿«ä¸€å€ã€‚ Compile Type/Version v2.1.4 v3.1.2 JIT ~8s ~15s AOT ~50s ~80s","tags":[{"name":"Ionic","slug":"Ionic","permalink":"https://blog.imtouch.info/tags/Ionic/"},{"name":"Bug","slug":"Bug","permalink":"https://blog.imtouch.info/tags/Bug/"}]},{"title":"å°ç¨‹åº Page è·å–ç™»å½•æ€ï¼Œå¼‚æ­¥æ»¡å¤©é£ï¼Ÿ","date":"2017-11-09T03:08:18.000Z","path":"2017/11/09/wechat-mini-async-hell/","text":"æœ€è¿‘åœ¨å¼€å‘å¾®ä¿¡å°ç¨‹åºï¼Œåœ¨å¤„ç†ç™»å½•é€»è¾‘å’Œåç»­ä¸šåŠ¡é¡µé¢çš„å…³ç³»æ—¶ï¼Œé‡åˆ°äº†å¼‚æ­¥å¤ªå¤šå¤ªä¹±çš„é—®é¢˜ï¼Œæœ¬æ–‡æ¥åšä¸ªå…³äºå°ç¨‹åºç™»å½•æ€å¼‚æ­¥çš„æ€»ç»“ã€‚ ç™»å½•é€»è¾‘ä¸ç™»å½•æ€æ ¹æ®å°ç¨‹åºæ–‡æ¡£ä¸å®˜æ–¹ Demo çš„ä¾‹å­ï¼Œå¾®ä¿¡ç™»å½•é€»è¾‘åœ¨ app.js çš„ App.onLaunch ä¸­å®ç°ã€‚å¦å¤–è¿˜éœ€è¦è‡ªè¡Œä¸ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ç‹¬ç«‹è¿›è¡Œä¸€å¥—æˆæƒæœºåˆ¶ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨äº† JWTï¼Œåœ¨æ¢å– openid çš„æ¥å£ä¸­è¿”å›ã€‚ æ•´ä¸ª app.js çš„ç™»å½•é€»è¾‘å¤§è‡´å¦‚ä¸‹ï¼Œè¿›å…¥å°ç¨‹åºåæ£€æŸ¥å¾®ä¿¡ç™»å½•æ€æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸäº†é‡æ–°è°ƒèµ·å¾®ä¿¡ç™»å½•å¹¶æ¢å–æ–°çš„ JWT ä½œä¸ºä¸ç¬¬ä¸‰æ–¹æœåŠ¡å™¨é€šä¿¡çš„å‡­è¯ï¼›æœªè¿‡æœŸåˆ™ä» localStorage ä¸­æ‹‰å– token ä¸ç”¨æˆ·ä¿¡æ¯ã€‚ App(&#123; onLaunch: function () &#123; const that = this; // æ£€æŸ¥ç”¨æˆ·ç™»å½•æ€æ˜¯å¦è¿‡æœŸï¼Œè¿‡æœŸäº†é‡æ–°ç™»å½• wx.checkSession(&#123; success: () =&gt; &#123; //session æœªè¿‡æœŸï¼Œå¹¶ä¸”åœ¨æœ¬ç”Ÿå‘½å‘¨æœŸä¸€ç›´æœ‰æ•ˆ that.globalData.token = wx.getStorageSync('token'); that.globalData.userInfo = wx.getStorageSync('userInfo'); &#125;, fail: () =&gt; &#123; that.initLoginState(); &#125; &#125;); &#125;, globalData: &#123; token: '', userInfo: null &#125;, // é‡æ–°ç™»å½• initLoginState: function () &#123; const that = this; // ç™»å½• wx.login(&#123; success: res =&gt; &#123; // è°ƒç”¨è·å–ç”¨æˆ·ä¿¡æ¯æ¥å£ wx.getUserInfo(&#123; success: fullUserInfo =&gt; &#123; // å‘é€ res.code åˆ°åå°æ¢å– openId, sessionKey, unionId wx.request(&#123; url: `$&#123;host&#125;/api/auth/loginwx`, method: 'POST', data: &#123; code: res.code, userInfo: fullUserInfo &#125;, success: (&#123;data&#125;) =&gt; &#123; wx.setStorageSync('token', data.data.token); wx.setStorageSync('userInfo', data.data.userInfo); that.globalData.token = data.data.token; that.globalData.userInfo = data.data.userInfo; &#125; &#125;); &#125; &#125;); &#125; &#125;); &#125;&#125;); ä¸šåŠ¡é¡µé¢è·å–æ•°æ®åœ¨ Page ä¸­ï¼Œä¸å¯é¿å…åœ°éœ€è¦è°ƒç”¨ç¬¬ä¸‰æ–¹æœåŠ¡å™¨çš„æ¥å£è·å–æ•°æ®ï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨ JWT è¿›è¡Œæˆæƒã€‚å½“è¿›å…¥é¡µé¢æ—¶å°±éœ€è¦æ‹‰æ•°æ®æ—¶ï¼Œè¯·æ±‚æ”¾åœ¨äº† Page.onLoad æ–¹æ³•ä¸­ã€‚ const app = getApp();const host = require('../../config').host;Page(&#123; data: &#123; groups: [] &#125;, onLoad: function () &#123; this.listGroups(); &#125;, // è·å–è®¢å•å›¢ä¿¡æ¯ listGroups: function () &#123; wx.request(&#123; url: `$&#123;host&#125;/api/group/list`, header: &#123; 'authorization': app.globalData.token &#125;, success: (&#123;data&#125;) =&gt; &#123; this.setData(&#123; groups: data.data &#125;) &#125; &#125;); &#125;&#125;) æµ‹è¯•æ—¶å´å‘ç°æœ‰æ—¶å€™é¡µé¢æœ‰æ•°æ®ï¼Œæœ‰æ—¶å€™é¡µé¢æ— æ•°æ®ã€‚è¿›ä¸€æ­¥æŸ¥çœ‹è¯·æ±‚ä¾¿å‘ç°æœ‰æ—¶ token æœ‰å€¼ï¼Œæœ‰æ—¶ token æ‹¿ä¸åˆ°å€¼ã€‚ å…¨ç‰¹ä¹ˆæ˜¯å¼‚æ­¥ä»”ç»†æƒ³æƒ³å°±èƒ½å¤Ÿæ˜ç™½ï¼ŒåŸå› åœ¨äº App.globalData.token çš„è®¾ç½®æ˜¯å¼‚æ­¥ï¼Œè™½ç„¶ App.onLaunch ä¸ Page.onLoad æœ‰æ˜ç¡®çš„æ—¶åºæ€§ï¼ˆæ–‡æ¡£ä¸Šæ²¡æœ‰è¯´æ˜ï¼Œé€šè¿‡æµ‹è¯•å¯å‘ç° Page.onLoad æ€»åœ¨ App.onLaunch åæ‰§è¡Œï¼‰ï¼Œä½†ã€Œè®¾ç½® tokenã€ä¸ã€Œè¯·æ±‚ä¸šåŠ¡æ¥å£ã€ä¸¤ä¸ªæ­¥éª¤ä¸èƒ½ä¿è¯å…¶æ—¶åºæ€§ï¼Œå› æ­¤ä¼šå‡ºç°å¶å°”è¯·æ±‚å¤±è´¥çš„æƒ…å†µã€‚ æ—¢ç„¶æ— æ³•ä¿è¯æ—¶åºï¼Œç¬¬ä¸€ä¸ªæƒ³æ³•å°±æ˜¯ EventBus äº†ï¼Œè¿™ç§å¾ˆ free çš„ä¸œè¥¿ï¼Œç”¨èµ·æ¥åŠŸèƒ½å¼ºå¤§ä½†ä¹Ÿå¾ˆå±é™©ã€‚ ç»™ App æ·»åŠ äº†ä¸€ä¸ªè‡ªå·±å®ç°çš„ç®€å•å…¨å±€ EventBus ï¼Œå¹¶åœ¨ checkSession.success å’Œé‡æ–°ç™»å½•è®¾ç½®å¥½ token åéƒ½å¹¿æ’­ä¸€ä¸ªç™»é™†æˆåŠŸäº‹ä»¶ã€‚è¿™æ—¶å€™ Page å°±å˜æˆè¿™æ ·äº†ã€‚ loggingSubs: null,onLoad: function () &#123; if (app.globalData.token) &#123; this.listGroups(); &#125; else &#123; this.loggingSubs = app.eventBus.on('LOGGING-SUCCESS', this.listGroups.bind(this)); &#125;&#125;,onUnload: function () &#123; this.loggingSubs.off();&#125;, ç”±äºä¸èƒ½ä¿è¯æ—¶åºæ€§ï¼Œå¦‚æœåœ¨ onLoad æ–¹æ³•åªè®¢é˜…äº‹ä»¶å°±ä¼šå‡ºç°ï¼š ç™»å½•æˆåŠŸäº†ï¼Œå¹¿æ’­ç™»é™†æˆåŠŸäº‹ä»¶ï¼ˆæ²¡æœ‰äººè®¢é˜…ï¼Œæ¶ˆæ¯è¢«ä¸¢å¼ƒï¼‰ æ‰§è¡Œ Page.onLoad æ–¹æ³•ï¼Œè®¢é˜…äº‹ä»¶ ç»“æœæ²¡æœ‰è°ƒç”¨ä¸šåŠ¡æ¥å£ï¼Œå› æ­¤éœ€è¦å¤„ç†ä¸¤ç§æƒ…å†µã€‚ å…¶å® RxJS æä¾›äº† ReplaySubject è¿™æ ·çš„ Observable æ¥ä½¿åè®¢é˜…çš„è§‚å¯Ÿè€…ä¹Ÿèƒ½æ”¶åˆ°ä¹‹å‰çš„æ‰€æœ‰é€šçŸ¥ï¼Œè‡ªè¡Œå®ç°ä¸€ä¸ª ReplaySubject å°±èƒ½å»æ‰è¿™ç§åˆ¤æ–­ï¼Œè¯¦è§å®ç°ä¸€ä¸ªè¶…ç®€å•çš„ ReplaySubject æ¯ä¸ªé¡µé¢éƒ½è¦è¿™æ ·ï¼Ÿå¦‚æœæ¯ä¸ªä¸šåŠ¡ Page éƒ½éœ€è¦åœ¨åˆå§‹åŒ–æ—¶è°ƒç”¨ä¸šåŠ¡æ¥å£ï¼Œéƒ½éœ€è¦å†™ä¸€å¥—è¿™æ ·çš„é€»è¾‘ï¼Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆæ›´å¥½çš„è§£å†³åŠæ³•ï¼Ÿ æ›´ç”šä¹‹ï¼Œå°±ç®—æ˜¯ä¸€äº›äº‹ä»¶ç»‘å®šï¼Œç†è®ºä¸Šä¹Ÿä¸èƒ½ä¿è¯äº‹ä»¶è°ƒç”¨æ—¶å·²ç»å®Œæˆç™»å½•ï¼Œéš¾é“æ¯æ¬¡è°ƒç”¨ä¸šåŠ¡æ¥å£éƒ½è¦å†™ä¸€å¥—è¿™æ ·çš„åˆ¤æ–­ï¼Ÿ è¿™ä¸ªé—®é¢˜çš„å‡ºç°æ ¹æœ¬åœ¨äºç™»å½•æ€çš„è·å–ã€token çš„è®¾ç½®æ˜¯å¼‚æ­¥çš„ï¼Œè€Œè¿™ä¸ªå¼‚æ­¥ä¸ä¸šåŠ¡æ¥å£è°ƒç”¨éœ€è¦åŒæ­¥ï¼ˆå¿…é¡»å…ˆæœ‰ token æ‰èƒ½è°ƒç”¨ï¼‰ï¼Œèƒ½å¦æŠŠè¿™ä¸ªè¿‡ç¨‹é€šè¿‡å°ç¨‹åºæ¡†æ¶å›ºå®šæˆåŒæ­¥ï¼Ÿå¦‚ Page.onLoad æ–¹æ³•çš„è°ƒç”¨å¿…é¡»åœ¨ App çš„æŸä¸ªé’©å­ä¹‹åï¼Ÿ å¦‚æœæœ‰æ›´å¥½çš„è§£å†³æ–¹æ³•ï¼Œè¯·ä¸åèµæ•™ï¼Œè°¢è°¢ã€‚","tags":[{"name":"å°ç¨‹åº","slug":"å°ç¨‹åº","permalink":"https://blog.imtouch.info/tags/å°ç¨‹åº/"},{"name":"Async","slug":"Async","permalink":"https://blog.imtouch.info/tags/Async/"}]},{"title":"å®ç°ä¸€ä¸ªè¶…ç®€å•çš„ ReplaySubject","date":"2017-11-09T02:55:40.000Z","path":"2017/11/09/implement-a-replay-subject/","text":"éœ€è¦ä¸€ä¸ª EventBusåœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­æåˆ°ï¼Œé€šè¿‡ EventBus å¯ä»¥ä½¿ç™»å½•é€»è¾‘ä¸ä¸šåŠ¡æ¥å£åŒæ­¥èµ·æ¥ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å°ç¨‹åºé¡µé¢é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ª EventBus. æ— éå°±æ˜¯è‡ªå·±é€ è½®å­æˆ–è€…ç›´æ¥ç”¨åˆ«äººçš„ï¼Œç”±äºä¸€ç›´åœ¨å†™ Angularï¼Œå› æ­¤ç¬¬ä¸€æƒ³æ³•å°±æ˜¯èƒ½ä¸èƒ½æŠŠ RxJS æ‰”è¿›å»ï¼Œé‚£ Observable/ReplaySubject ä¸å°±éšä¾¿ç”¨äº†å—ã€‚ä½†å…¶å®éœ€è¦ç”¨åˆ°çš„åŠŸèƒ½æ²¡è¿™ä¹ˆå¤šï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªç®€å•çš„ publish/subscribe å°±å®Œäº†ï¼Œäºæ˜¯å°±å†³å®šè‡ªå·±å†™ä¸€ä¸ªï¼ˆGoogle æŠ„ä¸€ä¸ªï¼‰å§ã€‚ éœ€è¦æ€æ ·çš„ EventBusäºæ˜¯æ‰¾åˆ°äº†å¾®ä¿¡å°ç¨‹åºè·¨é¡µé¢é€šä¿¡è§£å†³æ€è·¯ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªç®€å•çš„å®ç°ï¼ŒæŠ„è¿‡æ¥åæˆ‘å‘ç°æœ‰å‡ ä¸ªé—®é¢˜å¯ä»¥æ”¹è¿›ï¼š ä¸éœ€è¦å¤„ç† argsï¼Œéœ€è¦ä¼ ä»€ä¹ˆæ•°æ®éº»çƒ¦ä½ è‡ªè¡ŒåŒ…æˆä¸€ä¸ª Objectï¼Œåªç»™ä½ ä¼  payload è°¢è°¢ é”€æ¯è®¢é˜…è¿˜è¦æŠŠè¿™ä¸ªå›è°ƒå‡½æ•°ä¹Ÿä¼ è¿›å»ä¹Ÿå¤ªä¸ç§‘å­¦äº†ï¼ŒRxJS ä¸æ˜¯éƒ½æ˜¯è¿”å›ä¸€ä¸ªå€¼ï¼Œè°ƒä¸€ä¸‹ .unsubscribe() å°±å¯ä»¥äº†å— æ— æ³•å®ç° Replayï¼Œå¿…é¡»å…ˆè®¢é˜…å†å¹¿æ’­ï¼Œä¸æ»¡è¶³éœ€æ±‚å•Š é‚£å°±æ”¹ä¸€æ”¹å§ã€‚ æ€»ä½“æ€è·¯æ€è·¯éå¸¸ç›¸ä¼¼ï¼Œç”¨ä¸€ä¸ª stores æŠŠæ‰€æœ‰äº‹ä»¶çš„å›è°ƒå­˜èµ·æ¥ï¼Œæš´éœ² on ç”¨äºè®¢é˜…äº‹ä»¶ï¼Œemit ç”¨äºå¹¿æ’­ã€‚è·ŸåŸæ¥çš„è®¾è®¡æœ‰å˜åŒ–çš„æœ‰ï¼š æ–°å»ºä¸€ä¸ª Subscription ç±»ï¼Œç”¨äº on() çš„è¿”å›å€¼ï¼Œä»¥åæˆ‘ä»¬å¯ä»¥è°ƒç”¨ Subscription.off() æ¥ç›´æ¥é”€æ¯è®¢é˜… ä¸å†å¤„ç†æ›´å¤šçš„å¹¿æ’­æ•°æ®ï¼Œåªå¤„ç† payload ä½¿ç”¨ cache æ¥ç¼“å­˜æ‰€æœ‰ emit è¿‡çš„å€¼ï¼Œå¹¶åœ¨æ–°è®¢é˜…è€…åˆ°æ¥æ—¶é‡æ”¾è¿™äº›å€¼ Subscriptioné”€æ¯è®¢é˜…çš„å®è´¨æ˜¯å» stores é‡ŒæŠŠå¯¹åº”çš„äº‹ä»¶å›è°ƒå‡½æ•°åˆ æ‰å°±å¯ä»¥äº†ï¼Œæ–‡ç« åŸæ¥çš„æ–¹æ³•ä¹‹æ‰€ä»¥è¦ä¼ å…¥å›è°ƒå°±æ˜¯å»å®šä½è¿™ä¸ªå‡½æ•°ï¼Œåæ¥æ”¹æˆäº†æŠŠ Page Context ä¼ è¿›å»äº†ã€‚ ä¸ºäº†å®šä½å¯ä»¥ç®€å•ç›´æ¥ä¸€ç‚¹å•Šï¼Œç”¨ä¸€ä¸ªè‡ªå¢ id æ¥å®šä½å°±å¥½äº†ã€‚å› æ­¤éœ€è¦ä¸€ä¸ª ID ç”Ÿæˆå™¨ï¼Œä¸€ä¸ªç®€å•é—­åŒ…ï¼š this.getAutoIncrese = (function() &#123; let seq = 1; return function () &#123; ++seq; &#125;;&#125;)(); å®šä½è§£å†³äº†ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åˆ æ‰ï¼Œåªéœ€è¦æ‹¿åˆ°è¿™ä¸ª stores å˜é‡å°± ok äº†ã€‚é‚£å°±åœ¨ Subscription é‡Œä¿ç•™ä¸€ä»½ EventBus çš„å®ä¾‹å°±å¥½äº†ã€‚ class Subscription &#123; eventBus; eventName; cbId; constructor(eventBus, eventName, cbId) &#123; this.eventBus = eventBus; this.eventName = eventName; this.cbId = cbId; &#125; // é”€æ¯è®¢é˜…äº‹ä»¶ off() &#123; this.eventBus.off(this.eventName, this.cbId); &#125;&#125; æ•´ä¸ª Subscripton å°±åŸºæœ¬å®Œæˆäº†ï¼Œè¿™é‡Œçš„ off() æ˜¯ç›´æ¥è°ƒç”¨ EventBus çš„æ–¹æ³•é”€æ¯ã€‚åœ¨ EventBus çš„ on æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ª Subscription ç¤ºä¾‹ã€‚ return new Subscription(this, eventName, cbId); åªå¤„ç† payloadå½“ç„¶èƒ½å¤Ÿå…è®¸å¤šä¸ªå‚æ•°çš„ç¡®æ›´æ–¹ä¾¿ï¼Œä½†æœ‰æ—¶å€™çº¦å®šå¸¦æ¥çš„ç®€åŒ–æ˜¯æ˜æ˜¾çš„ã€‚ emit(eventName, payload) &#123; const eventArray = this.stores[eventName]; if (eventArray) &#123; eventArray.forEach(e =&gt; &#123; e.fn.apply(null, payload); &#125;); &#125;&#125; ä¸ç”¨å…³å¿ƒ arguments ç©¶ç«Ÿæ˜¯ä¸æ˜¯ä¸€ä¸ªæ•°æ®ï¼Œè°ƒç”¨ Array.from è¿˜æ˜¯ Array.prototype.slice å¥½ï¼Œè¿™äº›ç»†èŠ‚ä¼šè®©äººæŠ“ç‹‚ã€‚ åŠ å…¥ Replayé‡æ”¾çš„é€»è¾‘ä¹Ÿå¾ˆç®€å•ï¼Œemit çš„æ—¶å€™å­˜èµ·æ¥ï¼Œåˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰è¶…é•¿ï¼Œè¶…é•¿å»æ‰æœ€æ—§é‚£ä¸ªï¼›on çš„æ—¶å€™æŠŠå­˜èµ·æ¥çš„å€¼åœ¨æ–°çš„å›è°ƒä¸Šé‡æ”¾ã€‚ // define cache and cacheMaxconstructor(cacheMax) &#123; this.cache = &#123;&#125;; this.cacheMax = cacheMax || 1;&#125;// on segment: replay the emit value on new fnif (this.cache[eventName]) &#123; this.cache[eventName].forEach(payload =&gt; &#123; fn.apply(null, payload); &#125;);&#125;// emit segment: reserve the emit valueif (!this.cache[eventName]) &#123; this.cache[eventName] = [];&#125;if (this.cache[eventName].length === this.cacheMax) &#123; this.cache[eventName].shift();&#125;this.cache[eventName].push(payload); è¿™æ ·ä¸€ä¸ªè¶…ç®€å•çš„ ReplaySubject å°±æå®šäº†ã€‚","tags":[{"name":"Observable","slug":"Observable","permalink":"https://blog.imtouch.info/tags/Observable/"},{"name":"EventBus","slug":"EventBus","permalink":"https://blog.imtouch.info/tags/EventBus/"}]},{"title":"ä½ ç¡®å®šè¦ç”¨ Angular åŒå‘ç»‘å®šå—ï¼Ÿ","date":"2017-11-07T03:35:42.000Z","path":"2017/11/07/angular-double-binding-rusure/","text":"æºèµ·â€¦åœ¨å†™ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç»„ä»¶çš„æ—¶å€™ï¼Œåœ¨ä¸Šå±‚æŠŠæ–‡ä»¶åˆ—è¡¨ files: UploadFile[] ä¼ ç»™ç»„ä»¶ï¼Œæ‰“ç®—ç”¨åŒå‘ç»‘å®šã€‚ä¾‹å¦‚è¿™æ ·ï¼š _files: UploadFile[] = [];@Output() filesChange = new EventEmitter();@Input()get files() &#123; return this._files;&#125;set files(v) &#123; this._files = v; this.filesChange.emit(v);&#125; åœ¨å†™åˆ°æŸä¸ªåˆ é™¤æ–‡ä»¶æ–¹æ³•çš„æ—¶å€™ï¼Œçªç„¶å‘ç°ï¼Œè²Œä¼¼è¿™ä¸ª setter æ ¹æœ¬æ²¡æœ‰è¿›å»å•Š this.files.splice(i, 1); files æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¼•ç”¨æ²¡å˜å°±æ²¡æœ‰è¿› setterï¼Œé‚£ä¸Šå±‚çš„å˜é‡ä¸å°±æ²¡å˜äº†å—ï¼Ÿèµ¶ç´§å»çˆ¶ç»„ä»¶çœ‹ä¸€çœ‹ï¼Œå´å‘ç°æ•°ç»„è¿˜çœŸçš„åˆ æ‰äº†ä¸€ä¸ªæ–‡ä»¶ã€‚ WHAT THE FUCK??? æ™ºéšœâ€¦è¿™ä¸ªé—®é¢˜å›°æ‰°äº†æˆ‘äºŒååˆ†é’Ÿï¼ŒæœŸé—´æˆ‘ä¸åœåœ° Google Angular double binding object/arrayï¼Œå‘ç°æ²¡äººé‡åˆ°å’Œæˆ‘ä¸€æ ·çš„é—®é¢˜å•Šï¼Œç½‘ä¸Šçš„ä¾‹å­éƒ½æ˜¯ç”¨çš„ Primitive value, æ²¡äººç”¨æ•°ç»„åšä¾‹å­çš„å—ï¼Ÿä¸ºä»€ä¹ˆæ²¡è¿› setter éƒ½èƒ½å˜å•Šï¼Œå¥½éš¾å•Šï¼ æœ€åçªç„¶çµå…‰ä¸€é—ªï¼Œç‰¹ä¹ˆæˆ‘æ”¹çš„å°±æ˜¯åŒä¸€ä¸ªæ•°ç»„å•Šï¼Œä¸ºä»€ä¹ˆè¦ emit è¿™ä¸ª change å‘¢ï¼Ÿmdzz æ„Ÿæ‚Ÿâ€¦ æ‰€ä»¥ä¸€ä¸ª Reference value ä¸ºä»€ä¹ˆè¦åŒå‘ç»‘å®šå‘¢ï¼Ÿä½ ä¼šåœ¨ç»„ä»¶å†…éƒ¨ reset æ‰è¿™ä¸ªåœ°å€å—ï¼Ÿç›´æ¥ç”¨å°±å¥½äº† ç”¨ Reference value ä¼ é€’æ•°æ®ä¼šå¯¼è‡´æ•°æ®æ—¢èƒ½åœ¨å­ç»„ä»¶å†…éƒ¨è¢«æ”¹ï¼Œçˆ¶ç»„ä»¶ä¹Ÿèƒ½æ”¹ï¼Œåˆ°åº•è°è´Ÿè´£ä»»ï¼Ÿè¯´å¥½çš„å•å‘æ•°æ®æµå‘¢ï¼Ÿ ä½†çœ‹äº†ä¸€ä¸‹ NG-ZORRO çš„ Table ç»„ä»¶å®ç°ï¼Œçš„ç¡®å®ƒçš„ data[i].checked å°±æ˜¯ä¸¤è¾¹éƒ½èƒ½æ”¹çš„ å¦‚æœç”¨ ChangeDetectionStrategy.OnPushï¼ŒReference value è¿˜ä¼šå¯¼è‡´ç»„ä»¶ view æ— æ³•è¢« rerender","tags":[{"name":"Angular","slug":"Angular","permalink":"https://blog.imtouch.info/tags/Angular/"}]},{"title":"å†èŠç®­å¤´å‡½æ•° Arrow Function","date":"2017-08-30T05:14:40.000Z","path":"2017/08/30/say-sth-about-arrow-function/","text":"æ˜¨å¤©é¢è¯•çš„æ—¶å€™é—®äº†ä¸€ä¸ªå…³äºç®­å¤´å‡½æ•°çš„é—®é¢˜ï¼Œå›æ¥å‘ç°å¥½åƒè‡ªå·±è¯´é”™äº†ï¼ˆè£…é€¼å¤±è´¥ï¼‰ï¼Œäºæ˜¯ä¾¿é‡æ–°è®¤è¯†ä¸€ä¸‹è¿™ä¸ª ES6 ç”¨å¾—æœ€å¤šçš„ä¸œè¥¿ã€‚ è¿™æ®µæ—¶é—´é¢è¯•äº†å¾ˆå¤šäººï¼Œå½“é—®åˆ°ç®­å¤´å‡½æ•°å¸¦æ¥çš„å¥½å¤„æ—¶ï¼Œå¤§éƒ¨åˆ†äººéƒ½åªè¯´åˆ°äº†å†™å¾—å°‘ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼Œä¸éœ€è¦ç”¨ thatã€self ä¹‹ç±»çš„å˜é‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ thisã€‚ä½†å½“ç»†é—®ä¸‹å»ï¼Œå…¶å®å¾ˆå¤šäººä¸äº†è§£ç®­å¤´å‡½æ•°çš„ this å°±æ˜¯æ˜¯å•¥å›äº‹ï¼ˆæˆ–è€…åŒ…æ‹¬æˆ‘è‡ªå·± å…ˆè¯´è¯´åœ¨æ­¤ä¹‹å‰æˆ‘å¯¹ç®­å¤´å‡½æ•°çš„ç†è§£å§ï¼šç®­å¤´å‡½æ•°é‡Œçš„ this æ˜¯ã€Œç»§æ‰¿ã€çš„ï¼Œæœ¬èº«ä¸å­˜åœ¨è‡ªå·±çš„ thisï¼Œå½“è°ƒç”¨åˆ° this æ—¶ç”¨çš„å…¶å®æ˜¯ä¸Šä¸€å±‚ä½œç”¨åŸŸçš„ thisã€‚ç°åœ¨çœ‹æ¥è¿™ä¸ªç†è§£è¿˜æ˜¯æœ‰ä¸€å®šåå·®ã€‚ é—­åŒ…ä¸è¯æ³•ä½œç”¨åŸŸæ‘˜å½•ä¸€æ®µçŠ€ç‰›ä¹¦çš„ä»£ç ï¼Œå°±èƒ½å¾ˆå¥½è¯´æ˜é—­åŒ…å’Œè¯æ³•ä½œç”¨åŸŸçš„é—®é¢˜äº†ï¼š var scope = 'global scope';function checkscope() &#123; var scope = 'local scope'; function f() &#123; return scope; &#125; return f;&#125;checkscope()(); è¿™é‡Œè¿”å›çš„æ˜¯ &#39;local scope&#39;ï¼Œæ˜¯å› ä¸ºåœ¨å‡½æ•° f å‡½æ•°ä½“å†…è®¿é—® scope å˜é‡æ—¶ï¼Œä¼šæ²¿ç€ä» f å¼€å§‹çš„ä½œç”¨åŸŸé“¾å¾€ä¸ŠæŸ¥æ‰¾ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªæŸ¥æ‰¾åˆ°çš„å˜é‡æ˜¯åœ¨ checkscope ä½œç”¨åŸŸå†…å®šä¹‰çš„ scopeã€‚ æ³¨æ„æ— è®º f åœ¨ä½•æ—¶ä½•åœ°è°ƒç”¨ï¼Œè¿”å›çš„ scope æ€»æ˜¯ &#39;local scope&#39;ï¼Œè¿™æ˜¯ç”±äºä½œç”¨åŸŸæŸ¥æ‰¾æ€»æ˜¯ä» f å¼€å§‹ï¼Œå› æ­¤ scope çš„å€¼é€šè¿‡è¯æ³•ä½œç”¨åŸŸç¡®å®šäº†ã€‚ Function çš„ thisåœ¨ ES5 ä¸­ï¼Œå‡½æ•°ä¸­çš„ this æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œä¼šæ ¹æ®è°ƒç”¨æ–¹å¼çš„ä¸åŒäº§ç”Ÿä¸åŒçš„ç»‘å®šï¼Œåªæœ‰åœ¨è¢«è°ƒç”¨æ—¶æ‰èƒ½ç¡®å®š this çš„å€¼ï¼š æ™®é€šå‡½æ•°è°ƒç”¨æ—¶ï¼Œå…¨å±€å¯¹è±¡ï¼ˆæµè§ˆå™¨ä¸‹éä¸¥æ ¼æ¨¡å¼ windowï¼‰ ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¸ºè¯¥å¯¹è±¡ ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨æ—¶ï¼Œä¸ºæ–°å¯¹è±¡çš„å¼•ç”¨ ä½¿ç”¨ callã€apply è°ƒç”¨ï¼Œä¸ºç»‘å®šçš„å€¼ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ ç”¨ä»£ç è¯´æ˜ä¸€ä¸‹ï¼š function f(change) &#123; if (change) &#123; this.a = 300; &#125; console.log(this.a);&#125;var a = 100;var obj = &#123; a: 200&#125;;// æ™®é€šè°ƒç”¨ï¼Œè¾“å‡º 100f();// æ–¹æ³•è°ƒç”¨ï¼Œè¾“å‡º 200obj.f = f;obj.f();// æ„é€ å‡½æ•°è°ƒç”¨ï¼Œæ”¹å˜çš„æ˜¯æ–°å¯¹è±¡çš„ aï¼Œè¾“å‡º 300, 100, 300var newObj = new f(true);console.log(a);console.log(newObj.a); Arrow Function çš„ thiså…ˆçœ‹ MDN çš„è¯´æ˜ï¼šMDN - ç®­å¤´å‡½æ•°ï¼Œå…¶å®å†™å¾—å¾ˆæ¸…æ¥šäº†ã€‚å…³é”®åœ¨äºç®­å¤´å‡½æ•°çš„ this æ˜¯è¯æ³•ä½œç”¨åŸŸç»‘å®šè¿™ä¸ªæ¦‚å¿µã€‚è¿™æ„å‘³ç€ç®­å¤´å‡½æ•°çš„ this ç±»ä¼¼äºä¸€ä¸ªå˜é‡ï¼Œåœ¨å®šä¹‰çš„æ—¶å€™å°±å·²ç»ç¡®å®šäº†æŒ‡å‘çš„ä¸Šä¸‹æ–‡ï¼Œè€ŒéåŠ¨æ€è·å–ã€‚çœ‹ä¸ªä¾‹å­ï¼š var a = 100;var obj1 = &#123; a: 200, b: () =&gt; &#123; console.log(this.a); &#125;&#125;;obj1.b();var obj2 = &#123; a: 200, b: function () &#123; var f = () =&gt; &#123; console.log(this.a); &#125; f(); &#125;&#125;;obj2.b();var ff = obj2.b;ff(); åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œthis å¯ä»¥çœ‹æˆæ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€Œéå…³é”®å­—ï¼Œç®­å¤´å‡½æ•°æœ¬èº«ä½œç”¨åŸŸé‡Œå¹¶æ²¡æœ‰ this çš„å®šä¹‰ï¼Œå½“å¼•ç”¨ this æ—¶ï¼Œä¼šæ²¿ç€ä½œç”¨åŸŸé“¾å¾€ä¸ŠæŸ¥æ‰¾ï¼ˆè·Ÿé—­åŒ…é‚£ä¸ª scope å¥½åƒå“¦ï¼‰ã€‚ å› æ­¤ä¾‹å­ä¸­çš„ obj1.b() è·Ÿ obj2.b() è¾“å‡ºåˆ†åˆ«ä¸º 100 å’Œ 200ï¼Œç”±äº obj1.b åœ¨æŸ¥æ‰¾ this æ—¶ä¼šä¸€ç›´æŸ¥æ‰¾åˆ°å…¨å±€ä½œç”¨åŸŸï¼Œå› æ­¤ this.a = 100ï¼›è€Œ obj2.b åœ¨ function ä½œç”¨åŸŸå°±æ‰¾åˆ°äº† thisï¼ˆæ³¨æ„ä½¿ç”¨äº† function å®šä¹‰äº†å‡½æ•°ï¼‰ï¼Œè€Œè¿™æ—¶çš„ this ä¸ºæ–¹æ³•è°ƒç”¨çš„å¯¹è±¡ obj2ï¼Œå› æ­¤ this.a = 200ã€‚ è¿›ä¸€æ­¥è¯´æ˜è¿™ç§ä½œç”¨åŸŸæŸ¥æ‰¾è§„åˆ™çš„æ˜¯ä¸‹é¢ä¸¤è¡Œï¼Œè¾“å‡ºæ˜¯ 100. ç”±äºæ­¤æ—¶ obj2.b çš„è°ƒç”¨æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°è°ƒç”¨ï¼Œå› æ­¤ this çš„å€¼æ˜¯å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥è¾“å‡ºçš„æ˜¯ window.a äº†ã€‚ Arrow Function åˆ°åº•æ˜¯å•¥åœ¨äº†è§£åˆ°ç®­å¤´å‡½æ•°å†…éƒ¨çš„ this å…¶å®æ˜¯ä¸€ä¸ªè¯æ³•ç»‘å®šçš„å˜é‡æ—¶ï¼Œæˆ‘ä¸ç¦æ€€ç–‘è¿™ä¸ªç®­å¤´å‡½æ•°ç©¶ç«Ÿæ˜¯ä¸ªå•¥ï¼Œç”šè‡³äºå®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæœ‰æ²¡æœ‰è‡ªå·±çš„ä½œç”¨åŸŸï¼Ÿ ä»¥å‰å¾ˆå¤šå¯¹ç®­å¤´å‡½æ•°çš„ç®€å•è§£é‡Šæ˜¯ã€ŒJavaScript å‡½æ•°çš„è¯­æ³•ç³–ã€ï¼Œæ ¹æ®å‰æ–‡æ‰€è¿°çš„ this è·å–å€¼çš„ä¸åŒï¼Œå·²ç»çŸ¥é“ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°å…¶å®æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œäºæ˜¯å°è¯•ä¸€ä¸‹ï¼š var f = () =&gt; &#123;&#125;;// 'function'typeof f;// truef instanceof Function;// truef.__proto__ === Function.prototype;// æ ¹æ® MDNï¼Œç®­å¤´å‡½æ•°æ²¡æœ‰åŸå‹ï¼šundefinedf.prototype å„ç§è¯æ®è¡¨æ˜è¿™ä¸ªç®­å¤´å‡½æ•°çš„ç¡®æ˜¯ä¸€ä¸ªã€Œå‡½æ•°ã€ï¼Œåªæ˜¯æ²¡æœ‰åŸå‹å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨ï¼ˆnew f()ï¼‰ã€‚å¦å¤– MDN æåˆ°ï¼Œç®­å¤´å‡½æ•°å†…é™¤äº† thisï¼Œè¿˜æœ‰å…¶ä»–æ™®é€šå‡½æ•°ä¸­å¸¸ç”¨çš„å˜é‡å¦‚ arguments ä¹Ÿæ˜¯è¯æ³•ç»‘å®šçš„ï¼Œè¿™äº›å˜é‡åœ¨ç®­å¤´å‡½æ•°è°ƒç”¨æ—¶æ˜¯æ²¿ç€ä½œç”¨åŸŸé“¾å‘ä¸ŠæŸ¥æ‰¾çš„ã€‚ çœ‹çœ‹è§„èŒƒ14.2.16 Runtime Semantics: Evaluation é‡Œé¢çš„ Note æåˆ°ç®­å¤´å‡½æ•°æ²¡æœ‰å¯¹ this è¿›è¡Œ local bindingï¼ˆæœ¬åœ°ç»‘å®šï¼‰ï¼Œè¿™äº›å˜é‡çš„ç»‘å®šæ˜¯åœ¨ lexically enclosing environment ä¸­è¿›è¡Œçš„ï¼Œå®é™…ä¸Šå°±æ˜¯åŒ…å«ç®­å¤´å‡½æ•°å®šä¹‰çš„å‡½æ•°æ‰§è¡Œç¯å¢ƒä¸­å®šä¹‰çš„ï¼Œè¿™ä¸æˆ‘ä»¬ä¸Šæ–‡çš„ç»“è®ºä¸€è‡´ã€‚","tags":[{"name":"JavaScript","slug":"JavaScript","permalink":"https://blog.imtouch.info/tags/JavaScript/"}]},{"title":"åšå®¢ Github ä»“åº“ README","date":"1970-01-02T04:00:00.000Z","path":"1970/01/02/README/","text":"å¤§å®¶å¥½ï¼Œè¿™ä¸ªä»“åº“ä¿å­˜äº†æˆ‘çš„ Hexo åšå®¢æ‰€æœ‰åšæ–‡çš„æºæ–‡ä»¶ï¼ŒåŒ…æ‹¬é‡Œé¢ç”¨åˆ°çš„å›¾ç‰‡ã€æµç¨‹å›¾çš„ Graffle æºæ–‡ä»¶ç­‰ã€‚å¯ä»¥åˆ° https://blog.imtouch.info è®¿é—®æˆ‘çš„åšå®¢ã€‚ ç›®å‰åšå®¢çš„å†…å®¹åŸºæœ¬ä»¥æŠ€æœ¯ä¸ºä¸»ï¼Œæ¬¢è¿ç•™è¨€äº¤æµï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸ª Repo ä¸‹å¼€ Issue è¿›è¡Œæ¢è®¨ï¼Œè°¢è°¢ã€‚","tags":[]}]